{"version":3,"file":"detector-seguranca.js","sourceRoot":"","sources":["../../../src/analistas/detectores/detector-seguranca.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n// @prometheus-disable seguranca vulnerabilidade-seguranca\nimport type { NodePath } from '@babel/traverse';\nimport type { CallExpression, NewExpression, Node } from '@babel/types';\nimport { traverse } from '@core/config/traverse.js';\nimport { DetectorAgregadosMensagens } from '@core/messages/analistas/detector-agregados-messages.js';\nimport { detectarContextoProjeto } from '@shared/contexto-projeto.js';\nimport { filtrarOcorrenciasSuprimidas } from '@shared/helpers/suppressao.js';\n\nimport type { Analista,Ocorrencia, ProblemaSeguranca, ReportEvent } from '@';\nimport { criarOcorrencia } from '@';\n\n// Funções helper para detecção inteligente de segredos\n\nfunction isPlaceholderSuspeito(linha: string): boolean {\n  const placeholdersComuns = ['<YOUR_', '<FOO>', '<BAR>', 'REPLACE_ME', 'EXAMPLE_', 'PLACEHOLDER', 'your_', 'example', 'sample', 'demo', 'test', 'fake', 'dummy', 'mock'];\n  const linhaLower = linha.toLowerCase();\n  return placeholdersComuns.some(p => linhaLower.includes(p.toLowerCase()));\n}\nfunction isContextoDocumentacao(relPath: string): boolean {\n  const arquivosDoc = ['readme', 'doc/', 'docs/', '.md', '.example', '.sample', '.template', 'third-party-notices', 'license', 'changelog'];\n  const pathLower = relPath.toLowerCase();\n  return arquivosDoc.some(pattern => pathLower.includes(pattern));\n}\nfunction calcularEntropia(str: string): number {\n  const frequencias = new Map<string, number>();\n\n  // Contar frequência de cada caractere\n  for (const char of str) {\n    frequencias.set(char, (frequencias.get(char) || 0) + 1);\n  }\n\n  // Calcular entropia de Shannon\n  let entropia = 0;\n  for (const freq of frequencias.values()) {\n    const prob = freq / str.length;\n    entropia -= prob * Math.log2(prob);\n  }\n  return entropia;\n}\nexport const analistaSeguranca: Analista = {\n  nome: 'seguranca',\n  categoria: 'seguranca',\n  descricao: 'Detecta vulnerabilidades e práticas inseguras no código',\n  test: (relPath: string): boolean => {\n    return /\\.(js|jsx|ts|tsx|mjs|cjs)$/.test(relPath);\n  },\n  aplicar: (src: string, relPath: string, ast: NodePath<Node> | null, _fullPath?: string, contexto?: import('@').ContextoExecucao): Ocorrencia[] => {\n    if (!src) return [];\n    const contextoArquivo = detectarContextoProjeto({\n      arquivo: relPath,\n      conteudo: src,\n      relPath\n    });\n    const problemas: ProblemaSeguranca[] = [];\n    try {\n      // Detectar problemas por padrões de texto (mais confiável que AST para alguns casos)\n      detectarPadroesPerigosos(src, relPath, problemas);\n\n      // Detectar problemas via AST quando disponível\n      if (ast) {\n        detectarProblemasAST(ast, problemas);\n      }\n\n      // Converter para ocorrências\n      const ocorrencias: Ocorrencia[] = [];\n\n      // Agrupar por severidade\n      const porSeveridade = agruparPorSeveridade(problemas);\n      for (const [severidade, items] of Object.entries(porSeveridade)) {\n        if (items.length > 0) {\n          const nivel = mapearSeveridadeParaNivel(severidade as ProblemaSeguranca['severidade']);\n\n          // Ajustar severidade baseado no contexto\n          const nivelAjustado = contextoArquivo.isTest && nivel === 'aviso' ? 'info' : nivel;\n          const resumo = items.slice(0, 3).map(p => p.tipo).join(', ');\n          ocorrencias.push(criarOcorrencia({\n            tipo: 'vulnerabilidade-seguranca',\n            nivel: nivelAjustado,\n            mensagem: DetectorAgregadosMensagens.problemasSegurancaResumo(severidade, resumo, items.length),\n            relPath,\n            linha: items[0].linha\n          }));\n        }\n      }\n\n      // Aplicar supressões inline antes de retornar\n      return filtrarOcorrenciasSuprimidas(ocorrencias, 'seguranca', src);\n    } catch (erro) {\n      const ev = {\n        tipo: 'detector-seguranca-erro',\n        nivel: 'aviso' as const,\n        mensagem: DetectorAgregadosMensagens.erroAnalisarSeguranca(erro),\n        relPath,\n        linha: 1\n      };\n      if (contexto && typeof contexto.report === 'function') {\n        try {\n          contexto.report(ev as ReportEvent);\n          return [];\n        } catch {\n          return [criarOcorrencia({\n            tipo: 'ERRO_ANALISE',\n            nivel: 'aviso',\n            mensagem: DetectorAgregadosMensagens.erroAnalisarSeguranca(erro),\n            relPath,\n            linha: 1\n          })];\n        }\n      }\n      return [criarOcorrencia({\n        tipo: 'ERRO_ANALISE',\n        nivel: 'aviso',\n        mensagem: DetectorAgregadosMensagens.erroAnalisarSeguranca(erro),\n        relPath,\n        linha: 1\n      })];\n    }\n  }\n};\nfunction detectarPadroesPerigosos(src: string, relPath: string, problemas: ProblemaSeguranca[]): void {\n  const linhas = src.split('\\n');\n  function isLikelyHttpHeaderName(value: string): boolean {\n    const v = String(value || '').trim();\n    if (!v) return false;\n    // Header names geralmente são curtos/médios e usam letras/números/hífens.\n    if (v.length < 4 || v.length > 80) return false;\n    if (!/^[A-Za-z0-9-]+$/.test(v)) return false;\n    if (v.startsWith('-') || v.endsWith('-')) return false;\n    // Heurística: costuma ter hífen (ex.: Content-Type) e, muitas vezes, prefixo X-\n    if (!/-/.test(v) && !/^X[A-Za-z]?/.test(v)) return false;\n    return true;\n  }\n  function isHttpHeadersKeyValueContext(index: number): boolean {\n    const start = Math.max(0, index - 12);\n    const end = Math.min(linhas.length, index + 6);\n    const ctx = linhas.slice(start, end).join('\\n');\n    const hasHeaders = /\\bheaders\\b\\s*[:=]/i.test(ctx) || /\\bheader\\b/i.test(ctx);\n    const hasValorProp = /\\bvalue\\b\\s*[:=]/i.test(ctx);\n    return hasHeaders && hasValorProp;\n  }\n  linhas.forEach((linha, index) => {\n    const numeroLinha = index + 1;\n\n    // Ignorar comentários, strings e regex patterns para reduzir falsos positivos\n    const linhaSemComentarios = linha.replace(/\\/\\/.*$/, '').replace(/\\/\\*.*?\\*\\//, '');\n    const linhaSemStrings = linhaSemComentarios.replace(/'[^']*'/g, '').replace(/\"[^\"]*\"/g, '').replace(/`[^`]*`/g, '').replace(/\\/[^\\/]*\\//g, '');\n\n    // eval() usage - apenas em código real, não em comentários/strings/regex\n    if (/\\beval\\s*\\(/.test(linhaSemStrings)) {\n      problemas.push({\n        tipo: 'eval-usage',\n        descricao: 'Uso de eval() pode executar código malicioso',\n        severidade: 'critica',\n        linha: numeroLinha,\n        sugestao: 'Use JSON.parse() ou funções específicas ao invés de eval()'\n      });\n    }\n\n    // innerHTML com variáveis\n    if (/\\.innerHTML\\s*=\\s*[^\"']/.test(linha)) {\n      problemas.push({\n        tipo: 'dangerous-html',\n        descricao: 'innerHTML com variáveis pode causar XSS',\n        severidade: 'alta',\n        linha: numeroLinha,\n        sugestao: 'Use textContent ou sanitize o HTML antes de inserir'\n      });\n    }\n\n    // Math.random() para criptografia\n    if (/Math\\.random\\(\\)/.test(linha) && /crypto|password|token|secret/i.test(linha)) {\n      problemas.push({\n        tipo: 'weak-crypto',\n        descricao: 'Math.random() não é seguro para criptografia',\n        severidade: 'alta',\n        linha: numeroLinha,\n        sugestao: 'Use crypto.randomBytes() ou crypto.getRandomValues()'\n      });\n    }\n\n    // Algoritmos de hash fracos\n    if (/createHash\\s*\\(\\s*['\"`](md5|md4|sha1)['\"`]\\s*\\)/.test(linha)) {\n      const algoritmo = /createHash\\s*\\(\\s*['\"`](md5|md4|sha1)['\"`]\\s*\\)/.exec(linha)?.[1];\n\n      // Verificar se há comentário justificando o uso (ex: fingerprinting, não-criptográfico)\n      const linhaAnterior = index > 0 ? linhas[index - 1] : '';\n      const linha2Atras = index > 1 ? linhas[index - 2] : '';\n      const comentarioContexto = linhaAnterior + linha2Atras;\n      const temJustificativa = /fingerprint|cache|baseline|perf|não.*segurança|not.*security|não.*criptograf/i.test(comentarioContexto) || /apenas.*identifica|only.*identif|deduplica/i.test(comentarioContexto);\n      if (!temJustificativa) {\n        problemas.push({\n          tipo: 'weak-crypto',\n          descricao: `Algoritmo de hash ${algoritmo?.toUpperCase()} é considerado fraco`,\n          severidade: 'alta',\n          linha: numeroLinha,\n          sugestao: 'Use SHA-256 ou superior: createHash(\"sha256\") - ou adicione comentário se for apenas fingerprinting'\n        });\n      }\n    }\n\n    // RegExp com input do usuário\n    if (/new RegExp\\s*\\([^)]*\\)/.test(linha) && /req\\.|params\\.|query\\.|body\\./.test(linha)) {\n      problemas.push({\n        tipo: 'unsafe-regex',\n        descricao: 'RegExp com input não validado pode causar ReDoS',\n        severidade: 'media',\n        linha: numeroLinha,\n        sugestao: 'Valide e escape o input antes de usar em RegExp'\n      });\n    }\n\n    // __proto__ manipulation - evitar falsos positivos em strings/comentários\n    if (/__proto__/.test(linhaSemStrings)) {\n      problemas.push({\n        tipo: 'prototype-pollution',\n        descricao: 'Manipulação de __proto__ pode causar prototype pollution',\n        severidade: 'alta',\n        linha: numeroLinha,\n        sugestao: 'Use Object.create(null) ou Object.setPrototypeOf() com cuidado'\n      });\n    }\n\n    // Path traversal patterns\n    if (/\\.\\.\\//g.test(linha) && /req\\.|params\\.|query\\./.test(linha)) {\n      problemas.push({\n        tipo: 'path-traversal',\n        descricao: 'Possível vulnerabilidade de path traversal',\n        severidade: 'alta',\n        linha: numeroLinha,\n        sugestao: 'Sanitize caminhos de arquivo e use path.resolve() com cuidado'\n      });\n    }\n\n    // Credenciais hardcoded - versão inteligente com whitelist\n    // Excluir variáveis comuns que não são secrets (migrationKey, cacheKey, hashKey, etc)\n    const isNonSecretChave = /\\b(migration|cache|hash|dedupe|lookup|map|index)key\\b/i.test(linha);\n    if (!isPlaceholderSuspeito(linha) && !isContextoDocumentacao(relPath) && !isNonSecretChave) {\n      const padraoSegredo = /\\b(password|pwd|pass|secret|key|token|api_key|apikey)\\b\\s*[:=]\\s*['\"`]([^'\"`\\s]{3,})/i;\n      const match = linha.match(padraoSegredo);\n      if (match) {\n        const campo = String(match[1] || '').toLowerCase();\n        const valor = match[2];\n\n        // Redução de falsos positivos: headers HTTP em configurações\n        // Ex.: headers: [{ key: 'X-Content-Type-Options', value: 'nosniff' }]\n        if (campo === 'key' && isLikelyHttpHeaderName(valor) && isHttpHeadersKeyValueContext(index)) {\n          return;\n        }\n\n        // Excluir template strings com interpolação (não são secrets hardcoded)\n        const temInterpolacao = linha.includes('${') || /`[^`]*\\$\\{[^}]+\\}/.test(linha);\n        if (temInterpolacao) {\n          return; // Template strings dinâmicas não são hardcoded\n        }\n\n        // Whitelist de padrões comuns de nomenclatura (não são secrets)\n        const padroesNomenclatura = ['_role_', '_config_', '_key_', '_type_', '_name_', '_prefix_', '_suffix_', 'squad_', 'channel_', 'guild_'];\n        const isPadraoNomenclatura = padroesNomenclatura.some(p => valor.toLowerCase().includes(p.toLowerCase()));\n        if (isPadraoNomenclatura) {\n          return; // Padrões de nomenclatura não são secrets\n        }\n\n        // Whitelist para placeholders comuns\n        const placeholdersSegurs = ['<YOUR_', '<FOO>', '<BAR>', 'REPLACE_ME', 'EXAMPLE_', 'PLACEHOLDER', 'your_', 'example', 'sample', 'demo', 'test', 'fake', 'dummy', 'mock'];\n        const isPlaceholder = placeholdersSegurs.some(p => valor.toLowerCase().includes(p.toLowerCase()));\n\n        // Verificar entropia (tokens reais tendem a ter alta entropia)\n        const entropia = calcularEntropia(valor);\n        const temAltaEntropia = entropia > 3.5; // Threshold empírico\n\n        // Verificar se parece com token/chave real\n        const pareceTokReal = valor.length > 20 && (\n        // Aumentado de 8 para 20 para reduzir falsos positivos\n        temAltaEntropia || /^[A-Za-z0-9+/]{20,}={0,2}$/.test(valor)) &&\n        // Base64-like\n        !isPlaceholder;\n        if (pareceTokReal) {\n          problemas.push({\n            tipo: 'hardcoded-secrets',\n            descricao: 'Credenciais hardcoded no código podem ser expostas',\n            severidade: 'critica',\n            linha: numeroLinha,\n            sugestao: 'Use variáveis de ambiente ou arquivo de configuração seguro'\n          });\n        }\n      }\n    }\n  });\n\n  // Detectar async/await sem try-catch (melhoria exclusiva)\n  detectarAsyncSemTryCatch(src, problemas);\n}\n\n/**\n * Detecta uso de async/await sem tratamento adequado de erro\n */\nfunction detectarAsyncSemTryCatch(src: string, problemas: ProblemaSeguranca[]): void {\n  const lines = src.split('\\n');\n\n  // Contexto global do arquivo para detectar padrões do Next.js\n  const isNextJsServerComponent = /^['\"](use server|use client)['\"]/.test(src.trim()) || /export\\s+(default\\s+)?async\\s+function/.test(src);\n  const hasDynamicImport = /next\\/dynamic|import\\s*\\(/.test(src);\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const trimmedLine = line.trim();\n\n    // Detectar await sem try-catch\n    if (/\\bawait\\s+/.test(line) && !trimmedLine.startsWith('//')) {\n      // Verificar contexto expandido para detectar event handlers\n      const contextLines = lines.slice(Math.max(0, i - 10), i);\n      const context = contextLines.join(' ');\n\n      // Detectar se está dentro de event handler (fire-and-forget por design)\n      const isEventHandler = /\\.on\\s*\\(/.test(context) || /\\.once\\s*\\(/.test(context) || /addEventListener\\s*\\(/.test(context) || /collector\\.on\\s*\\(/.test(context) || /emitter\\.on\\s*\\(/.test(context) || /process\\.on\\s*\\(/.test(context);\n\n      // Verificar se é dynamic import do Next.js (tratamento gerenciado pelo framework)\n      const isDynamicImport = hasDynamicImport && (/import\\s*\\(/.test(line) || /dynamic\\s*\\(/.test(context));\n\n      // Server Components do Next.js: tratamento gerenciado pelo framework\n      if (isNextJsServerComponent || isDynamicImport) {\n        continue;\n      }\n\n      // Verificar se há try-catch em escopo expandido (100 linhas antes/depois)\n      const extendedContext = lines.slice(Math.max(0, i - 100), Math.min(lines.length, i + 100));\n      const fullContext = extendedContext.join('\\n');\n\n      // Detectar try-catch em escopo pai (bloco que envolve o await)\n      const hasErroHandling = /try\\s*\\{[\\s\\S]*?\\}\\s*catch/.test(fullContext) || /\\.catch\\s*\\(/.test(line) || /\\.catch\\s*\\(/.test(lines[i + 1] || '') ||\n      // Promise encadeada com .then().catch()\n      /\\.then\\s*\\([^)]*\\)\\s*\\.catch/.test(fullContext);\n      if (!hasErroHandling) {\n        problemas.push({\n          tipo: isEventHandler ? 'unhandled-async-event' : 'unhandled-async',\n          descricao: isEventHandler ? 'await em event handler sem tratamento de erro (considere adicionar .catch se necessário)' : 'await sem tratamento de erro pode causar crashes não tratados',\n          severidade: isEventHandler ? 'baixa' : 'media',\n          linha: i + 1,\n          sugestao: isEventHandler ? 'Event handlers são fire-and-forget. Adicione .catch() apenas se precisar tratar erros específicos' : 'Envolva em try-catch ou use .catch() na Promise'\n        });\n      }\n    }\n  }\n}\nfunction detectarProblemasAST(ast: NodePath<Node>, problemas: ProblemaSeguranca[]): void {\n  try {\n    traverse(ast.node, {\n      // Detectar Function constructor\n      NewExpression(path: NodePath<NewExpression>) {\n        if (path.node.callee.type === 'Identifier' && path.node.callee.name === 'Function') {\n          problemas.push({\n            tipo: 'eval-usage',\n            descricao: 'Function constructor pode executar código dinâmico',\n            severidade: 'alta',\n            linha: path.node.loc?.start.line || 0,\n            sugestao: 'Evite Function constructor, use funções declaradas'\n          });\n        }\n      },\n      // Detectar setTimeout/setInterval com strings\n      CallExpression(path: NodePath<CallExpression>) {\n        if (path.node.callee.type === 'Identifier' && ['setTimeout', 'setInterval'].includes(path.node.callee.name) && path.node.arguments[0]?.type === 'StringLiteral') {\n          problemas.push({\n            tipo: 'eval-usage',\n            descricao: 'setTimeout/setInterval com string executa código dinâmico',\n            severidade: 'media',\n            linha: path.node.loc?.start.line || 0,\n            sugestao: 'Use função ao invés de string'\n          });\n        }\n      }\n    });\n  } catch {\n    // Ignorar erros de traverse para não quebrar a análise\n  }\n}\nfunction agruparPorSeveridade(problemas: ProblemaSeguranca[]): Record<string, ProblemaSeguranca[]> {\n  return problemas.reduce((acc, problema) => {\n    if (!acc[problema.severidade]) {\n      acc[problema.severidade] = [];\n    }\n    acc[problema.severidade].push(problema);\n    return acc;\n  }, {} as Record<string, ProblemaSeguranca[]>);\n}\nfunction mapearSeveridadeParaNivel(severidade: ProblemaSeguranca['severidade']): 'info' | 'aviso' | 'erro' {\n  switch (severidade) {\n    case 'critica':\n    case 'alta':\n      return 'erro';\n    case 'media':\n      return 'aviso';\n    case 'baixa':\n    default:\n      return 'info';\n  }\n}"]}