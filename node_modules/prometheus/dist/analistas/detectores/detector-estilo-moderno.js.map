{"version":3,"file":"detector-estilo-moderno.js","sourceRoot":"","sources":["../../../src/analistas/detectores/detector-estilo-moderno.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,QAAQ,EAAE,MAAM,0BAA0B,CAAC;AACpD,OAAO,EAAE,8BAA8B,EAAE,MAAM,8DAA8D,CAAC;AAC9G,OAAO,EAAE,4BAA4B,EAAE,MAAM,+BAA+B,CAAC;AAG7E,OAAO,EAAE,eAAe,EAAE,MAAM,GAAG,CAAC;AAEpC,MAAM,CAAC,MAAM,qBAAqB,GAAa;IAC7C,IAAI,EAAE,gBAAgB;IACtB,SAAS,EAAE,UAAU;IACrB,SAAS,EAAE,yDAAyD;IACpE,IAAI,EAAE,CAAC,OAAe,EAAW,EAAE;QACjC,OAAO,4BAA4B,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACpD,CAAC;IACD,OAAO,EAAE,CAAC,GAAW,EAAE,OAAe,EAAE,GAA0B,EAAgB,EAAE;QAClF,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG;YAAE,OAAO,EAAE,CAAC;QAE5B,MAAM,WAAW,GAAiB,EAAE,CAAC;QACrC,MAAM,IAAI,GAAG,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAEzC,IAAI,CAAC;YACH,QAAQ,CAAC,GAAG,CAAC,IAAI,EAAE;gBAEjB,cAAc,CAAC,IAAc;oBAC3B,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,KAAK,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;oBACvE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC;wBAAE,OAAO;oBAEjC,IAAI,UAAU,GAAG,CAAC,CAAC;oBACnB,IAAI,aAAa,GAAG,CAAC,CAAC,CAAC;oBAEvB,KAAK,MAAM,IAAI,IAAI,IAAI,EAAE,CAAC;wBACxB,IAAI,QAAQ,GAAG,KAAK,CAAC;wBACrB,IAAI,IAAI,CAAC,IAAI,KAAK,qBAAqB,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,KAAK,iBAAiB,EAAE,CAAC;4BACtF,QAAQ,GAAG,IAAI,CAAC;wBAClB,CAAC;6BAAM,IAAI,IAAI,CAAC,IAAI,KAAK,qBAAqB,EAAE,CAAC;4BAC/C,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,EAAE,IAAI,KAAK,iBAAiB,CAAC,CAAC;wBAC/E,CAAC;wBAED,IAAI,QAAQ,EAAE,CAAC;4BACb,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,IAAI,CAAC,CAAC;4BAC9C,IAAI,aAAa,KAAK,CAAC,CAAC,IAAI,WAAW,KAAK,aAAa,GAAG,CAAC,EAAE,CAAC;gCAC9D,UAAU,EAAE,CAAC;4BACf,CAAC;iCAAM,CAAC;gCACN,UAAU,GAAG,CAAC,CAAC;4BACjB,CAAC;4BACD,aAAa,GAAG,WAAW,CAAC;4BAE5B,IAAI,UAAU,IAAI,CAAC,EAAE,CAAC;gCACpB,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC;oCAC/B,IAAI,EAAE,iBAAiB;oCACvB,KAAK,EAAE,MAAM;oCACb,QAAQ,EAAE,8BAA8B,CAAC,kBAAkB;oCAC3D,OAAO;oCACP,KAAK,EAAE,WAAW;iCACnB,CAAC,CAAC,CAAC;gCACJ,UAAU,GAAG,CAAC,CAAC;4BACjB,CAAC;wBACH,CAAC;6BAAM,CAAC;4BACN,UAAU,GAAG,CAAC,CAAC;wBACjB,CAAC;oBACH,CAAC;gBACH,CAAC;gBAGD,kBAAkB,CAAC,IAAkC;oBACnD,IAAI,CAAC,IAAI;wBAAE,OAAO;oBAClB,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;oBACvB,IAAI,IAAI,CAAC,EAAE,CAAC,IAAI,KAAK,YAAY,IAAI,IAAI,CAAC,EAAE,CAAC,cAAc,IAAI,IAAI,CAAC,IAAI,EAAE,IAAI,KAAK,kBAAkB,EAAE,CAAC;wBAErG,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC;4BAC9B,IAAI,EAAE,mBAAmB;4BACzB,KAAK,EAAE,MAAM;4BACb,QAAQ,EAAE,8BAA8B,CAAC,iBAAiB,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC;4BACxE,OAAO;4BACP,KAAK,EAAE,IAAI,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,IAAI,CAAC;yBAClC,CAAC,CAAC,CAAC;oBACP,CAAC;gBACH,CAAC;gBAGD,cAAc,CAAC,IAA8B;oBAC3C,MAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;oBAChC,IAAI,MAAM,CAAC,IAAI,KAAK,kBAAkB,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,KAAK,YAAY,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,KAAK,gBAAgB,EAAE,CAAC;wBAC7H,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC;4BAC/B,IAAI,EAAE,gBAAgB;4BACtB,KAAK,EAAE,MAAM;4BACb,QAAQ,EAAE,8BAA8B,CAAC,cAAc;4BACvD,OAAO;4BACP,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,IAAI,CAAC;yBACtC,CAAC,CAAC,CAAC;oBACN,CAAC;gBACH,CAAC;gBAGD,mBAAmB,CAAC,IAAc;oBAC9B,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;oBACvB,IAAI,IAAI,CAAC,IAAI,KAAK,qBAAqB;wBAAE,OAAO;oBAChD,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,IAAI,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE,CAAC;wBAC/C,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,YAAY,EAAE,CAAC;4BACnC,IAAI,IAAI,CAAC,EAAE,CAAC,IAAI,KAAK,YAAY,EAAE,CAAC;gCAChC,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;gCACxC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;oCAChH,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,IAAI,EAAE,CAAC;oCAClC,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC;wCAC7B,IAAI,EAAE,eAAe;wCACrB,KAAK,EAAE,MAAM;wCACb,QAAQ,EAAE,8BAA8B,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC;wCACpE,OAAO;wCACP,KAAK,EAAE,IAAI,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,IAAI,CAAC;qCACnC,CAAC,CAAC,CAAC;gCACR,CAAC;4BACL,CAAC;wBACL,CAAC;oBACL,CAAC;gBACL,CAAC;aACF,CAAC,CAAC;YAEH,OAAO,4BAA4B,CAAC,WAAW,EAAE,gBAAgB,EAAE,GAAG,CAAC,CAAC;QAC1E,CAAC;QAAC,MAAM,CAAC;YACP,OAAO,EAAE,CAAC;QACZ,CAAC;IACH,CAAC;CACF,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT\nimport type { NodePath } from '@babel/traverse';\nimport type { CallExpression, Node, VariableDeclarator } from '@babel/types';\nimport { traverse } from '@core/config/traverse.js';\nimport { DetectorEstiloModernoMensagens } from '@core/messages/analistas/detector-estilo-moderno-messages.js';\nimport { filtrarOcorrenciasSuprimidas } from '@shared/helpers/suppressao.js';\n\nimport type { Analista, Ocorrencia } from '@';\nimport { criarOcorrencia } from '@';\n\nexport const analistaEstiloModerno: Analista = {\n  nome: 'estilo-moderno',\n  categoria: 'estetica',\n  descricao: 'Refina o código com padrões e melhores práticas de 2026',\n  test: (relPath: string): boolean => {\n    return /\\.(js|jsx|ts|tsx|mjs|cjs)$/.test(relPath);\n  },\n  aplicar: (src: string, relPath: string, ast: NodePath<Node> | null): Ocorrencia[] => {\n    if (!ast || !src) return [];\n\n    const ocorrencias: Ocorrencia[] = [];\n    const isTS = /\\.(ts|tsx)$/.test(relPath);\n\n    try {\n      traverse(ast.node, {\n        // 1. Detectar Await Waterfalls\n        BlockStatement(path: NodePath) {\n          const body = path.node.type === 'BlockStatement' ? path.node.body : [];\n          if (!Array.isArray(body)) return;\n\n          let awaitCount = 0;\n          let lastAwaitLine = -1;\n\n          for (const stmt of body) {\n            let hasAwait = false;\n            if (stmt.type === 'ExpressionStatement' && stmt.expression.type === 'AwaitExpression') {\n              hasAwait = true;\n            } else if (stmt.type === 'VariableDeclaration') {\n              hasAwait = stmt.declarations.some((d) => d.init?.type === 'AwaitExpression');\n            }\n\n            if (hasAwait) {\n              const currentLine = stmt.loc?.start.line || 0;\n              if (lastAwaitLine !== -1 && currentLine === lastAwaitLine + 1) {\n                awaitCount++;\n              } else {\n                awaitCount = 1;\n              }\n              lastAwaitLine = currentLine;\n\n              if (awaitCount >= 3) {\n                ocorrencias.push(criarOcorrencia({\n                  tipo: 'await-waterfall',\n                  nivel: 'info',\n                  mensagem: DetectorEstiloModernoMensagens.waterfallDetectado,\n                  relPath,\n                  linha: currentLine\n                }));\n                awaitCount = 0; // Reset para não duplicar\n              }\n            } else {\n              awaitCount = 0;\n            }\n          }\n        },\n\n        // 2. Sugerir 'satisfies' em TS\n        VariableDeclarator(path: NodePath<VariableDeclarator>) {\n          if (!isTS) return;\n          const node = path.node;\n          if (node.id.type === 'Identifier' && node.id.typeAnnotation && node.init?.type === 'ObjectExpression') {\n             // Se tem anotação de tipo e é um objeto literal, pode ser satisfies\n             ocorrencias.push(criarOcorrencia({\n                tipo: 'suggest-satisfies',\n                nivel: 'info',\n                mensagem: DetectorEstiloModernoMensagens.satisfiesSugerido(node.id.name),\n                relPath,\n                linha: node.loc?.start.line || 0\n             }));\n          }\n        },\n\n        // 3. Sugerir 'Object.hasOwn'\n        CallExpression(path: NodePath<CallExpression>) {\n          const callee = path.node.callee;\n          if (callee.type === 'MemberExpression' && callee.property.type === 'Identifier' && callee.property.name === 'hasOwnProperty') {\n            ocorrencias.push(criarOcorrencia({\n              tipo: 'suggest-hasown',\n              nivel: 'info',\n              mensagem: DetectorEstiloModernoMensagens.hasOwnSugerido,\n              relPath,\n              linha: path.node.loc?.start.line || 0\n            }));\n          }\n        },\n\n        // 4. Sugerir 'using' para recursos (heurística por nome)\n        VariableDeclaration(path: NodePath) {\n            const node = path.node;\n            if (node.type !== 'VariableDeclaration') return;\n            if (node.kind === 'const' || node.kind === 'let') {\n                for (const decl of node.declarations) {\n                    if (decl.id.type === 'Identifier') {\n                        const name = decl.id.name.toLowerCase();\n                        if ((name.includes('client') || name.includes('handle') || name.includes('resource') || name.includes('connection')) &&\n                            !src.includes('using ') && isTS) {\n                            ocorrencias.push(criarOcorrencia({\n                                tipo: 'suggest-using',\n                                nivel: 'info',\n                                mensagem: DetectorEstiloModernoMensagens.usingSugerido(decl.id.name),\n                                relPath,\n                                linha: decl.loc?.start.line || 0\n                            }));\n                        }\n                    }\n                }\n            }\n        }\n      });\n\n      return filtrarOcorrenciasSuprimidas(ocorrencias, 'estilo-moderno', src);\n    } catch {\n      return [];\n    }\n  }\n};\n"]}