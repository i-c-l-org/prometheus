{"version":3,"file":"analista-formater.js","sourceRoot":"","sources":["../../../src/analistas/plugins/analista-formater.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\nimport { AnalystOrigens, AnalystTipos, FormatadorMensagens, SeverityNiveis } from '@core/messages/core/plugin-messages.js';\nimport { formatarPrettierMinimo } from '@shared/impar/formater.js';\n\nimport { criarAnalista, criarOcorrencia } from '@';\n\nconst disableEnv = process.env.PROMETHEUS_DISABLE_PLUGIN_FORMATADOR === '1';\ntype Msg = ReturnType<typeof criarOcorrencia>;\nfunction msg(message: string, relPath: string, nivel: (typeof SeverityNiveis)[keyof typeof SeverityNiveis] = SeverityNiveis.warning, line = 1): Msg {\n  return criarOcorrencia({\n    relPath,\n    mensagem: message,\n    linha: line,\n    nivel,\n    origem: AnalystOrigens.formatador,\n    tipo: AnalystTipos.formatador\n  });\n}\nfunction normalizarEol(code: string): string {\n  return code.replace(/\\r\\n?/g, '\\n');\n}\nfunction primeiraLinhaDiferente(a: string, b: string): number {\n  const aLines = normalizarEol(a).split('\\n');\n  const bLines = normalizarEol(b).split('\\n');\n  const len = Math.max(aLines.length, bLines.length);\n  for (let i = 0; i < len; i++) {\n    if ((aLines[i] ?? '') !== (bLines[i] ?? '')) return i + 1;\n  }\n  return 1;\n}\nexport const analistaFormatador = criarAnalista({\n  nome: 'analista-formatador',\n  categoria: 'formatacao',\n  descricao: 'Verifica formatação mínima interna do Prometheus (JSON/Markdown/YAML).',\n  global: false,\n  test: (relPath: string): boolean => /\\.(json|md|markdown|ya?ml)$/i.test(relPath),\n  aplicar: async (src, relPath): Promise<Msg[] | null> => {\n    if (disableEnv) return null;\n    const res = formatarPrettierMinimo({\n      code: src,\n      relPath\n    });\n    if (!res.ok) {\n      return [msg(FormatadorMensagens.parseErro(res.parser, res.error), relPath, SeverityNiveis.error, 1)];\n    }\n    if (!res.changed) return null;\n    const linha = primeiraLinhaDiferente(src, res.formatted);\n    const detalhes = [`primeira diferença na linha ${linha}`, res.reason ? `motivo: ${res.reason}` : null].filter(Boolean).join(', ');\n\n    // Manter como aviso (alinha com intenção de \"check\" sem mutação)\n    return [msg(FormatadorMensagens.naoFormatado(res.parser, detalhes || undefined), relPath, SeverityNiveis.warning, linha)];\n  }\n});\nexport default analistaFormatador;"]}