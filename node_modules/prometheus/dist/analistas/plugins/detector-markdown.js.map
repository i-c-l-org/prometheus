{"version":3,"file":"detector-markdown.js","sourceRoot":"","sources":["../../../src/analistas/plugins/detector-markdown.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\n// @prometheus-disable PROBLEMA_PERFORMANCE\n// Justificativa: detector que processa código - loops são esperados\n/**\n * @fileoverview Detector de problemas em arquivos Markdown\n *\n * Verifica compliance de licenças, proveniência e referências em documentação.\n * Migrado de: scripts/scan-markdown.mjs\n * Data: 2025-11-02\n *\n * Funcionalidades:\n * - Detecta licenças incompatíveis (GPL, AGPL, CC-BY, etc)\n * - Verifica presença de aviso de proveniência\n * - Identifica referências de risco (Stack Overflow, cessão de direitos)\n * - Whitelist configurável para documentos de política\n */\n\nimport { promises as fs } from 'node:fs';\n\nimport { config } from '@core/config/config.js';\nimport { log } from '@core/messages/index.js';\n\nimport type { ContextoExecucao, Ocorrencia, ReportEvent } from '@';\n\nimport type { MarkdownAnaliseArquivo, MarkdownDetectorOptions, MarkdownLicensePatterns, MarkdownProblema, MarkdownWhitelistConfig } from '../../types/analistas/markdown.js';\n\n/**\n * Padrões de licenças e cessões problemáticas\n */\nconst LICENCA_PADROES: MarkdownLicensePatterns = {\n  incompativeis: [/\\bGPL\\b/i, /\\bAGPL\\b/i, /\\bLGPL\\b/i, /Creative\\s+Commons/i, /\\bCC-BY\\b/i, /All\\s+rights\\s+reserved/i],\n  cessaoDireitos: [/cess(?:ã|a)o\\s+de\\s+direitos/i, /transfer(?:ê|e)ncia\\s+de\\s+direitos/i],\n  referenciasRisco: [/Stack\\s*Overflow/i, /stackoverflow\\.com/i, /\\bassign\\b/i, /\\bcession\\b/i]\n};\n\n/**\n * Whitelist padrão de arquivos\n */\nconst PADRAO_LISTA_BRANCA: MarkdownWhitelistConfig = {\n  paths: ['.github/copilot-instructions.md', 'docs/POLICY-PROVENIENCIA.md', 'docs/partials/AVISO-PROVENIENCIA.md'],\n  patterns: ['**/relatorios/**', 'docs/historico/**', 'tests/**', 'tmp*.md'],\n  dirs: ['pre-public', 'preview-prometheus', '.abandonados', '.deprecados', 'relatorios']\n};\n\n/**\n * Cria regex combinado de todos os padrões de risco\n */\nfunction createRiskRegex(): RegExp {\n  const allPadroes = [...LICENCA_PADROES.incompativeis, ...LICENCA_PADROES.cessaoDireitos, ...LICENCA_PADROES.referenciasRisco].map(r => r.source).join('|');\n  return new RegExp(allPadroes, 'i');\n}\n\n/**\n * Verifica se arquivo tem aviso de proveniência\n */\nfunction hasProvenienciaHeader(content: string, headerLines = 30): boolean {\n  const head = content.split(/\\r?\\n/).slice(0, headerLines).join('\\n');\n  return /Proveni[eê]ncia\\s+e\\s+Autoria/i.test(head);\n}\n\n/**\n * Verifica se arquivo está na whitelist\n */\nfunction isWhitelisted(relPath: string, whitelist: MarkdownWhitelistConfig): boolean {\n  const normalized = relPath.replace(/\\\\/g, '/');\n\n  // Paths exatos\n  if (whitelist.paths.some((p: string) => normalized === p || normalized.endsWith(`/${p}`))) {\n    return true;\n  }\n\n  // Diretórios\n  if (whitelist.dirs.some((dir: string) => normalized.startsWith(`${dir}/`))) {\n    return true;\n  }\n\n  // Patterns (simplificado - sem glob completo)\n  for (const pattern of whitelist.patterns) {\n    if (pattern.includes('**')) {\n      const parts = pattern.split('**');\n      if (parts.every((part: string) => normalized.includes(part.replace(/\\*/g, '')))) {\n        return true;\n      }\n    } else if (pattern.startsWith('*')) {\n      if (normalized.endsWith(pattern.substring(1))) {\n        return true;\n      }\n    } else if (pattern.includes('*')) {\n      const [prefix, suffix] = pattern.split('*');\n      if (normalized.startsWith(prefix) && normalized.endsWith(suffix)) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\n/**\n * Verifica se tem marcador de risco aprovado\n */\nfunction hasRiskReferenceMarker(content: string): boolean {\n  return /<!--\\s*RISCO_REFERENCIA_OK\\s*-->/i.test(content);\n}\nfunction hasPrometheusIgnoreMarker(content: string, key: string): boolean {\n  // Ex.: <!-- prometheus-ignore: license-check -->\n  const escaped = key.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  return new RegExp(`<!--\\\\s*prometheus-ignore\\\\s*:\\\\s*${escaped}\\\\s*-->`, 'i').test(content);\n}\nfunction mergeWhitelist(base: MarkdownWhitelistConfig, override: Partial<MarkdownWhitelistConfig> | undefined, mode: 'merge' | 'replace'): MarkdownWhitelistConfig {\n  const o = override || {};\n  if (mode === 'replace') {\n    return {\n      paths: Array.isArray(o.paths) ? o.paths : [],\n      patterns: Array.isArray(o.patterns) ? o.patterns : [],\n      dirs: Array.isArray(o.dirs) ? o.dirs : []\n    };\n  }\n  const uniq = (arr: string[]) => Array.from(new Set(arr.map(String)));\n  const opaths = Array.isArray(o.paths) ? o.paths : [];\n  const opatterns = Array.isArray(o.patterns) ? o.patterns : [];\n  const odirs = Array.isArray(o.dirs) ? o.dirs : [];\n  return {\n    paths: uniq([...(base.paths || []), ...opaths]),\n    patterns: uniq([...(base.patterns || []), ...opatterns]),\n    dirs: uniq([...(base.dirs || []), ...odirs])\n  };\n}\n\n/**\n * Verifica se o único termo de risco é do aviso de proveniência\n */\nfunction isBenignProvenienciaOnly(content: string): boolean {\n  const rxCessao = /cess(?:ã|a)o\\s+de\\s+direitos/i;\n  const rxOthers = new RegExp(['\\\\bGPL\\\\b', '\\\\bAGPL\\\\b', '\\\\bLGPL\\\\b', 'Creative\\\\s+Commons', '\\\\bCC-BY\\\\b', 'Stack\\\\s*Overflow', 'stackoverflow\\\\.com', 'All\\\\s+rights\\\\s+reserved', 'transfer(?:ê|e)ncia\\\\s+de\\\\s+direitos', '\\\\bassign\\\\b', '\\\\bcession\\\\b'].join('|'), 'i');\n  const hasCessao = rxCessao.test(content);\n  const hasOthers = rxOthers.test(content);\n  const hasAviso = /Proveni[eê]ncia\\s+e\\s+Autoria/i.test(content);\n  return hasAviso && hasCessao && !hasOthers;\n}\n\n/**\n * Analisa um arquivo Markdown\n */\nasync function analisarArquivoMarkdown(fullCaminho: string, relPath: string, options: MarkdownDetectorOptions): Promise<MarkdownAnaliseArquivo> {\n  const whitelist = options.whitelist || PADRAO_LISTA_BRANCA;\n  const problemas: MarkdownProblema[] = [];\n  let content: string;\n  try {\n    content = await fs.readFile(fullCaminho, 'utf-8');\n  } catch (error) {\n    return {\n      relPath,\n      fullCaminho,\n      problemas: [{\n        tipo: 'formato-invalido',\n        descricao: `Erro ao ler arquivo: ${(error as Error).message}`,\n        severidade: 'medio'\n      }],\n      temProveniencia: false,\n      whitelisted: false,\n      temRiscoOk: false\n    };\n  }\n  const whitelisted = isWhitelisted(relPath, whitelist);\n  const temRiscoOk = hasRiskReferenceMarker(content);\n  const temProveniencia = hasProvenienciaHeader(content, options.headerLines || 30);\n  const ignoreLicencaCheck = hasPrometheusIgnoreMarker(content, 'license-check');\n\n  // Verificar proveniência\n  if (options.checkProveniencia !== false && !temProveniencia && !whitelisted) {\n    problemas.push({\n      tipo: 'falta-proveniencia',\n      descricao: 'Arquivo não possui aviso de Proveniência e Autoria nas primeiras linhas',\n      severidade: 'alto',\n      sugestao: 'Adicione o aviso usando scripts/add-disclaimer-md.js'\n    });\n  }\n\n  // Verificar licenças e referências\n  if (options.checkLicenses !== false || options.checkReferences !== false) {\n    const riskRegex = createRiskRegex();\n    const hasRisk = riskRegex.test(content);\n    if (hasRisk && !isBenignProvenienciaOnly(content) && !whitelisted && !temRiscoOk) {\n      // Identificar problemas específicos\n      const lines = content.split(/\\r?\\n/);\n      for (let i = 0; i < lines.length; i++) {\n        const line = lines[i];\n\n        // Verificar licenças incompatíveis\n        if (options.checkLicenses !== false && !ignoreLicencaCheck) {\n          for (const pattern of LICENCA_PADROES.incompativeis) {\n            if (pattern.test(line)) {\n              problemas.push({\n                tipo: 'licenca-incompativel',\n                descricao: `Licença potencialmente incompatível: ${pattern.source}`,\n                severidade: 'critico',\n                linha: i + 1,\n                trecho: line.trim().substring(0, 100),\n                sugestao: 'Verifique compatibilidade com licença MIT do projeto'\n              });\n            }\n          }\n        }\n\n        // Verificar cessão de direitos\n        if (options.checkReferences !== false) {\n          for (const pattern of LICENCA_PADROES.cessaoDireitos) {\n            if (pattern.test(line)) {\n              problemas.push({\n                tipo: 'referencia-risco',\n                descricao: 'Referência a cessão de direitos detectada',\n                severidade: 'alto',\n                linha: i + 1,\n                trecho: line.trim().substring(0, 100),\n                sugestao: 'Verifique se não há implicações legais'\n              });\n            }\n          }\n\n          // Verificar referências externas\n          for (const pattern of LICENCA_PADROES.referenciasRisco) {\n            if (pattern.test(line)) {\n              problemas.push({\n                tipo: 'referencia-risco',\n                descricao: `Referência externa detectada: ${pattern.source}`,\n                severidade: 'medio',\n                linha: i + 1,\n                trecho: line.trim().substring(0, 100),\n                sugestao: 'Adicione marcador <!-- RISCO_REFERENCIA_OK --> se referência for válida'\n              });\n            }\n          }\n        }\n      }\n    }\n  }\n  return {\n    relPath,\n    fullCaminho,\n    problemas,\n    temProveniencia,\n    whitelisted,\n    temRiscoOk\n  };\n}\n\n/**\n * Converte análise para ocorrências do Prometheus\n */\nfunction converterParaOcorrencias(analise: MarkdownAnaliseArquivo): Ocorrencia[] {\n  const ocorrencias: Ocorrencia[] = [];\n  for (const problema of analise.problemas) {\n    let nivel: 'erro' | 'aviso' | 'info';\n    switch (problema.severidade) {\n      case 'critico':\n      case 'alto':\n        nivel = 'erro';\n        break;\n      case 'medio':\n        nivel = 'aviso';\n        break;\n      default:\n        nivel = 'info';\n    }\n    ocorrencias.push({\n      tipo: `markdown-${problema.tipo}`,\n      nivel,\n      mensagem: problema.descricao,\n      relPath: analise.relPath,\n      linha: problema.linha,\n      contexto: problema.trecho,\n      sugestao: problema.sugestao\n    });\n  }\n  return ocorrencias;\n}\n\n/**\n * Detector de problemas em Markdown\n */\nexport const detectorMarkdown = {\n  nome: 'detector-markdown',\n  categoria: 'documentacao',\n  descricao: 'Detecta problemas de compliance em arquivos Markdown',\n  test: (relPath: string): boolean => {\n    return relPath.toLowerCase().endsWith('.md');\n  },\n  aplicar: async (src: string, relPath: string, _ast: unknown, fullCaminho?: string, contexto?: ContextoExecucao): Promise<Ocorrencia[]> => {\n    if (!fullCaminho) {\n      const ev = {\n        tipo: 'detector-markdown-missing-path',\n        nivel: 'aviso' as const,\n        mensagem: `detector-markdown: fullPath não fornecido para ${relPath}`,\n        relPath\n      };\n      if (contexto && typeof contexto.report === 'function') {\n        try {\n          contexto.report(ev as unknown as ReportEvent);\n        } catch {\n          log.aviso(ev.mensagem);\n        }\n      } else if (typeof (log as unknown as { aviso?: Function })?.aviso === 'function') {\n        (log as unknown as { aviso?: Function }).aviso?.(ev.mensagem);\n      }\n      return [];\n    }\n    const cfg = (config as unknown as {\n      detectorMarkdown?: unknown;\n    }).detectorMarkdown as {\n      checkProveniencia?: boolean;\n      checkLicenses?: boolean;\n      checkReferences?: boolean;\n      headerLines?: number;\n      whitelist?: Partial<MarkdownWhitelistConfig>;\n      whitelistMode?: 'merge' | 'replace';\n    } | undefined;\n    const whitelistMode: 'merge' | 'replace' = cfg?.whitelistMode === 'replace' || cfg?.whitelistMode === 'merge' ? cfg.whitelistMode : 'merge';\n    const options: MarkdownDetectorOptions = {\n      checkProveniencia: cfg?.checkProveniencia ?? true,\n      checkLicenses: cfg?.checkLicenses ?? true,\n      checkReferences: cfg?.checkReferences ?? true,\n      headerLines: typeof cfg?.headerLines === 'number' ? cfg.headerLines : 30,\n      whitelist: mergeWhitelist(PADRAO_LISTA_BRANCA, cfg?.whitelist, whitelistMode)\n    };\n    try {\n      const analise = await analisarArquivoMarkdown(fullCaminho, relPath, options);\n      return converterParaOcorrencias(analise);\n    } catch (error) {\n      const ev = {\n        tipo: 'detector-markdown-erro',\n        nivel: 'erro' as const,\n        mensagem: `Erro ao analisar Markdown ${relPath}: ${(error as Error).message}`,\n        relPath\n      };\n      if (contexto && typeof contexto.report === 'function') {\n        try {\n          contexto.report(ev as unknown as ReportEvent);\n        } catch {\n          (log as unknown as { erro?: Function }).erro?.(ev.mensagem);\n        }\n      } else {\n        (log as unknown as { erro?: Function }).erro?.(ev.mensagem);\n      }\n      return [];\n    }\n  }\n};\n\n/**\n * Exporta função de análise standalone para uso em outros módulos\n */\nexport { analisarArquivoMarkdown };"]}