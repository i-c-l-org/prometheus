{"version":3,"file":"sugestoes-contextuais.js","sourceRoot":"","sources":["../../../src/analistas/estrategistas/sugestoes-contextuais.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\n/**\n * Analista de Sugestões Contextuais Inteligentes\n *\n * Utiliza o sistema de detecção contextual para gerar sugestões específicas\n * baseadas no tipo real de projeto detectado, considerando:\n * - Dependências e configurações\n * - Padrões de código específicos\n * - Estrutura e nomenclatura\n * - Melhores práticas por tecnologia\n */\n\nimport { detectarContextoInteligente } from '@analistas/detectores/detector-contexto-inteligente.js';\nimport type { NodePath } from '@babel/traverse';\nimport type { Node } from '@babel/types';\nimport { log } from '@core/messages/index.js';\nimport { SugestoesContextuaisMensagens } from '@core/messages/ui/sugestoes-contextuais-messages.js';\n\nimport type { Analista, ContextoExecucao, Ocorrencia, PackageJson, ReportEvent } from '@';\n\nexport const analistaSugestoesContextuais: Analista = {\n  nome: 'sugestoes-contextuais',\n  categoria: 'estrategia',\n  descricao: 'Gera sugestões específicas baseadas no contexto real do projeto detectado',\n  global: true,\n  // Analisa contexto global do projeto\n\n  async aplicar(_src: string, _relPath: string, _ast: NodePath<Node> | null,\n    // AST node path\n    _fullPath?: string, contexto?: ContextoExecucao): Promise<Ocorrencia[]> {\n    const ocorrencias: Ocorrencia[] = [];\n    if (!contexto) {\n      return ocorrencias;\n    }\n    try {\n      // Obter package.json se disponível\n      let packageJson: PackageJson | undefined;\n      try {\n        const pkgArquivo = contexto.arquivos.find(f => f.relPath === 'package.json');\n        if (pkgArquivo?.content) {\n          packageJson = JSON.parse(pkgArquivo.content);\n        }\n      } catch {\n        // Ignorar erros de parsing do package.json\n      }\n\n      // Extrair estrutura de diretórios dos arquivos\n      const estruturaDetectada = Array.from(new Set(contexto.arquivos.map(f => f.relPath.includes('/') ? f.relPath.split('/')[0] : '').filter(dir => dir && dir !== '.')));\n\n      // Executar detecção contextual inteligente\n      const resultados = detectarContextoInteligente(estruturaDetectada, contexto.arquivos, packageJson);\n      if (resultados.length === 0) {\n        ocorrencias.push({\n          tipo: 'sugestoes_arquitetura',\n          nivel: 'info',\n          mensagem: SugestoesContextuaisMensagens.arquetipoNaoIdentificado,\n          relPath: '',\n          linha: 0\n        });\n        return ocorrencias;\n      }\n      const melhorResultado = resultados[0];\n      const confiancaPercent = Math.round(melhorResultado.confiancaTotal * 100);\n\n      // Gerar ocorrência principal com identificação\n      ocorrencias.push({\n        tipo: 'identificacao_projeto',\n        nivel: 'info',\n        mensagem: SugestoesContextuaisMensagens.projetoIdentificado(melhorResultado.tecnologia, confiancaPercent),\n        relPath: '',\n        linha: 0,\n        detalhes: {\n          tecnologia: melhorResultado.tecnologia,\n          confianca: melhorResultado.confiancaTotal,\n          evidencias: melhorResultado.evidencias.length\n        }\n      });\n\n      // Gerar sugestões de melhorias\n      for (const sugestao of melhorResultado.sugestoesMelhoria || []) {\n        ocorrencias.push({\n          tipo: 'sugestao_melhoria',\n          nivel: 'info',\n          mensagem: sugestao,\n          relPath: '',\n          linha: 0,\n          detalhes: {\n            tecnologia: melhorResultado.tecnologia,\n            categoria: 'melhoria'\n          }\n        });\n      }\n\n      // Gerar alertas de problemas\n      for (const problema of melhorResultado.problemasDetectados || []) {\n        ocorrencias.push({\n          tipo: 'problema_seguranca',\n          nivel: 'aviso',\n          mensagem: problema,\n          relPath: '',\n          linha: 0,\n          detalhes: {\n            tecnologia: melhorResultado.tecnologia,\n            categoria: 'problema'\n          }\n        });\n      }\n\n      // Gerar ocorrências para evidências mais relevantes\n      const evidenciasTop = melhorResultado.evidencias.filter(e => e.confianca > 0.8).slice(0, 5); // Top 5 evidências\n\n      for (const evidencia of evidenciasTop) {\n        let mensagem = '';\n        const nivel: 'info' | 'aviso' | 'erro' = 'info';\n        switch (evidencia.tipo) {\n          case 'dependencia':\n            mensagem = SugestoesContextuaisMensagens.evidenciaDependencia(evidencia.valor, melhorResultado.tecnologia);\n            break;\n          case 'import':\n            mensagem = SugestoesContextuaisMensagens.evidenciaImport(evidencia.valor, evidencia.localizacao);\n            break;\n          case 'codigo':\n            mensagem = SugestoesContextuaisMensagens.evidenciaCodigo(evidencia.localizacao);\n            break;\n          case 'estrutura':\n            mensagem = SugestoesContextuaisMensagens.evidenciaEstrutura(evidencia.valor, melhorResultado.tecnologia);\n            break;\n          default:\n            continue;\n          // Pular outros tipos menos relevantes\n        }\n        ocorrencias.push({\n          tipo: 'evidencia_contextual',\n          nivel,\n          mensagem,\n          relPath: evidencia.localizacao || '',\n          linha: 0,\n          detalhes: {\n            tecnologia: melhorResultado.tecnologia,\n            tipoEvidencia: evidencia.tipo,\n            confianca: evidencia.confianca\n          }\n        });\n      }\n\n      // Se houver múltiplas tecnologias detectadas, mostrar alternativas\n      if (resultados.length > 1) {\n        const alternativas = resultados.slice(1, 3).map(r => `${r.tecnologia} (${Math.round(r.confiancaTotal * 100)}%)`).join(', ');\n        ocorrencias.push({\n          tipo: 'tecnologias_alternativas',\n          nivel: 'info',\n          mensagem: SugestoesContextuaisMensagens.tecnologiasAlternativas(alternativas),\n          relPath: '',\n          linha: 0,\n          detalhes: {\n            alternativas: resultados.slice(1, 3)\n          }\n        });\n      }\n    } catch (error) {\n      const mensagem = SugestoesContextuaisMensagens.erroAnaliseContextual(error instanceof Error ? error.message : String(error));\n      const ev: ReportEvent = {\n        tipo: 'sugestoes-contextuais-erro',\n        nivel: 'aviso',\n        mensagem,\n        relPath: ''\n      };\n      if (contexto && typeof contexto.report === 'function') {\n        try {\n          contexto.report(ev);\n        } catch {\n          log.aviso(mensagem);\n        }\n      } else {\n        log.aviso(mensagem);\n        ocorrencias.push({\n          tipo: 'erro_analise',\n          nivel: 'aviso',\n          mensagem: SugestoesContextuaisMensagens.erroDuranteAnalise,\n          relPath: '',\n          linha: 0\n        });\n      }\n    }\n    return ocorrencias;\n  }\n};"]}