{"version":3,"file":"arquetipos-personalizados.js","sourceRoot":"","sources":["../../../src/analistas/js-ts/arquetipos-personalizados.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\n// @prometheus-disable tipo-literal-inline-complexo\n// Justificativa: tipos locais para arqu√©tipos personalizados\n/**\n * Sistema de Arqu√©tipos Personalizados do Prometheus\n *\n * Permite que usu√°rios criem arqu√©tipos personalizados para seus projetos,\n * mantendo compatibilidade com arqu√©tipos oficiais e oferecendo sugest√µes\n * de melhores pr√°ticas baseadas na personaliza√ß√£o do usu√°rio.\n */\n\nimport { promises as fs } from 'node:fs';\nimport path from 'node:path';\n\nimport { ARQUETIPOS } from '@analistas/estrategistas/arquetipos-defs.js';\n// NOTA: parseFileAST ainda n√£o foi implementado no m√≥dulo de parsing\n// import { parseFileAST } from '@core/parsing/parser.js';\nimport { log } from '@core/messages/index.js';\nimport { PROMETHEUS_ARQUIVOS } from '@core/registry/paths.js';\nimport { lerEstado, salvarEstado } from '@shared/persistence/persistencia.js';\n\nimport type { ArquetipoEstruturaDef, ArquetipoPersonalizado } from '@';\n\n// Nome do arquivo legado (para compatibilidade)\nconst ARQUETIPO_PERSONALIZADO_FILENAME = 'prometheus.repo.arquetipo.json';\n\n/**\n * Carrega o arqu√©tipo personalizado do projeto atual\n * Tenta primeiro o novo caminho (.prometheus/estrutura.arquetipo.json),\n * depois o legado (raiz/prometheus.repo.arquetipo.json)\n */\n\nexport async function carregarArquetipoPersonalizado(baseDir: string = process.cwd()): Promise<ArquetipoPersonalizado | null> {\n  // Tentar novo caminho primeiro\n  const novoCaminho = PROMETHEUS_ARQUIVOS.ESTRUTURA_ARQUETIPO;\n  const caminhoLegado = path.join(baseDir, ARQUETIPO_PERSONALIZADO_FILENAME);\n  try {\n    // Tenta novo caminho\n    const arquetipo = await lerEstado<ArquetipoPersonalizado | null>(novoCaminho, null);\n    if (arquetipo && arquetipo.nome && arquetipo.arquetipoOficial) {\n      return arquetipo;\n    }\n\n    // Se n√£o encontrou no novo caminho, tenta o legado\n    const arquetipoLegado = await lerEstado<ArquetipoPersonalizado | null>(caminhoLegado, null);\n\n    // Valida√ß√£o b√°sica\n    if (!arquetipoLegado || !arquetipoLegado.nome || !arquetipoLegado.arquetipoOficial) {\n      // Reduz ru√≠do em testes e quando n√£o estiver em modo verbose\n      const isTest = (process.env.VITEST ?? '') !== '';\n      const isVerbose = (log as unknown as {\n        verbose?: boolean;\n      }).verbose || false;\n      if (!isTest && isVerbose) {\n        log.aviso(`‚ö†Ô∏è Arqu√©tipo personalizado n√£o encontrado em ${novoCaminho} nem ${caminhoLegado}`);\n      }\n      return null;\n    }\n    return arquetipoLegado;\n  } catch {\n    // Arquivo n√£o existe ou √© inv√°lido - isso √© normal\n    return null;\n  }\n}\n/**\n * Salva o arqu√©tipo personalizado do projeto atual\n * Usa o novo caminho (.prometheus/estrutura.arquetipo.json)\n */\nexport async function salvarArquetipoPersonalizado(arquetipo: Omit<ArquetipoPersonalizado, 'metadata'>, _baseDir: string = process.cwd()): Promise<void> {\n  const arquetipoCompleto: ArquetipoPersonalizado = {\n    ...arquetipo,\n    metadata: {\n      criadoEm: new Date().toISOString(),\n      versao: '1.0.0',\n      notasUsuario: undefined\n    }\n  };\n\n  // Usar novo caminho centralizado\n  const novoCaminho = PROMETHEUS_ARQUIVOS.ESTRUTURA_ARQUETIPO;\n\n  // Garantir que o diret√≥rio .prometheus existe\n  const prometheusDir = path.dirname(novoCaminho);\n  try {\n    await fs.mkdir(prometheusDir, {\n      recursive: true\n    });\n  } catch {\n    // Diret√≥rio j√° existe\n  }\n  await salvarEstado(novoCaminho, arquetipoCompleto);\n  log.sucesso(`‚úÖ Arqu√©tipo personalizado salvo em ${novoCaminho}`);\n}\n\n/**\n * Verifica se existe um arqu√©tipo personalizado\n * Verifica tanto o novo caminho quanto o legado\n */\n\nexport async function existeArquetipoPersonalizado(baseDir: string = process.cwd()): Promise<boolean> {\n  // Verificar novo caminho primeiro\n  try {\n    await fs.access(PROMETHEUS_ARQUIVOS.ESTRUTURA_ARQUETIPO);\n    return true;\n  } catch {\n    // Tentar caminho legado\n    const arquivoArquetipo = path.join(baseDir, ARQUETIPO_PERSONALIZADO_FILENAME);\n    try {\n      await fs.access(arquivoArquetipo);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n}\n\n/**\n * Obt√©m o arqu√©tipo oficial base para um arqu√©tipo personalizado\n */\n\nexport function obterArquetipoOficial(arquetipoPersonalizado: ArquetipoPersonalizado): ArquetipoEstruturaDef | null {\n  return ARQUETIPOS.find(arq => (arq as unknown as ArquetipoEstruturaDef).nome === arquetipoPersonalizado.arquetipoOficial) as ArquetipoEstruturaDef | undefined || null;\n}\n\n/**\n * Gera sugest√µes de cria√ß√£o de arqu√©tipo personalizado quando projeto √© desconhecido\n */\n\nexport function gerarSugestaoArquetipoPersonalizado(projetoDesconhecido: {\n  nome: string;\n  estruturaDetectada: string[];\n  arquivosRaiz: string[];\n}): string {\n  const sugestao = `\nüåü Projeto personalizado detectado: \"${projetoDesconhecido.nome}\"\n\nO Prometheus identificou uma estrutura de projeto que n√£o corresponde a arqu√©tipos oficiais,\nmas voc√™ pode criar um arqu√©tipo personalizado para receber sugest√µes otimizadas!\n\nüìÅ Estrutura detectada:\n${projetoDesconhecido.estruturaDetectada.map(dir => `  ‚Ä¢ ${dir}`).join('\\n')}\n\nüìÑ Arquivos na raiz:\n${projetoDesconhecido.arquivosRaiz.slice(0, 5).map(file => `  ‚Ä¢ ${file}`).join('\\n')}\n${projetoDesconhecido.arquivosRaiz.length > 5 ? `  ‚Ä¢ ... e mais ${projetoDesconhecido.arquivosRaiz.length - 5} arquivos` : ''}\n\nüí° Para criar seu arqu√©tipo personalizado, execute:\n   prometheus diagnosticar --criar-arquetipo\n\nIsso criar√° um arquivo 'prometheus.repo.arquetipo.json' com base na estrutura atual,\nque o Prometheus usar√° para oferecer sugest√µes personalizadas mantendo as melhores pr√°ticas.\n`;\n  return sugestao;\n}\n\n/**\n * Cria um template de arqu√©tipo personalizado baseado na estrutura atual do projeto\n */\n\nexport function criarTemplateArquetipoPersonalizado(nomeProjeto: string, estruturaDetectada: string[], arquivosRaiz: string[], arquetipoSugerido: string = 'generico'): Omit<ArquetipoPersonalizado, 'metadata'> {\n  // Usa o arqu√©tipo sugerido pelo sistema de detec√ß√£o inteligente\n  // Se n√£o foi fornecido, tenta inferir de forma mais rigorosa\n  let arquetipoOficial = arquetipoSugerido;\n  if (arquetipoOficial === 'generico' || !arquetipoOficial) {\n    // Heur√≠stica mais rigorosa para evitar falsos positivos\n\n    // CLI: precisa ter bin/ E (cli/ OU commands/) E package.json com bin\n    const temBin = estruturaDetectada.some(dir => dir === 'bin' || dir.startsWith('bin/'));\n    const temCli = estruturaDetectada.some(dir => dir.includes('/cli') || dir === 'cli');\n    const temCommands = estruturaDetectada.some(dir => dir.includes('/commands') || dir === 'commands');\n    if (temBin && (temCli || temCommands)) {\n      arquetipoOficial = 'cli-modular';\n    }\n    // Bot: precisa ter src/bot/ E (events/ OU scenes/) - muito espec√≠fico\n    else if (estruturaDetectada.some(dir => dir === 'src/bot' || dir.startsWith('src/bot/')) && estruturaDetectada.some(dir => dir.includes('events') || dir.includes('scenes'))) {\n      arquetipoOficial = 'bot';\n    }\n    // API: precisa ter controllers/ E routes/\n    else if (estruturaDetectada.some(dir => dir.includes('controllers')) && estruturaDetectada.some(dir => dir.includes('routes'))) {\n      arquetipoOficial = 'api-rest-express';\n    }\n    // Fullstack: precisa ter pages/ E api/ (ambos)\n    else if (estruturaDetectada.some(dir => dir.includes('pages')) && estruturaDetectada.some(dir => dir.includes('api'))) {\n      arquetipoOficial = 'fullstack';\n    }\n    // Fallback: lib-tsc se tem src/ organizado mas nenhum dos padr√µes acima\n    else if (estruturaDetectada.some(dir => dir === 'src' || dir.startsWith('src/'))) {\n      arquetipoOficial = 'lib-tsc';\n    }\n  }\n\n  // Identifica diret√≥rios principais (n√£o muito profundos)\n  const diretoriosPrincipais = estruturaDetectada.filter(dir => !dir.includes('/') || dir.split('/').length <= 2).filter(dir => !dir.startsWith('node_modules') && !dir.startsWith('.git'));\n\n  // Identifica arquivos-chave na raiz\n  const arquivosChave = arquivosRaiz.filter(file => ['package.json', 'tsconfig.json', 'README.md', '.env.example'].includes(file) || file.endsWith('.ts') || file.endsWith('.js')).slice(0, 5);\n  return {\n    nome: nomeProjeto,\n    descricao: `Projeto personalizado: ${nomeProjeto}`,\n    arquetipoOficial,\n    estruturaPersonalizada: {\n      diretorios: diretoriosPrincipais,\n      arquivosChave,\n      padroesNomenclatura: {\n        // Padr√µes comuns baseados na estrutura detectada\n        ...(estruturaDetectada.some(d => d.includes('components')) && {\n          components: '*-component.*'\n        }),\n        ...(estruturaDetectada.some(d => d.includes('utils')) && {\n          utils: '*-util.*'\n        }),\n        ...(estruturaDetectada.some(d => d.includes('test')) && {\n          tests: '*.test.*'\n        })\n      }\n    },\n    melhoresPraticas: {\n      recomendado: ['src/', 'tests/', 'docs/', 'README.md', '.env.example'],\n      evitar: ['temp/', 'cache/', '*.log'],\n      notas: ['Mantenha c√≥digo fonte organizado em src/', 'Separe testes em pasta dedicada', 'Documente APIs e funcionalidades importantes']\n    }\n  };\n}\n\n/**\n * Valida um arqu√©tipo personalizado\n */\n\nexport function validarArquetipoPersonalizado(arquetipo: ArquetipoPersonalizado): {\n  valido: boolean;\n  erros: string[];\n} {\n  const erros: string[] = [];\n  if (!arquetipo.nome || typeof arquetipo.nome !== 'string') {\n    erros.push('Nome do projeto √© obrigat√≥rio');\n  }\n  if (!arquetipo.arquetipoOficial || typeof arquetipo.arquetipoOficial !== 'string') {\n    erros.push('Arqu√©tipo oficial base √© obrigat√≥rio');\n  } else {\n    // Verifica se o arqu√©tipo oficial existe\n    const arquetipoOficial = ARQUETIPOS.find((arq: ArquetipoEstruturaDef) => arq.nome === arquetipo.arquetipoOficial) as ArquetipoEstruturaDef | undefined;\n    if (!arquetipoOficial) {\n      erros.push(`Arqu√©tipo oficial '${arquetipo.arquetipoOficial}' n√£o encontrado. Use: ${ARQUETIPOS.map(a => (a as unknown as ArquetipoEstruturaDef).nome).join(', ')}`);\n    }\n  }\n  if (!arquetipo.estruturaPersonalizada) {\n    erros.push('Estrutura personalizada √© obrigat√≥ria');\n  } else {\n    if (!Array.isArray(arquetipo.estruturaPersonalizada.diretorios)) {\n      erros.push('Diret√≥rios devem ser um array');\n    }\n    if (!Array.isArray(arquetipo.estruturaPersonalizada.arquivosChave)) {\n      erros.push('Arquivos-chave devem ser um array');\n    }\n  }\n  return {\n    valido: erros.length === 0,\n    erros\n  };\n}\n\n/**\n * Lista todos os arqu√©tipos oficiais dispon√≠veis\n */\n\nexport function listarArquetiposOficiais(): ArquetipoEstruturaDef[] {\n  return ARQUETIPOS;\n}\n\n/**\n * Integra arqu√©tipo personalizado com oficial para sugest√µes\n */\n\nexport function integrarArquetipos(personalizado: ArquetipoPersonalizado, oficial: ArquetipoEstruturaDef): ArquetipoEstruturaDef {\n  return {\n    ...oficial,\n    nome: personalizado.nome,\n    descricao: personalizado.descricao || oficial.descricao,\n    requiredDirs: personalizado.estruturaPersonalizada.diretorios,\n    optionalDirs: oficial.optionalDirs,\n    rootFilesAllowed: personalizado.estruturaPersonalizada.arquivosChave,\n    // Mant√©m outras propriedades do oficial como base\n    forbiddenDirs: oficial.forbiddenDirs,\n    dependencyHints: oficial.dependencyHints,\n    filePresencePatterns: oficial.filePresencePatterns,\n    pesoBase: oficial.pesoBase\n  };\n}"]}