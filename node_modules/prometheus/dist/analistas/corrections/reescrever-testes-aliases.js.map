{"version":3,"file":"reescrever-testes-aliases.js","sourceRoot":"","sources":["../../../src/analistas/corrections/reescrever-testes-aliases.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\n// @prometheus-disable tipo-literal-inline-complexo\n// Justificativa: tipos locais usados internamente para parsing de caminhos\nimport fsSync from 'node:fs';\nimport path from 'node:path';\n\nconst _TOP_DIRS = new Set(['analistas', 'arquitetos', 'cli', 'guardian', 'nucleo', 'relatorios', 'tipos', 'auto']);\nconst LEGADO_ALIAS_MAPA = new Map<string, string>();\nfunction toPosix(p: string): string {\n  return p.replace(/\\\\/g, '/');\n}\nfunction exists(p: string): boolean {\n  try {\n    return fsSync.existsSync(p);\n  } catch {\n    return false;\n  }\n}\nfunction pathFromAlias(aliasSpec: string, srcRoot: string): string {\n  const spec = aliasSpec.replace(/^@/, '');\n  const parts = spec.split('/');\n  const top = parts.shift();\n  return path.join(srcRoot, top ?? '', parts.join('/'));\n}\nexport function pickExtForAlias(aliasBase: string, srcRoot: string): string {\n  const absTs = pathFromAlias(`${aliasBase}.ts`, srcRoot);\n  const absJs = pathFromAlias(`${aliasBase}.js`, srcRoot);\n  if (exists(absTs)) return `${aliasBase}.ts`;\n  if (exists(absJs)) return `${aliasBase}.js`;\n  return `${aliasBase}.ts`;\n}\nexport function rewriteToAlias(spec: string, ctx: {\n  fileAbs: string;\n  scope?: string;\n  withinScope?: string;\n  srcRoot: string;\n}): {\n  changed: boolean;\n  value: string;\n} {\n  const posixSpec = toPosix(spec);\n  if (posixSpec.startsWith('@') || /^([a-zA-Z]+:|node:|[a-zA-Z0-9_-]+)$/.test(posixSpec)) {\n    if (!posixSpec.startsWith('@')) return {\n      changed: false,\n      value: spec\n    };\n    const withoutExt = posixSpec.replace(/\\.(ts|js|mjs|cjs|tsx|jsx)$/i, '');\n    let mapped = LEGADO_ALIAS_MAPA.get(withoutExt);\n    if (!mapped && withoutExt.startsWith('@cli/src/')) mapped = withoutExt;\n    if (mapped) {\n      const withExt = pickExtForAlias(mapped, ctx.srcRoot);\n      return {\n        changed: true,\n        value: withExt\n      };\n    }\n    return {\n      changed: false,\n      value: spec\n    };\n  }\n  return {\n    changed: false,\n    value: spec\n  };\n}\nexport function transformCodeForTests(code: string, ctx: {\n  fileAbs: string;\n  scope?: string;\n  withinScope?: string;\n  srcRoot: string;\n}): {\n  code: string;\n  changed: boolean;\n} {\n  let changed = false;\n  const rewrite = (spec: string) => rewriteToAlias(spec, ctx);\n  code = code.replace(/(import\\s+[^'\"\\n]+?from\\s+)([\"'])([^\"']+?)\\2/g, (m, p1, q, spec) => {\n    const result = rewrite(spec);\n    if (!result.changed) return m;\n    changed = true;\n    return `${p1}${q}${result.value}${q}`;\n  });\n  code = code.replace(/(import\\s*)([\"'])([^\"']+?)\\2/g, (m, p1, q, spec) => {\n    const result = rewrite(spec);\n    if (!result.changed) return m;\n    changed = true;\n    return `${p1}${q}${result.value}${q}`;\n  });\n  code = code.replace(/(import\\s*\\()(\\s*[\"'])([^\"']+?)([\"']\\s*\\))/g, (m, p1, q1, spec, q2) => {\n    const result = rewrite(spec);\n    if (!result.changed) return m;\n    changed = true;\n    return `${p1}${q1}${result.value}${q2}`;\n  });\n  code = code.replace(/(vi\\.(?:do)?mock\\s*\\()(\\s*[\"'])([^\"']+?)([\"'])(\\s*,?)/g, (m, p1, q1, spec, q2, comma = '') => {\n    const result = rewrite(spec);\n    if (!result.changed) return m;\n    changed = true;\n    return `${p1}${q1}${result.value}${q2}${comma}`;\n  });\n  return {\n    code,\n    changed\n  };\n}"]}