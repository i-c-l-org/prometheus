{"version":3,"file":"rule-config.js","sourceRoot":"","sources":["../../../src/shared/helpers/rule-config.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\n/**\n * Sistema de configuração granular de regras\n * Suporta:\n * - Regras por arquivo/diretório (glob patterns)\n * - Overrides específicos\n * - Severidade customizada\n * - Exclusões por padrão de arquivo\n */\n\nimport { config } from '@core/config/config.js';\nimport { minimatch } from 'minimatch';\n\nimport type { RuleConfig, RuleOverride } from '@';\n\nexport type { RuleConfig, RuleOverride };\n\n/**\n * Verifica se uma regra deve ser aplicada para um arquivo específico\n */\nexport function isRuleSuppressed(ruleName: string, fileCaminho: string): boolean {\n  // Normaliza o caminho do arquivo (remove ./ e normaliza barras)\n  const normalizedCaminho = fileCaminho.replace(/^\\.\\//, '').replace(/\\\\/g, '/');\n\n  // 1. Verifica suppressRules globais (config antigo - compatibilidade)\n  const configData = config as unknown as {\n    suppressRules?: string[];\n    rules?: Record<string, RuleConfig>;\n    testPadroes?: {\n      files?: string[];\n      allowAnyType?: boolean;\n    };\n  };\n  const suppressRules = configData.suppressRules;\n  if (suppressRules?.includes(ruleName)) {\n    return true;\n  }\n\n  // 2. Verifica config.rules (novo sistema)\n  const ruleConfiguracao = configData.rules?.[ruleName];\n  if (ruleConfiguracao) {\n    // Verifica se severity é 'off'\n    if (ruleConfiguracao.severity === 'off') {\n      return true;\n    }\n\n    // Verifica se arquivo está em exclude patterns\n    if (ruleConfiguracao.exclude) {\n      for (const pattern of ruleConfiguracao.exclude) {\n        if (minimatch(normalizedCaminho, pattern, {\n          dot: true\n        })) {\n          return true;\n        }\n      }\n    }\n\n    // Verifica allowTestFiles para arquivos de teste\n    if (ruleConfiguracao.allowTestFiles && isTestArquivo(normalizedCaminho, configData)) {\n      return true;\n    }\n  }\n\n  // 3. Verifica padrões de teste globais (para tipo-inseguro em testes)\n  if (ruleName === 'tipo-inseguro' || ruleName === 'tipo-inseguro-any') {\n    const testPadroes = configData.testPadroes;\n    if (testPadroes?.allowAnyType && isTestArquivo(normalizedCaminho, configData)) {\n      return true;\n    }\n  }\n  return false;\n} /**\n  * Verifica se um arquivo é de teste baseado nos padrões configurados\n  */\nfunction isTestArquivo(fileCaminho: string, configData: {\n  testPadroes?: {\n    files?: string[];\n  };\n}): boolean {\n  const testPadroes = configData.testPadroes?.files || ['**/*.test.*', '**/*.spec.*', 'test/**/*', 'tests/**/*', '**/__tests__/**'];\n  return testPadroes.some(pattern => minimatch(fileCaminho, pattern, {\n    dot: true\n  }));\n}\n\n/**\n * Obtém a severidade configurada para uma regra\n */\nexport function getRuleSeverity(ruleName: string, fileCaminho: string): 'error' | 'warning' | 'info' | undefined {\n  const configData = config as unknown as {\n    rules?: Record<string, RuleConfig>;\n  };\n  const ruleConfiguracao = configData.rules?.[ruleName];\n  if (!ruleConfiguracao) {\n    return undefined;\n  }\n\n  // Se regra está suprimida, retorna undefined\n  if (isRuleSuppressed(ruleName, fileCaminho)) {\n    return undefined;\n  }\n\n  // Mapeia severidades\n  if (ruleConfiguracao.severity === 'error') return 'error';\n  if (ruleConfiguracao.severity === 'warning') return 'warning';\n  if (ruleConfiguracao.severity === 'info') return 'info';\n  return undefined;\n}\n\n/**\n * Verifica se uma ocorrência deve ser suprimida baseado na configuração\n */\nexport function shouldSuppressOccurrence(tipo: string, fileCaminho: string, _severity?: string): boolean {\n  // Extrai o nome base da regra\n  // tipo-inseguro-any -> tipo-inseguro\n  // tipo-inseguro-any-assertion -> tipo-inseguro\n  // tipo-inseguro-any-cast -> tipo-inseguro\n  // tipo-inseguro-unknown -> tipo-inseguro\n  const baseRuleNome = tipo.replace(/-(any|unknown|assertion|cast).*$/, '');\n\n  // Verifica supressão para regra base e variantes\n  const rulesToCheck = [tipo, baseRuleNome];\n  return rulesToCheck.some(rule => isRuleSuppressed(rule, fileCaminho));\n}"]}