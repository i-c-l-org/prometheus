{"version":3,"file":"line-lookup.js","sourceRoot":"","sources":["../../../src/shared/helpers/line-lookup.ts"],"names":[],"mappings":"AAUA,MAAM,UAAU,gBAAgB,CAAC,GAAW;IAC1C,MAAM,cAAc,GAAa,EAAE,CAAC;IACpC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACpC,IAAI,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK,EAAE;YAAE,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IACvD,CAAC;IAED,MAAM,MAAM,GAAG,CAAC,KAAqB,EAAU,EAAE;QAC/C,IAAI,CAAC,KAAK,IAAI,KAAK,IAAI,CAAC;YAAE,OAAO,CAAC,CAAC;QACnC,MAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;QAGnD,IAAI,EAAE,GAAG,CAAC,CAAC;QACX,IAAI,EAAE,GAAG,cAAc,CAAC,MAAM,CAAC;QAC/B,OAAO,EAAE,GAAG,EAAE,EAAE,CAAC;YACf,MAAM,GAAG,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,CAAC;YAC5B,IAAI,cAAc,CAAC,GAAG,CAAC,GAAG,CAAC;gBAAE,EAAE,GAAG,GAAG,GAAG,CAAC,CAAC;;gBACrC,EAAE,GAAG,GAAG,CAAC;QAChB,CAAC;QACD,OAAO,EAAE,GAAG,CAAC,CAAC;IAChB,CAAC,CAAC;IAEF,OAAO,EAAE,MAAM,EAAE,CAAC;AACpB,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT-0\n\nexport type LineLookup = {\n  lineAt: (index?: number | null) => number;\n};\n\n/**\n * Cria uma função de consulta de linha (1-based) para um índice de string (0-based).\n * Otimiza casos com muitos `matchAll`/índices evitando `slice(0, i).split('\\n')`.\n */\nexport function createLineLookup(src: string): LineLookup {\n  const newlineIndexes: number[] = [];\n  for (let i = 0; i < src.length; i++) {\n    if (src.charCodeAt(i) === 10) newlineIndexes.push(i);\n  }\n\n  const lineAt = (index?: number | null): number => {\n    if (!index || index <= 0) return 1;\n    const i = Math.min(src.length, Math.max(0, index));\n\n    // upper_bound: quantidade de '\\n' com pos < i\n    let lo = 0;\n    let hi = newlineIndexes.length;\n    while (lo < hi) {\n      const mid = (lo + hi) >>> 1;\n      if (newlineIndexes[mid] < i) lo = mid + 1;\n      else hi = mid;\n    }\n    return lo + 1;\n  };\n\n  return { lineAt };\n}\n"]}