{"version":3,"file":"masking.js","sourceRoot":"","sources":["../../../src/shared/helpers/masking.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\n// Utilitários de mascaramento que preservam quebras de linha para manter o cálculo de linhas estável.\n\n/**\n * Mascara uma região de texto substituindo caracteres por espaços,\n * preservando quebras de linha para manter a contagem de linhas estável.\n * @param src - Texto fonte\n * @param start - Índice de início da região a mascarar\n * @param end - Índice de fim da região a mascarar\n * @returns Texto com a região mascarada\n */\nexport function maskKeepingNewlines(\n  src: string,\n  start: number,\n  end: number,\n): string {\n  const before = src.slice(0, start);\n  const mid = src.slice(start, end).replace(/[^\\n]/g, ' ');\n  const after = src.slice(end);\n  return before + mid + after;\n}\n\n/**\n * Mascara comentários JavaScript/TypeScript (bloco e linha),\n * preservando quebras de linha.\n * @param src - Código fonte JS/TS\n * @returns Código com comentários mascarados\n */\nexport function maskJsComments(src: string): string {\n  let out = src;\n\n  for (const m of out.matchAll(/\\/\\*[\\s\\S]*?\\*\\//g)) {\n    const start = m.index ?? -1;\n    if (start < 0) continue;\n    out = maskKeepingNewlines(out, start, start + m[0].length);\n  }\n\n  for (const m of out.matchAll(/(^|[^:])\\/\\/.*$/gm)) {\n    const start = (m.index ?? -1) + (m[1] ? m[1].length : 0);\n    if (start < 0) continue;\n    out = maskKeepingNewlines(\n      out,\n      start,\n      start + (m[0]?.length ?? 0) - (m[1] ? m[1].length : 0),\n    );\n  }\n\n  return out;\n}\n\n/**\n * Mascara comentários HTML (`<!-- -->`), preservando quebras de linha.\n * @param src - Código fonte HTML\n * @returns Código com comentários HTML mascarados\n */\nexport function maskHtmlComments(src: string): string {\n  let out = src;\n  for (const m of out.matchAll(/<!--([\\s\\S]*?)-->/g)) {\n    const start = m.index ?? -1;\n    if (start < 0) continue;\n    out = maskKeepingNewlines(out, start, start + m[0].length);\n  }\n  return out;\n}\n\n/**\n * Mascara blocos de tags HTML (script ou style) inteiros,\n * preservando quebras de linha.\n * @param src - Código fonte HTML\n * @param tag - Tag a mascarar ('script' ou 'style')\n * @returns Código com os blocos da tag mascarados\n */\nexport function maskTagBlocks(src: string, tag: 'script' | 'style'): string {\n  let out = src;\n  const re = new RegExp(`<${tag}\\\\b[^>]*>[\\\\s\\\\S]*?<\\\\/${tag}>`, 'gi');\n  for (const m of out.matchAll(re)) {\n    const start = m.index ?? -1;\n    if (start < 0) continue;\n    out = maskKeepingNewlines(out, start, start + m[0].length);\n  }\n  return out;\n}\n\n/**\n * Mascara conteúdo não-código em XML (comentários e seções CDATA),\n * preservando quebras de linha.\n * @param src - Código fonte XML\n * @returns Código com conteúdo não-código mascarado\n */\nexport function maskXmlNonCode(src: string): string {\n  let out = src;\n\n  for (const m of out.matchAll(/<!--[\\s\\S]*?-->/g)) {\n    const start = m.index ?? -1;\n    if (start < 0) continue;\n    out = maskKeepingNewlines(out, start, start + m[0].length);\n  }\n\n  for (const m of out.matchAll(/<!\\[CDATA\\[[\\s\\S]*?\\]\\]>/g)) {\n    const start = m.index ?? -1;\n    if (start < 0) continue;\n    out = maskKeepingNewlines(out, start, start + m[0].length);\n  }\n\n  return out;\n}\n\n/**\n * Mascara strings e comentários Python, preservando quebras de linha.\n * Trata strings triplas, strings simples e comentários com `#`.\n * @param src - Código fonte Python\n * @returns Código com strings e comentários mascarados\n */\nexport function maskPythonStringsAndComments(src: string): string {\n  let out = maskPythonComments(src);\n\n  for (const m of out.matchAll(/([ruRUfFbB]{0,3})(\"\"\"|''')[\\s\\S]*?\\2/g)) {\n    const start = m.index ?? -1;\n    if (start < 0) continue;\n    out = maskKeepingNewlines(out, start, start + m[0].length);\n  }\n\n  for (const m of out.matchAll(\n    /([ruRUfFbB]{0,3})(\"([^\"\\\\\\n]|\\\\.)*\"|'([^'\\\\\\n]|\\\\.)*')/g,\n  )) {\n    const start = m.index ?? -1;\n    if (start < 0) continue;\n    out = maskKeepingNewlines(out, start, start + m[0].length);\n  }\n\n  return out;\n}\n\n/**\n * Mascara comentários Python (linhas com `#`), preservando quebras de linha.\n * @param src - Código fonte Python\n * @returns Código com comentários mascarados\n */\nexport function maskPythonComments(src: string): string {\n  let out = src;\n\n  for (const m of out.matchAll(/(^|[^\\\\])#.*$/gm)) {\n    const start = (m.index ?? -1) + (m[1] ? m[1].length : 0);\n    if (start < 0) continue;\n    out = maskKeepingNewlines(\n      out,\n      start,\n      start + (m[0]?.length ?? 0) - (m[1] ? m[1].length : 0),\n    );\n  }\n\n  return out;\n}\n"]}