{"version":3,"file":"worker-pool.js","sourceRoot":"","sources":["../../../src/core/workers/worker-pool.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n// @prometheus-disable PROBLEMA_PERFORMANCE\n// Justificativa: worker pool que gerencia processamento paralelo - loops s√£o esperados\n/**\n * Sistema de Pool de Workers para Processamento Paralelo de Arquivos\n *\n * Permite processar m√∫ltiplos arquivos em paralelo usando Worker Threads,\n * melhorando a performance em projetos grandes com muitos arquivos.\n */\n\nimport * as os from 'node:os';\nimport * as path from 'node:path';\nimport { Worker } from 'node:worker_threads';\n\nimport { config } from '@core/config/config.js';\nimport { log } from '@core/messages/index.js';\n\nimport type { ContextoExecucao, FileEntryWithAst, MetricaAnalista, Ocorrencia, Tecnica, WorkerPoolOptions, WorkerResult, WorkerTask } from '@';\nimport { ocorrenciaErroAnalista } from '@';\n\n// Re-exporta os tipos para compatibilidade\nexport type { WorkerPoolOptions, WorkerResult, WorkerTask };\n\n/**\n * Pool de workers para processamento paralelo de arquivos\n */\nexport class WorkerPool {\n  private maxWorkers: number;\n  private batchSize: number;\n  private timeoutMs: number;\n  private enabled: boolean;\n  private activeWorkers = 0;\n  private results: WorkerResult[] = [];\n  private errors: string[] = [];\n  constructor(options: WorkerPoolOptions = {}) {\n    // Se o valor foi passado via options usa ele; se config define 0 usamos n¬∫ de CPUs\n    const configuredMax = options.maxWorkers ?? config.WORKER_POOL_MAX_WORKERS ?? 0;\n    this.maxWorkers = configuredMax > 0 ? configuredMax : Math.max(1, os.cpus().length);\n    this.batchSize = options.batchSize ?? 10;\n    // Timeout base vindo de op√ß√µes/config\n    let baseTempoLimite = options.timeoutMs ?? config.ANALISE_TIMEOUT_POR_ANALISTA_MS;\n    // Permite sobrescrever com vari√°vel de ambiente para ambientes de produ√ß√£o\n    const envCap = Number(process.env.PROMETHEUS_MAX_ANALYST_TIMEOUT_MS) || 0;\n    if (envCap > 0) {\n      baseTempoLimite = Math.min(baseTempoLimite, envCap);\n    } else if (process.env.NODE_ENV === 'production') {\n      // Em produ√ß√£o, por padr√£o, limitamos para n√£o exceder 10s salvo override expl√≠cito\n      baseTempoLimite = Math.min(baseTempoLimite, 10000);\n    }\n    this.timeoutMs = baseTempoLimite;\n    this.enabled = options.enabled ?? config.WORKER_POOL_ENABLED !== false;\n\n    // Verifica se Worker Threads est√£o dispon√≠veis\n    if (!this.enabled || !Worker) {\n      this.enabled = false;\n      log.info('Pool de workers desabilitado (Worker Threads n√£o dispon√≠vel)');\n    }\n  }\n\n  /**\n   * Processa arquivos usando pool de workers\n   */\n  async processFiles(files: FileEntryWithAst[], techniques: Tecnica[], context: ContextoExecucao): Promise<{\n    occurrences: Ocorrencia[];\n    metrics: MetricaAnalista[];\n    totalProcessed: number;\n    duration: number;\n  }> {\n    if (!this.enabled || files.length < this.batchSize) {\n      // Fallback para processamento sequencial\n      return this.processSequentially(files, techniques, context);\n    }\n    const startHora = performance.now();\n    const batches = this.createBatches(files);\n    const nonGlobalTechniques = techniques.filter(t => !t.global);\n    log.info(`üöÄ Iniciando processamento paralelo com ${this.maxWorkers} workers`);\n    log.info(`üì¶ ${batches.length} lotes de at√© ${this.batchSize} arquivos cada`);\n\n    // Processa lotes globais primeiro\n    const globalTechniques = techniques.filter(t => t.global);\n    if (globalTechniques.length > 0) {\n      await this.processGlobalTechniques(globalTechniques, context);\n    }\n\n    // Processa lotes de arquivos em paralelo\n    await this.processBatches(batches, nonGlobalTechniques, context);\n    const duration = performance.now() - startHora;\n    const totalOccurrences = this.results.reduce((sum, r) => sum + r.occurrences.length, 0);\n    const totalMetricas = this.results.flatMap(r => r.metrics);\n    log.info(`‚úÖ Processamento paralelo conclu√≠do em ${Math.round(duration)}ms`);\n    log.info(`üìä ${this.results.length} workers, ${files.length} arquivos, ${totalOccurrences} ocorr√™ncias`);\n    return {\n      occurrences: this.results.flatMap(r => r.occurrences),\n      metrics: totalMetricas,\n      totalProcessed: files.length,\n      duration\n    };\n  }\n\n  /**\n   * Cria lotes de arquivos para processamento paralelo\n   */\n  private createBatches(files: FileEntryWithAst[]): FileEntryWithAst[][] {\n    const batches: FileEntryWithAst[][] = [];\n    for (let i = 0; i < files.length; i += this.batchSize) {\n      batches.push(files.slice(i, i + this.batchSize));\n    }\n    return batches;\n  }\n\n  /**\n   * Processa t√©cnicas globais (n√£o paraleliz√°veis)\n   */\n  private async processGlobalTechniques(techniques: Tecnica[], context: ContextoExecucao): Promise<void> {\n    for (const technique of techniques) {\n      try {\n        const startHora = performance.now();\n        const result = await this.executeTechniqueWithTimeout(technique, '',\n        // conte√∫do vazio para t√©cnicas globais\n        '[global]', null,\n        // sem AST\n        undefined,\n        // sem fullPath\n        context);\n        if (result) {\n          const occurrences = Array.isArray(result) ? result : [result];\n          this.results.push({\n            workerId: -1,\n            // ID especial para global\n            occurrences,\n            metrics: [{\n              nome: technique.nome || 'global',\n              duracaoMs: performance.now() - startHora,\n              ocorrencias: occurrences.length,\n              global: true\n            }],\n            processedArquivos: 0,\n            errors: [],\n            duration: performance.now() - startHora\n          });\n        }\n      } catch (error) {\n        const err = error as Error;\n        this.errors.push(`Erro em t√©cnica global '${technique.nome}': ${err.message}`);\n        this.results.push({\n          workerId: -1,\n          occurrences: [ocorrenciaErroAnalista({\n            mensagem: `Falha na t√©cnica global '${technique.nome}': ${err.message}`,\n            relPath: '[execu√ß√£o global]',\n            origem: technique.nome\n          })],\n          metrics: [],\n          processedArquivos: 0,\n          errors: [err.message],\n          duration: 0\n        });\n      }\n    }\n  }\n\n  /**\n   * Processa lotes de arquivos em paralelo\n   */\n  private async processBatches(batches: FileEntryWithAst[][], techniques: Tecnica[], context: ContextoExecucao): Promise<void> {\n    // Conjunto de promises ativas para controle fino (removemos quando conclu\u0000eddas)\n    const activePromises = new Set<Promise<void>>();\n    for (let i = 0; i < batches.length; i++) {\n      // Espera at√© ter vaga para novo worker\n      while (this.activeWorkers >= this.maxWorkers) {\n        // Aguarda a primeira promise ativa resolver (libera capacidade)\n        if (activePromises.size === 0) break;\n        await Promise.race(Array.from(activePromises));\n      }\n      const p = this.processBatch(batches[i], techniques, context, i);\n      activePromises.add(p);\n\n      // Quando a promise terminar, remove do conjunto\n      p.then(() => activePromises.delete(p)).catch(() => activePromises.delete(p));\n    }\n\n    // Aguarda todas as promises ativas terminarem\n    await Promise.all(Array.from(activePromises));\n  }\n\n  /**\n   * Processa um lote de arquivos em um worker\n   */\n  private async processBatch(files: FileEntryWithAst[], techniques: Tecnica[], context: ContextoExecucao, batchId: number): Promise<void> {\n    this.activeWorkers++;\n    try {\n      const workerCaminho = path.join(__dirname, 'worker-executor.js');\n\n      // Calcula timeout adaptativo por lote baseado no tamanho m√©dio dos arquivos\n      const avgSize = files.reduce((s, f) => s + (f.content ? f.content.length : 0), 0) / Math.max(1, files.length);\n      const sizeMultiplier = 1 + Math.min(4, avgSize / 50000);\n      const batchTempoLimiteMs = Math.max(1000, Math.min(this.timeoutMs, Math.floor(this.timeoutMs * sizeMultiplier)));\n      const worker = new Worker(workerCaminho, {\n        workerData: {\n          files,\n          techniques,\n          context,\n          workerId: batchId,\n          timeoutMs: batchTempoLimiteMs\n        } as WorkerTask\n      });\n      const workerKillMs = Math.max(30000, this.timeoutMs * 2 || 30000);\n      const adjustedKillMs = Math.max(1000, Math.min(workerKillMs, batchTempoLimiteMs + 1000));\n      const result = await new Promise<WorkerResult>((resolve, reject) => {\n        let settled = false;\n        // Timer para for√ßar t√©rmino caso worker trave por muito tempo\n        let killTimer: NodeJS.Timeout | null = setTimeout(() => {\n          if (settled) return;\n          settled = true;\n          try {\n            void worker.terminate();\n          } catch {\n            /* ignore */\n          }\n          // Log estruturado para kills (ajuda em observabilidade em produ√ß√£o)\n          try {\n            log.infoSemSanitizar(JSON.stringify({\n              event: 'worker_killed',\n              batchId,\n              adjustedKillMs,\n              reason: 'timeout'\n            }));\n          } catch {}\n          reject(new Error(`Worker ${batchId} killed after ${adjustedKillMs}ms`));\n        }, adjustedKillMs);\n        worker.on('message', (msg: unknown) => {\n          const m = msg as Record<string, unknown>;\n          // Heartbeat: rearmar o kill timer\n          if (m && m['type'] === 'heartbeat') {\n            try {\n              if (killTimer) clearTimeout(killTimer);\n            } catch {}\n            killTimer = setTimeout(() => {\n              if (settled) return;\n              settled = true;\n              try {\n                void worker.terminate();\n              } catch {}\n              try {\n                log.infoSemSanitizar(JSON.stringify({\n                  event: 'worker_killed',\n                  batchId,\n                  adjustedKillMs,\n                  reason: 'heartbeat_timeout'\n                }));\n              } catch {}\n              reject(new Error(`Worker ${batchId} killed after ${adjustedKillMs}ms (heartbeat timeout)`));\n            }, adjustedKillMs);\n            return;\n          }\n          if (settled) return;\n          settled = true;\n          try {\n            if (killTimer) clearTimeout(killTimer);\n          } catch {}\n          // Normaliza a mensagem retornada pelo worker para o formato WorkerResult esperado\n          try {\n            const workerId = typeof m['workerId'] === 'number' ? m['workerId'] as number : batchId;\n            const occurrences = Array.isArray(m['occurrences']) ? m['occurrences'] as Ocorrencia[] : Array.isArray(m['resultados']) ? m['resultados'] as Ocorrencia[] : [];\n            const metrics = Array.isArray(m['metrics']) ? m['metrics'] as MetricaAnalista[] : [];\n            const processedArquivos = typeof m['processedFiles'] === 'number' ? m['processedFiles'] as number : files.length || 0;\n            const errors = Array.isArray(m['errors']) ? (m['errors'] as string[]).map(String) : m['erro'] ? [String(m['erro'])] : [];\n            const duration = typeof m['duration'] === 'number' ? m['duration'] as number : 0;\n            const workerResultado: WorkerResult = {\n              workerId,\n              occurrences,\n              metrics,\n              processedArquivos,\n              errors: errors as string[],\n              duration\n            };\n            resolve(workerResultado);\n          } catch (e) {\n            reject(e);\n          }\n        });\n        worker.on('error', err => {\n          if (settled) return;\n          settled = true;\n          try {\n            if (killTimer) clearTimeout(killTimer);\n          } catch {}\n          reject(err);\n        });\n        worker.on('exit', code => {\n          if (settled) return;\n          settled = true;\n          try {\n            if (killTimer) clearTimeout(killTimer);\n          } catch {}\n          if (code !== 0) {\n            try {\n              log.infoSemSanitizar(JSON.stringify({\n                event: 'worker_exit_nonzero',\n                batchId,\n                code\n              }));\n            } catch {}\n            reject(new Error(`Worker ${batchId} exited with code ${code}`));\n          } else {\n            resolve({\n              workerId: batchId,\n              occurrences: [],\n              metrics: [],\n              processedArquivos: files.length,\n              errors: [],\n              duration: 0\n            });\n          }\n        });\n      });\n      this.results.push(result);\n    } catch (error) {\n      const err = error as Error;\n      this.errors.push(`Erro no worker ${batchId}: ${err.message}`);\n\n      // Adiciona resultado de erro\n      this.results.push({\n        workerId: batchId,\n        occurrences: [ocorrenciaErroAnalista({\n          mensagem: `Falha no worker ${batchId}: ${err.message}`,\n          relPath: `[worker-${batchId}]`,\n          origem: 'worker-pool'\n        })],\n        metrics: [],\n        processedArquivos: 0,\n        errors: [err.message],\n        duration: 0\n      });\n    } finally {\n      this.activeWorkers--;\n    }\n  }\n\n  /**\n   * Processamento sequencial como fallback\n   */\n  private async processSequentially(files: FileEntryWithAst[], techniques: Tecnica[], context: ContextoExecucao): Promise<{\n    occurrences: Ocorrencia[];\n    metrics: MetricaAnalista[];\n    totalProcessed: number;\n    duration: number;\n  }> {\n    const startHora = performance.now();\n    const occurrences: Ocorrencia[] = [];\n    const metrics: MetricaAnalista[] = [];\n    log.info('üîÑ Usando processamento sequencial (workers desabilitados)');\n\n    // Processa t√©cnicas globais\n    const globalTechniques = techniques.filter(t => t.global);\n    for (const technique of globalTechniques) {\n      try {\n        const result = await this.executeTechniqueWithTimeout(technique, '', '[global]', null, undefined, context);\n        if (result) {\n          const occs = Array.isArray(result) ? result : [result];\n          occurrences.push(...occs);\n        }\n      } catch (error) {\n        const err = error as Error;\n        occurrences.push(ocorrenciaErroAnalista({\n          mensagem: `Falha na t√©cnica global '${technique.nome}': ${err.message}`,\n          relPath: '[execu√ß√£o global]',\n          origem: technique.nome\n        }));\n      }\n    }\n\n    // Processa arquivos sequencialmente\n    const nonGlobalTechniques = techniques.filter(t => !t.global);\n    for (const file of files) {\n      for (const technique of nonGlobalTechniques) {\n        if (technique.test && !technique.test(file.relPath)) continue;\n        try {\n          const startHora = performance.now();\n          const result = await this.executeTechniqueWithTimeout(technique, file.content ?? '', file.relPath, file.ast && 'node' in file.ast ? file.ast : null, file.fullCaminho, context);\n          if (result) {\n            const occs = Array.isArray(result) ? result : [result];\n            occurrences.push(...occs);\n          }\n          const duration = performance.now() - startHora;\n          metrics.push({\n            nome: technique.nome || 'desconhecido',\n            duracaoMs: duration,\n            ocorrencias: Array.isArray(result) ? result.length : result ? 1 : 0,\n            global: false\n          });\n        } catch (error) {\n          const err = error as Error;\n          occurrences.push(ocorrenciaErroAnalista({\n            mensagem: `Falha na t√©cnica '${technique.nome}' para ${file.relPath}: ${err.message}`,\n            relPath: file.relPath,\n            origem: technique.nome\n          }));\n        }\n      }\n    }\n    return {\n      occurrences,\n      metrics,\n      totalProcessed: files.length,\n      duration: performance.now() - startHora\n    };\n  }\n\n  /**\n   * Executa uma t√©cnica com timeout\n   */\n  private async executeTechniqueWithTimeout(technique: Tecnica, content: string, relPath: string, ast: import('@babel/traverse').NodePath<import('@babel/types').Node> | null, fullCaminho: string | undefined, context: ContextoExecucao): Promise<ReturnType<Tecnica['aplicar']>> {\n    if (this.timeoutMs > 0) {\n      let timer: NodeJS.Timeout | null = null;\n      const timeoutPromise = new Promise<never>((_, reject) => {\n        timer = setTimeout(() => {\n          reject(new Error(`Timeout: analista '${technique.nome}' excedeu ${this.timeoutMs}ms`));\n        }, this.timeoutMs);\n      });\n      const execPromise = technique.aplicar(content, relPath, ast, fullCaminho, context);\n      try {\n        return await Promise.race([execPromise, timeoutPromise]);\n      } finally {\n        if (timer) clearTimeout(timer);\n      }\n    } else {\n      return await technique.aplicar(content, relPath, ast, fullCaminho, context);\n    }\n  }\n\n  /**\n   * Retorna estat√≠sticas do pool\n   */\n  getStats(): {\n    maxWorkers: number;\n    batchSize: number;\n    enabled: boolean;\n    activeWorkers: number;\n    completedWorkers: number;\n    totalErrors: number;\n    errors: string[];\n  } {\n    return {\n      maxWorkers: this.maxWorkers,\n      batchSize: this.batchSize,\n      enabled: this.enabled,\n      activeWorkers: this.activeWorkers,\n      completedWorkers: this.results.length,\n      totalErrors: this.errors.length,\n      errors: this.errors\n    };\n  }\n}\n\n/**\n * Fun√ß√£o de conveni√™ncia para usar o pool de workers\n */\n\nexport async function processarComWorkers(files: FileEntryWithAst[], techniques: Tecnica[], context: ContextoExecucao, options?: WorkerPoolOptions): Promise<{\n  occurrences: Ocorrencia[];\n  metrics: MetricaAnalista[];\n  totalProcessed: number;\n  duration: number;\n}> {\n  const pool = new WorkerPool(options);\n  return await pool.processFiles(files, techniques, context);\n}"]}