{"version":3,"file":"parser.js","sourceRoot":"","sources":["../../../src/core/parsing/parser.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport type { ParserOptions } from '@babel/parser';\nimport { parse as babelParse } from '@babel/parser';\nimport type { File as BabelFile } from '@babel/types';\nimport { log, logCore } from '@core/messages/index.js';\nimport { initializeDefaultPlugins } from '@shared/plugins/init.js';\n  /* -------------------------- SISTEMA DE PLUGINS - Novo sistema de parsers modular (Fase 1) -------------------------- */\nimport { getGlobalRegistry } from '@shared/plugins/registry.js';\nimport * as csstree from 'css-tree';\nimport { XMLParser } from 'fast-xml-parser';\n// Parsers externos leves para outras linguagens\nimport { parseDocument } from 'htmlparser2';\nimport { createRequire } from 'module';\n\nimport type { DecifrarSintaxeOpts, ParserBabelFileExtra as BabelFileExtra, ParserFunc, ParserOptions as PluginParserOptions, ParserRawAst } from '@';\n\n// Contexto global para o arquivo atual durante parsing\nlet currentParsingArquivo: string | undefined;\n\n/**\n * Helper para setar o arquivo atual durante parsing\n */\nfunction setCurrentParsingFile(file: string | undefined) {\n  currentParsingArquivo = file;\n}\n\n/**\n * Helper para obter o arquivo atual durante parsing\n */\nexport function getCurrentParsingFile(): string {\n  return currentParsingArquivo || 'desconhecido';\n}\nconst localRequire = createRequire(import.meta.url);\n\n// Mantemos a assinatura retornando BabelFile | null para n√£o quebrar tipos externos, mas\n// para linguagens n√£o-Babel geramos um objeto \"compat\" m√≠nimo com File/Program vazio\n// e ast original em prometheusExtra.\n\nfunction parseComBabel(codigo: string, plugins?: string[]): BabelFile | null {\n  // Plugins padr√£o ampliados para cobrir padr√µes amplamente usados em node_modules\n  const defaultPlugins = ['typescript', 'jsx', 'decorators-legacy',\n  // Suporte a import attributes/assertions modernos\n  'importAttributes', 'importAssertions',\n  // Class fields/methods private (comuns em libs modernas)\n  'classProperties', 'classPrivateProperties', 'classPrivateMethods', 'optionalChaining', 'nullishCoalescingOperator', 'topLevelAwait'];\n  const options: ParserOptions = {\n    sourceType: 'unambiguous',\n    plugins: (Array.isArray(plugins) ? plugins : defaultPlugins) as ParserOptions['plugins']\n  };\n  try {\n    return babelParse(codigo, options);\n  } catch (e) {\n    // Mant√©m comportamento resiliente: parser inv√°lido retorna null (testes esperam isso)\n    logCore.erroBabel((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\nfunction wrapMinimal(lang: string, rawAst: ParserRawAst): BabelFileExtra {\n  return {\n    type: 'File',\n    program: {\n      type: 'Program',\n      body: [],\n      sourceType: 'script',\n      directives: []\n    },\n    comments: [],\n    tokens: [],\n    prometheusExtra: {\n      lang,\n      rawAst\n    }\n  };\n}\nfunction parseComTypeScript(codigo: string, tsx = false) {\n  try {\n    // Lazy require para reduzir custo quando n√£o necess√°rio\n    const ts: typeof import('typescript') = localRequire('typescript');\n    const sf = ts.createSourceFile(tsx ? 'file.tsx' : 'file.ts', codigo, ts.ScriptTarget.Latest, /*setParentNodes*/false, tsx ? ts.ScriptKind.TSX : ts.ScriptKind.TS);\n    // Retorna AST do TS como extra; suficiente para gerar sentinel no pipeline\n    return wrapMinimal(tsx ? 'tsx-tsc' : 'ts-tsc', {\n      kind: sf.kind,\n      statements: sf.statements?.length ?? 0\n    });\n  } catch (e) {\n    logCore.erroTs((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\nfunction parseComXml(codigo: string) {\n  try {\n    const parser = new XMLParser({\n      ignoreAttributes: false,\n      attributeNamePrefix: '@'\n    });\n    const ast = parser.parse(codigo);\n    return wrapMinimal('xml', ast);\n  } catch (e) {\n    logCore.erroXml((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\nfunction parseComPhp(codigo: string) {\n  // Heur√≠stica simples para PHP: extrai classes, fun√ß√µes e namespaces\n  const classes = Array.from(codigo.matchAll(/\\bclass\\s+([A-Za-z0-9_]+)/g)).map(m => m[1]);\n  const functions = Array.from(codigo.matchAll(/\\bfunction\\s+([A-Za-z0-9_]+)/g)).map(m => m[1]);\n  const namespaces = Array.from(codigo.matchAll(/\\bnamespace\\s+([A-Za-z0-9_\\\\]+)/g)).map(m => m[1]);\n  log.debug(`üêò PHP pseudo-parse: ${classes.length} classes, ${functions.length} fun√ß√µes`);\n  return wrapMinimal('php', {\n    classes,\n    functions,\n    namespaces\n  });\n}\nfunction parseComPython(codigo: string) {\n  // Heur√≠stica simples para Python: extrai classes e fun√ß√µes (def)\n  const classes = Array.from(codigo.matchAll(/^class\\s+([A-Za-z0-9_]+)/gm)).map(m => m[1]);\n  const functions = Array.from(codigo.matchAll(/^def\\s+([A-Za-z0-9_]+)/gm)).map(m => m[1]);\n  log.debug(`üêç Python pseudo-parse: ${classes.length} classes, ${functions.length} fun√ß√µes`);\n  return wrapMinimal('python', {\n    classes,\n    functions\n  });\n}\nfunction parseComHtmlFunc(codigo: string) {\n  try {\n    const dom = parseDocument(codigo, {\n      xmlMode: false\n    });\n    return wrapMinimal('html', dom as unknown as ParserRawAst);\n  } catch (e) {\n    logCore.erroHtml((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\nfunction parseComVue(codigo: string) {\n  try {\n    // Extrair blocos do arquivo Vue\n    const templateMatch = codigo.match(/<template\\b[^>]*>([\\s\\S]*?)<\\/template\\b[^>]*>/i);\n    const scriptMatch = codigo.match(/<script\\b[^>]*>([\\s\\S]*?)<\\/script\\b[^>]*>/i);\n    const styleMatch = codigo.match(/<style\\b[^>]*>([\\s\\S]*?)<\\/style\\b[^>]*>/i);\n    const template = templateMatch ? templateMatch[1].trim() : '';\n    const script = scriptMatch ? scriptMatch[1].trim() : '';\n    const style = styleMatch ? styleMatch[1].trim() : '';\n\n    // Analisar script como TypeScript/JavaScript se presente\n    if (script) {\n      try {\n        babelParse(script, {\n          sourceType: 'module',\n          plugins: ['typescript', 'jsx'],\n          allowImportExportEverywhere: true\n        });\n      } catch {\n        // Fallback para JS se TS falhar\n        try {\n          babelParse(script, {\n            sourceType: 'module',\n            plugins: ['jsx'],\n            allowImportExportEverywhere: true\n          });\n        } catch {\n          // Ignorar erros de parsing do script\n        }\n      }\n    }\n\n    // Analisar template como HTML se presente\n    if (template) {\n      try {\n        parseDocument(template, {\n          xmlMode: false\n        });\n      } catch {\n        // Ignorar erros de parsing do template\n      }\n    }\n\n    // Analisar style como CSS se presente\n    if (style) {\n      try {\n        csstree.parse(style, {\n          positions: false\n        });\n      } catch {\n        // Ignorar erros de parsing do style\n      }\n    }\n    return wrapMinimal('vue', {\n      template: template ? 'present' : null,\n      script: script ? 'present' : null,\n      style: style ? 'present' : null,\n      hasTemplate: !!template,\n      hasScript: !!script,\n      hasStyle: !!style,\n      templateContent: template,\n      scriptContent: script,\n      styleContent: style\n    });\n  } catch (e) {\n    logCore.erroHtml((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\nfunction parseComCss(codigo: string) {\n  try {\n    const ast = csstree.parse(codigo, {\n      positions: false\n    });\n    return wrapMinimal('css', ast);\n  } catch (e) {\n    logCore.erroCss((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\nexport const PARSERS = new Map<string, ParserFunc>([['.js', parseComBabel], ['.jsx', parseComBabel], ['.ts', parseComBabel], ['.tsx', parseComBabel], ['.mjs', parseComBabel], ['.cjs', parseComBabel],\n// Evitamos .d.ts explicitamente: n√£o h√° AST √∫til para nossas an√°lises\n['.d.ts', () => null], ['.xml', parseComXml], ['.html', parseComHtmlFunc], ['.htm', parseComHtmlFunc], ['.vue', parseComVue], ['.css', parseComCss], ['.php', parseComPhp], ['.py', parseComPython]]);\nexport const EXTENSOES_SUPORTADAS = Array.from(PARSERS.keys()).filter(ext => ext !== '.d.ts');\nexport async function decifrarSintaxe(codigo: string, ext: string, opts: DecifrarSintaxeOpts = {}): Promise<BabelFile | null> {\n  // Setar arquivo atual para logs de erro\n  setCurrentParsingFile(opts.relPath);\n  const parser = PARSERS.get(ext);\n  if (!parser) {\n    logCore.nenhumParser(ext);\n    return null;\n  }\n\n  // Curto-circuito para TS/TSX: se o chamador forneceu plugins e eles n√£o incluem 'typescript'\n  // (ou incluem 'flow'), evitamos Babel para n√£o aceitar sintaxe TS como Flow e for√ßamos o\n  // compilador do TypeScript. Isso garante ast.prometheusExtra.lang = 'ts-tsc'|'tsx-tsc'.\n  if (ext === '.ts' || ext === '.tsx') {\n    const p = opts.plugins;\n    if (Array.isArray(p)) {\n      const lower = p.map(x => String(x).toLowerCase());\n      const hasTs = lower.includes('typescript');\n      const hasFlow = lower.includes('flow');\n      if (!hasTs || hasFlow) {\n        const tsx = ext === '.tsx';\n        const tsParsed = parseComTypeScript(codigo, tsx);\n        if (tsParsed) {\n          setCurrentParsingFile(undefined);\n          return Promise.resolve(tsParsed as unknown as BabelFile);\n        }\n        // Se o compilador TS falhar, ca√≠mos no fluxo normal para tentar Babel\n      }\n    }\n  }\n\n  // Primeira tentativa com plugins padr√£o (ou fornecidos)\n  let parseResultado;\n  if (parser === parseComBabel) {\n    parseResultado = parseComBabel(codigo, opts.plugins);\n  } else {\n    parseResultado = parser(codigo, opts.plugins);\n  }\n  // Fallbacks espec√≠ficos para .js/.mjs: tentar Flow quando a primeira tentativa falhar\n  if (parseResultado == null && (ext === '.js' || ext === '.mjs' || ext === '.cjs')) {\n    try {\n      // Heur√≠stica r√°pida: detecta uso de Flow\n      const pareceFlow = /@flow\\b/.test(codigo) || /\\bimport\\s+type\\b/.test(codigo);\n      if (pareceFlow) {\n        const flowPlugins = ['flow', 'jsx', 'decorators-legacy', 'importAttributes', 'importAssertions', 'classProperties', 'classPrivateProperties', 'classPrivateMethods', 'optionalChaining', 'nullishCoalescingOperator', 'topLevelAwait'];\n        parseResultado = parseComBabel(codigo, flowPlugins);\n      }\n      // Se ainda nulo e n√£o parece Flow, tenta um conjunto \"JS moderno\" sem TypeScript (para .js puros)\n      if (parseResultado == null) {\n        const jsModernPlugins = ['jsx', 'decorators-legacy', 'importAttributes', 'importAssertions', 'classProperties', 'classPrivateProperties', 'classPrivateMethods', 'optionalChaining', 'nullishCoalescingOperator', 'topLevelAwait'];\n        parseResultado = parseComBabel(codigo, jsModernPlugins);\n      }\n    } catch {\n      // mant√©m null\n    }\n  }\n\n  // Fallback usando TypeScript compiler quando Babel falhar em .ts/.tsx\n  if (parseResultado == null && (ext === '.ts' || ext === '.tsx')) {\n    const tsx = ext === '.tsx';\n    const tsParsed = parseComTypeScript(codigo, tsx);\n    if (tsParsed) {\n      setCurrentParsingFile(undefined);\n      return Promise.resolve(tsParsed as unknown as BabelFile);\n    }\n  }\n\n  // Caso especial: se plugins foram passados e o parser de .ts/.tsx retornou null,\n  // for√ßa fallback para o compilador TS (cobre cen√°rios de plugins conflitantes como 'flow').\n  if (parseResultado == null && opts.plugins && (ext === '.ts' || ext === '.tsx')) {\n    const tsx = ext === '.tsx';\n    const tsParsed = parseComTypeScript(codigo, tsx);\n    if (tsParsed) {\n      setCurrentParsingFile(undefined);\n      return Promise.resolve(tsParsed as unknown as BabelFile);\n    }\n  }\n  if (opts.timeoutMs) {\n    return (async () => {\n      let timer: NodeJS.Timeout | null = null;\n      try {\n        const race = Promise.race([Promise.resolve(parseResultado), new Promise<null>(resolve => {\n          timer = setTimeout(() => {\n            logCore.timeoutParsing(opts.timeoutMs || 0, ext);\n            resolve(null);\n          }, opts.timeoutMs);\n        })]);\n        return await race;\n      } finally {\n        if (timer) clearTimeout(timer);\n        setCurrentParsingFile(undefined);\n      }\n    })();\n  }\n\n  // Se ainda assim for null, normalize para null expl√≠cito\n  setCurrentParsingFile(undefined);\n  return Promise.resolve(parseResultado ?? null);\n}\nfunction initializePluginSystem() {\n  const registry = getGlobalRegistry();\n\n  // Registra todos os plugins padr√£o se ainda n√£o foram registrados\n  const registeredPlugins = registry.getRegisteredPlugins();\n  if (registeredPlugins.length === 0) {\n    initializeDefaultPlugins();\n    log.debug('üîå Plugins padr√£o registrados no sistema');\n  }\n}\n\n/**\n * Parse usando o novo sistema de plugins (API futura)\n * Mant√©m compatibilidade com sistema atual\n */\n\nexport async function parseComPlugins(codigo: string, extensao: string, opts?: PluginParserOptions): Promise<BabelFile | null> {\n  try {\n    initializePluginSystem();\n    const registry = getGlobalRegistry();\n    const plugin = await registry.getPluginForExtension(extensao);\n    if (!plugin) {\n      logCore.pluginNaoEncontrado(extensao);\n      // Fallback para sistema atual usando a fun√ß√£o exportada\n      return await decifrarSintaxe(codigo, extensao, {\n        plugins: opts?.plugins,\n        timeoutMs: opts?.timeoutMs\n      });\n    }\n    logCore.usandoPlugin(plugin.name, extensao);\n    const pluginOpts: PluginParserOptions = {\n      ...opts,\n      pluginConfig: {\n        ...opts?.pluginConfig,\n        extension: extensao\n      }\n    };\n    const result = await plugin.parse(codigo, pluginOpts);\n    return result;\n  } catch (error) {\n    logCore.sistemaPluginsFalhou((error as Error).message);\n    // Fallback para sistema atual em caso de erro\n    return await decifrarSintaxe(codigo, extensao, {\n      plugins: opts?.plugins,\n      timeoutMs: opts?.timeoutMs\n    });\n  }\n}\n\n/**\n * Obt√©m estat√≠sticas do sistema de plugins\n */\n\nexport function getPluginStats(): {\n  pluginsRegistrados: number;\n  extensoesSuportadas: number;\n  sistemAtivojava: boolean;\n} {\n  try {\n    initializePluginSystem();\n    const registry = getGlobalRegistry();\n    const stats = registry.getStats();\n    return {\n      pluginsRegistrados: stats.pluginsRegistrados,\n      extensoesSuportadas: stats.extensoesSuportadas,\n      sistemAtivojava: stats.pluginsRegistrados > 0\n    };\n  } catch {\n    return {\n      pluginsRegistrados: 0,\n      extensoesSuportadas: 0,\n      sistemAtivojava: false\n    };\n  }\n}\n"]}