{"version":3,"file":"validacao.js","sourceRoot":"","sources":["../../../../src/core/config/auto/validacao.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\n/**\n * Sistema de validação para correções automáticas\n * Integra com o sistema existente de detectores do Prometheus\n */\n\nimport { log } from '@core/messages/index.js';\n\nimport type { ValidationResult } from '@';\n\n// Re-exporta o tipo para compatibilidade\nexport type { ValidationResult };\n\n/**\n * Valida sintaxe usando verificações robustas baseadas nos detectores existentes\n */\nexport function validateJavaScriptSyntax(code: string): ValidationResult {\n  const result: ValidationResult = {\n    isValid: true,\n    errors: [],\n    warnings: []\n  };\n  try {\n    // 1. Verificações básicas de balanceamento\n    const braceContagem = (code.match(/{/g) || []).length - (code.match(/}/g) || []).length;\n    const parenContagem = (code.match(/\\(/g) || []).length - (code.match(/\\)/g) || []).length;\n    const bracketContagem = (code.match(/\\[/g) || []).length - (code.match(/\\]/g) || []).length;\n    if (braceContagem !== 0) {\n      result.errors.push(`Chaves desbalanceadas: ${braceContagem > 0 ? 'faltam' : 'sobram'} ${Math.abs(braceContagem)} chave(s)`);\n      result.isValid = false;\n    }\n    if (parenContagem !== 0) {\n      result.errors.push(`Parênteses desbalanceados: ${parenContagem > 0 ? 'faltam' : 'sobram'} ${Math.abs(parenContagem)} parêntese(s)`);\n      result.isValid = false;\n    }\n    if (bracketContagem !== 0) {\n      result.errors.push(`Colchetes desbalanceados: ${bracketContagem > 0 ? 'faltam' : 'sobram'} ${Math.abs(bracketContagem)} colchete(s)`);\n      result.isValid = false;\n    }\n\n    // 2. Usar lógica similar ao detector de segurança para try-catch\n    const tryBlocks = (code.match(/try\\s*{/g) || []).length;\n    const catchBlocks = (code.match(/catch\\s*\\(/g) || []).length;\n    if (tryBlocks !== catchBlocks) {\n      result.errors.push('Blocos try-catch desbalanceados');\n      result.isValid = false;\n    }\n\n    // 3. Verificar JSDoc órfãos (seguindo padrão dos detectores)\n    // Nota: Verificação simplificada - JSDoc pode aparecer em classes, interfaces, etc\n    const jsdocBlocks = (code.match(/\\/\\*\\*[\\s\\S]*?\\*\\//g) || []).length;\n    const codeStructures = (code.match(/(?:export\\s+)?(?:async\\s+)?(?:function|class|interface|type)\\s+\\w+/g) || []).length;\n\n    // Apenas avisar se houver MUITOS JSDoc órfãos (possível geração automática problemática)\n    if (jsdocBlocks > codeStructures + 5) {\n      result.warnings.push(`Possível poluição de JSDoc: ${jsdocBlocks} blocos para ${codeStructures} estruturas`);\n    }\n\n    // 4. Verificar imports/exports quebrados\n    const importLines = code.split('\\n').filter(line => line.trim().startsWith('import') || line.trim().startsWith('export'));\n    for (const line of importLines) {\n      if (!line.trim().endsWith(';') && !line.includes('from') && !line.includes('=')) {\n        result.warnings.push(`Possível import/export malformado: ${line.trim().substring(0, 50)}...`);\n      }\n    }\n  } catch (error) {\n    result.errors.push(`Erro na validação de sintaxe: ${error instanceof Error ? error.message : String(error)}`);\n    result.isValid = false;\n  }\n  return result;\n}\n\n/**\n * Valida se a correção não introduz problemas conhecidos\n */\nexport function validateQuickFixResult(originalCode: string, fixedCodigo: string, fixId: string): ValidationResult {\n  const result: ValidationResult = {\n    isValid: true,\n    errors: [],\n    warnings: []\n  };\n  try {\n    // Validar sintaxe do código corrigido\n    const syntaxValidation = validateJavaScriptSyntax(fixedCodigo);\n    result.errors.push(...syntaxValidation.errors);\n    result.warnings.push(...syntaxValidation.warnings);\n    result.isValid = result.isValid && syntaxValidation.isValid;\n\n    // Validações específicas por tipo de correção\n    switch (fixId) {\n      case 'wrap-async-with-try-catch':\n        // Verificar se o try-catch foi adicionado corretamente\n        if (!fixedCodigo.includes('try {') || !fixedCodigo.includes('} catch')) {\n          result.errors.push('Try-catch não foi adicionado corretamente');\n          result.isValid = false;\n        }\n\n        // Verificar se não criamos try-catch aninhados desnecessários\n        const nestedTryContagem = (fixedCodigo.match(/try\\s*{[^}]*try\\s*{/g) || []).length;\n        if (nestedTryContagem > 0) {\n          result.warnings.push('Possível try-catch aninhado desnecessário');\n        }\n        break;\n      case 'remove-console-log':\n        // Verificar se o console.log foi comentado corretamente\n        if (fixedCodigo.includes('console.log(') && !fixedCodigo.includes('// console.log(')) {\n          result.warnings.push('Console.log pode não ter sido comentado corretamente');\n        }\n        break;\n      case 'fix-dangerous-html':\n        // Verificar se o innerHTML foi substituído corretamente\n        if (fixedCodigo.includes('innerHTML') && !fixedCodigo.includes('textContent')) {\n          result.warnings.push('innerHTML pode não ter sido substituído corretamente');\n        }\n        break;\n    }\n\n    // Verificação geral: o código não deve ter ficado significativamente maior\n    const sizeDiff = fixedCodigo.length - originalCode.length;\n    if (sizeDiff > originalCode.length * 0.5) {\n      // Mais de 50% de aumento\n      result.warnings.push(`Código aumentou significativamente (${sizeDiff} caracteres)`);\n    }\n  } catch (error) {\n    result.errors.push(`Erro na validação da correção: ${error instanceof Error ? error.message : String(error)}`);\n    result.isValid = false;\n  }\n  return result;\n}\n\n/**\n * Valida se é seguro aplicar uma correção específica usando heurísticas dos detectores\n */\nexport function isSafeToApplyFix(code: string, fixId: string, match: RegExpMatchArray): boolean {\n  try {\n    // Verificações gerais de segurança\n\n    // 1. Não aplicar em arquivos muito pequenos (possivelmente incompletos)\n    if (code.length < 100) {\n      return false;\n    }\n\n    // 2. Não aplicar se o código tem muitos erros de sintaxe\n    const validation = validateJavaScriptSyntax(code);\n    if (validation.errors.length > 3) {\n      return false;\n    }\n\n    // 3. Verificações específicas baseadas nos detectores existentes\n    switch (fixId) {\n      case 'wrap-async-with-try-catch':\n        // Usar lógica similar ao detector-seguranca.ts para async/await\n        const lines = code.split('\\n');\n        const matchLine = match.index ? code.substring(0, match.index).split('\\n').length - 1 : 0;\n\n        // Verificar contexto (mesma lógica do detector de segurança)\n        const contextLines = lines.slice(Math.max(0, matchLine - 5), Math.min(lines.length, matchLine + 5));\n        const context = contextLines.join(' ');\n\n        // Não aplicar se já tem tratamento de erro próximo\n        if (context.includes('try') || context.includes('catch') || context.includes('.catch')) {\n          return false;\n        }\n\n        // Não aplicar se está em Promise.allSettled (tratamento próprio)\n        if (context.includes('Promise.allSettled')) {\n          return false;\n        }\n        break;\n      case 'remove-console-log':\n        // Usar contexto similar aos detectores para verificar se é debug legítimo\n        const beforeMatch = code.substring(Math.max(0, (match.index || 0) - 200), match.index || 0);\n\n        // Não remover se está em contexto de desenvolvimento/debug\n        if (beforeMatch.includes('debug') || beforeMatch.includes('DEV_MODE') || beforeMatch.includes('VERBOSE')) {\n          return false;\n        }\n        break;\n    }\n    return true;\n  } catch (error) {\n    log.aviso(`⚠️ Erro ao validar segurança da correção ${fixId}: ${error instanceof Error ? error.message : String(error)}`);\n    return false;\n  }\n}"]}