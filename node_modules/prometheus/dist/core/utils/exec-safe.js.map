{"version":3,"file":"exec-safe.js","sourceRoot":"","sources":["../../../src/core/utils/exec-safe.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,QAAQ,EAAwB,MAAM,oBAAoB,CAAC;AAEpE,OAAO,EAAE,MAAM,EAAE,MAAM,wBAAwB,CAAC;AAUhD,MAAM,UAAU,mBAAmB,CACjC,GAAW,EACX,OAAwB,EAAE;IAG1B,IAAI,MAAM,CAAC,SAAS,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC;QACpD,MAAM,IAAI,KAAK,CACb,+FAA+F,CAChG,CAAC;IACJ,CAAC;IACD,OAAO,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;AAC7B,CAAC;AAUD,MAAM,CAAC,KAAK,UAAU,wBAAwB,CAC5C,GAAW,EACX,OAAwB,EAAE;IAG1B,OAAO,mBAAmB,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;AACxC,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT-0\n// @prometheus-disable PROBLEMA_PERFORMANCE\n// Justificativa: esta função é intencionalmente síncrona para executar comandos shell\nimport { execSync, type ExecSyncOptions } from 'node:child_process';\n\nimport { config } from '@core/config/config.js';\n\n/**\n * Executa um comando shell de forma segura.\n * Bloqueia a execução quando SAFE_MODE está ativo e ALLOW_EXEC não está habilitado.\n * @param cmd - Comando shell a executar\n * @param opts - Opções do execSync do Node.js\n * @returns Buffer ou string com a saída do comando\n * @throws Error se SAFE_MODE estiver ativo sem ALLOW_EXEC\n */\nexport function executarShellSeguro(\n  cmd: string,\n  opts: ExecSyncOptions = {},\n): Buffer | string {\n  // only block if SAFE_MODE is explicitly true and ALLOW_EXEC is falsy\n  if (config.SAFE_MODE === true && !config.ALLOW_EXEC) {\n    throw new Error(\n      'Execução de comandos desabilitada em SAFE_MODE. Defina PROMETHEUS_ALLOW_EXEC=1 para permitir.',\n    );\n  }\n  return execSync(cmd, opts);\n}\n\n/**\n * Versão assíncrona do `executarShellSeguro`.\n * Wrapper async que delega ao sync, útil em contextos que já utilizam await.\n * @param cmd - Comando shell a executar\n * @param opts - Opções do execSync do Node.js\n * @returns Promise resolvida com Buffer ou string da saída do comando\n * @throws Error se SAFE_MODE estiver ativo sem ALLOW_EXEC\n */\nexport async function executarShellSeguroAsync(\n  cmd: string,\n  opts: ExecSyncOptions = {},\n): Promise<Buffer | string> {\n  // wrapper assíncrono que delega ao sync (usado onde já há await)\n  return executarShellSeguro(cmd, opts);\n}\n"]}