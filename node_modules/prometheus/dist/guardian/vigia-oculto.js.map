{"version":3,"file":"vigia-oculto.js","sourceRoot":"","sources":["../../src/guardian/vigia-oculto.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,GAAG,EAAE,MAAM,yBAAyB,CAAC;AAI9C,OAAO,EAAE,6BAA6B,EAAE,MAAM,iBAAiB,CAAC;AAChE,OAAO,EAAE,uBAAuB,EAAE,MAAM,WAAW,CAAC;AACpD,OAAO,EAAE,iBAAiB,EAAE,eAAe,EAAE,MAAM,gBAAgB,CAAC;AAEpE,MAAM,CAAC,KAAK,UAAU,WAAW,CAC/B,QAAqB,EACrB,kBAA0B,6BAA6B,EACvD,SAAS,GAAG,IAAI;IAEhB,MAAM,SAAS,GAAG,MAAM,iBAAiB,CAAC,eAAe,CAAC,CAAC;IAC3D,MAAM,YAAY,GAAG,IAAI,GAAG,CAC1B,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAC1C,CAAC;IACF,MAAM,WAAW,GAAa,EAAE,CAAC;IAEjC,KAAK,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,QAAQ,EAAE,CAAC;QAC5C,IAAI,CAAC,OAAO,IAAI,OAAO,OAAO,KAAK,QAAQ,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;YAAE,SAAS;QACzE,MAAM,SAAS,GAAG,uBAAuB,CAAC,OAAO,CAAC,CAAC;QACnD,MAAM,YAAY,GAAG,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC/C,IAAI,YAAY,IAAI,SAAS,KAAK,YAAY,EAAE,CAAC;YAC/C,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC5B,CAAC;IACH,CAAC;IAED,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QAC3B,GAAG,CAAC,KAAK,CACP,6CAA6C,WAAW,CAAC,MAAM,cAAc,CAC9E,CAAC;QACF,KAAK,MAAM,GAAG,IAAI,WAAW,EAAE,CAAC;YAC9B,GAAG,CAAC,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC,CAAC;QACzB,CAAC;QAED,IAAI,SAAS,EAAE,CAAC;YACd,MAAM,eAAe,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC;YACjD,GAAG,CAAC,OAAO,CACT,iEAAiE,CAClE,CAAC;QACJ,CAAC;IACH,CAAC;AACH,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT\nimport { log } from '@core/messages/index.js';\n\nimport type { FileEntry } from '@';\n\nimport { REGISTRO_VIGIA_CAMINHO_PADRAO } from './constantes.js';\nimport { gerarSnapshotDoConteudo } from './hash.js';\nimport { carregarRegistros, salvarRegistros } from './registros.js';\n\nexport async function vigiaOculta(\n  arquivos: FileEntry[],\n  caminhoRegistro: string = REGISTRO_VIGIA_CAMINHO_PADRAO,\n  autoReset = true,\n): Promise<void> {\n  const registros = await carregarRegistros(caminhoRegistro);\n  const mapaAnterior = new Map<string, string>(\n    registros.map((r) => [r.arquivo, r.hash]),\n  );\n  const corrompidos: string[] = [];\n\n  for (const { relPath, content } of arquivos) {\n    if (!relPath || typeof content !== 'string' || !content.trim()) continue;\n    const hashAtual = gerarSnapshotDoConteudo(content); // retorna string\n    const hashEsperado = mapaAnterior.get(relPath);\n    if (hashEsperado && hashAtual !== hashEsperado) {\n      corrompidos.push(relPath);\n    }\n  }\n\n  if (corrompidos.length > 0) {\n    log.aviso(\n      `üîê [VigiaOculta] Altera√ß√µes detectadas em ${corrompidos.length} arquivo(s):`,\n    );\n    for (const arq of corrompidos) {\n      log.info(`  - ${arq}`);\n    }\n\n    if (autoReset) {\n      await salvarRegistros(arquivos, caminhoRegistro);\n      log.sucesso(\n        'üåÄ Registros recalibrados automaticamente pela Vigia Oculta.\\\\n',\n      );\n    }\n  }\n}\n"]}