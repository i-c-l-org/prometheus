{"version":3,"file":"normalizar-ocorrencias-json.js","sourceRoot":"","sources":["../../../src/cli/diagnostico/normalizar-ocorrencias-json.ts"],"names":[],"mappings":"AAcA,MAAM,UAAU,4BAA4B,CAAC,EAAc;IACzD,IAAI,CAAC;QACH,MAAM,GAAG,GAA2B,EAAE,GAAG,EAAE,EAAE,CAAC;QAE9C,IAAI,CAAC,GAAG,CAAC,OAAO,IAAI,OAAO,GAAG,CAAC,OAAO,KAAK,QAAQ,EAAE,CAAC;YACpD,GAAG,CAAC,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC;QAC5B,CAAC;QAED,MAAM,QAAQ,GAAG,OAAO,GAAG,CAAC,KAAK,KAAK,QAAQ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAC3E,MAAM,SAAS,GACb,OAAO,GAAG,CAAC,MAAM,KAAK,QAAQ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAE9D,MAAM,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC;QACpB,MAAM,KAAK,GAAG,GAAG,IAAI,OAAO,GAAG,KAAK,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC;QAChE,MAAM,GAAG,GAAG,GAAG,IAAI,OAAO,GAAG,KAAK,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC;QAE5D,IAAI,CAAC,QAAQ,IAAI,KAAK,IAAI,OAAO,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YACzD,GAAG,CAAC,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC;QACzB,CAAC;QACD,IAAI,CAAC,SAAS,IAAI,KAAK,IAAI,OAAO,KAAK,CAAC,MAAM,KAAK,QAAQ,EAAE,CAAC;YAC5D,GAAG,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;QAC5B,CAAC;QAED,MAAM,WAAW,GACf,OAAO,GAAG,CAAC,QAAQ,KAAK,QAAQ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAClE,MAAM,YAAY,GAChB,OAAO,GAAG,CAAC,SAAS,KAAK,QAAQ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAEpE,IAAI,CAAC,WAAW,IAAI,GAAG,IAAI,OAAO,GAAG,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YACxD,GAAG,CAAC,QAAQ,GAAG,GAAG,CAAC,IAAI,CAAC;QAC1B,CAAC;QACD,IAAI,CAAC,YAAY,IAAI,GAAG,IAAI,OAAO,GAAG,CAAC,MAAM,KAAK,QAAQ,EAAE,CAAC;YAC3D,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC,MAAM,CAAC;QAC7B,CAAC;QAED,OAAO,GAAiB,CAAC;IAC3B,CAAC;IAAC,MAAM,CAAC;QACP,OAAO,EAAE,CAAC;IACZ,CAAC;AACH,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT\n\nimport type { LocBabel, Ocorrencia } from '@';\n\n/** Tipo intermediário para normalização com campos opcionais de localização */\ntype OcorrenciaNormalizavel = Ocorrencia & {\n  arquivo?: string;\n  loc?: LocBabel;\n  fimLinha?: number;\n  fimColuna?: number;\n};\n\n// Em JSON, queremos incluir localização sempre que possível.\n// Muitos analistas armazenam `loc` (ex.: Babel) mas nem sempre preenchem `linha/coluna`.\nexport function normalizarOcorrenciaParaJson(oc: Ocorrencia): Ocorrencia {\n  try {\n    const out: OcorrenciaNormalizavel = { ...oc };\n\n    if (!out.relPath && typeof out.arquivo === 'string') {\n      out.relPath = out.arquivo;\n    }\n\n    const hasLinha = typeof out.linha === 'number' && !Number.isNaN(out.linha);\n    const hasColuna =\n      typeof out.coluna === 'number' && !Number.isNaN(out.coluna);\n\n    const loc = out.loc;\n    const start = loc && typeof loc === 'object' ? loc.start : null;\n    const end = loc && typeof loc === 'object' ? loc.end : null;\n\n    if (!hasLinha && start && typeof start.line === 'number') {\n      out.linha = start.line;\n    }\n    if (!hasColuna && start && typeof start.column === 'number') {\n      out.coluna = start.column;\n    }\n\n    const hasFimLinha =\n      typeof out.fimLinha === 'number' && !Number.isNaN(out.fimLinha);\n    const hasFimColuna =\n      typeof out.fimColuna === 'number' && !Number.isNaN(out.fimColuna);\n\n    if (!hasFimLinha && end && typeof end.line === 'number') {\n      out.fimLinha = end.line;\n    }\n    if (!hasFimColuna && end && typeof end.column === 'number') {\n      out.fimColuna = end.column;\n    }\n\n    return out as Ocorrencia;\n  } catch {\n    return oc;\n  }\n}\n"]}