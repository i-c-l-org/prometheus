{"version":3,"file":"comando-perf.js","sourceRoot":"","sources":["../../../src/cli/commands/comando-perf.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport crypto from 'node:crypto';\nimport { promises as fs } from 'node:fs';\nimport path from 'node:path';\n\nimport { ExitCode, sair } from '@cli/helpers/exit-codes.js';\nimport { config } from '@core/config/config.js';\nimport { formatPct } from '@core/config/format.js';\nimport { CliComandoDesempMensagens } from '@core/messages/cli/cli-comando-perf-messages.js';\nimport { ICONES_DIAGNOSTICO, log, logSistema } from '@core/messages/index.js';\nimport { lerEstado, salvarEstado } from '@shared/persistence/persistencia.js';\nimport { Command } from 'commander';\n\nimport type { MetricaExecucaoLike, SnapshotPerf } from '@';\n\nasync function obterCommit(): Promise<string | undefined> {\n  try {\n    // usar helper seguro\n    const {\n      executarShellSeguro\n    } = await import('@core/utils/exec-safe.js');\n    return executarShellSeguro('git rev-parse --short HEAD', {\n      stdio: ['ignore', 'pipe', 'ignore']\n    }).toString().trim();\n  } catch {\n    return undefined;\n  }\n}\nfunction calcularHash(snapshot: Omit<SnapshotPerf, 'hashConteudo'>) {\n  // SHA1 usado apenas para fingerprinting de baseline de performance\n  // Não é usado para segurança/criptografia - contexto: identificação rápida de snapshots\n  return crypto.createHash('sha1').update(JSON.stringify(snapshot, Object.keys(snapshot).sort())).digest('hex').slice(0, 10);\n}\nasync function gerarBaseline(destDir: string, metricas?: Partial<MetricaExecucaoLike>) {\n  const commit = await obterCommit();\n  const base: Omit<SnapshotPerf, 'hashConteudo'> = {\n    tipo: 'baseline',\n    timestamp: new Date().toISOString(),\n    commit,\n    node: process.version,\n    totalArquivos: metricas?.totalArquivos,\n    tempoParsingMs: metricas?.tempoParsingMs,\n    tempoAnaliseMs: metricas?.tempoAnaliseMs,\n    cacheAstHits: metricas?.cacheAstHits,\n    cacheAstMiss: metricas?.cacheAstMiss,\n    analistasTop: Array.isArray(metricas?.analistas) ? metricas.analistas.slice().sort((a, b) => b.duracaoMs - a.duracaoMs).slice(0, 5).map(a => ({\n      nome: a.nome,\n      duracaoMs: a.duracaoMs,\n      ocorrencias: a.ocorrencias\n    })) : undefined\n  };\n  const hashConteudo = calcularHash(base);\n  const snapshot: SnapshotPerf = {\n    ...base,\n    hashConteudo\n  };\n  await fs.mkdir(destDir, {\n    recursive: true\n  });\n  const nome = `baseline-${Date.now()}.json`;\n  await salvarEstado(path.join(destDir, nome), snapshot);\n  return snapshot;\n}\nasync function carregarSnapshots(dir: string): Promise<SnapshotPerf[]> {\n  try {\n    const arquivos = await fs.readdir(dir);\n    const jsons = arquivos.filter(f => f.endsWith('.json'));\n    const out: SnapshotPerf[] = [];\n    for (const f of jsons) {\n      try {\n        const parsed = await lerEstado<SnapshotPerf>(path.join(dir, f));\n        if (parsed && parsed.tipo === 'baseline') out.push(parsed);\n      } catch {\n        /* ignore */\n      }\n    }\n    return out.sort((a, b) => a.timestamp.localeCompare(b.timestamp));\n  } catch {\n    return [];\n  }\n}\nfunction diffPercent(a?: number, b?: number) {\n  if (!a && !b) return 0;\n  if (!a || !b) return 0;\n  if (a === 0) return 0;\n  return (b - a) / a * 100;\n}\nfunction compararSnapshots(base: SnapshotPerf, atual: SnapshotPerf) {\n  const campos: (keyof SnapshotPerf)[] = ['tempoParsingMs', 'tempoAnaliseMs', 'cacheAstHits', 'cacheAstMiss', 'totalArquivos'];\n  const diffs = campos.map(c => {\n    const anterior = base[c] as number | undefined;\n    const novo = atual[c] as number | undefined;\n    return {\n      campo: c,\n      anterior,\n      novo,\n      variacaoPct: diffPercent(anterior, novo)\n    };\n  });\n  return diffs;\n}\nexport function comandoPerf(): Command {\n  /* istanbul ignore next */\n  if (false) 0;\n  return new Command('perf')\n    .description(CliComandoDesempMensagens.descricao)\n    .option('-d, --dir <dir>', CliComandoDesempMensagens.opcoes.dir, config.PERF_SNAPSHOT_DIR)\n    .option('-j, --json', CliComandoDesempMensagens.opcoes.json)\n    .option('-l, --limite <n>', CliComandoDesempMensagens.opcoes.limite, v => Number(v), 30)\n    .addCommand(new Command('baseline')\n      .description(CliComandoDesempMensagens.subcomandos.baseline.descricao)\n      .action(async (opts, cmd) => {\n    try {\n      const parent = cmd.parent?.opts?.() || {};\n      const dir = parent.dir ? String(parent.dir) : config.PERF_SNAPSHOT_DIR;\n      const metricas = (globalThis as unknown as {\n        __ULTIMAS_METRICAS_PROMETHEUS__?: Partial<MetricaExecucaoLike> | null;\n      }).__ULTIMAS_METRICAS_PROMETHEUS__;\n      const snap = await gerarBaseline(dir, metricas || undefined);\n      if (parent.json) {\n        console.log(JSON.stringify({\n          gerado: true,\n          snapshot: snap\n        }, null, 2));\n      } else {\n        log.sucesso(`Baseline gerada: commit=${snap.commit || 'n/a'} parsing=${snap.tempoParsingMs}ms analise=${snap.tempoAnaliseMs}ms`);\n      }\n    } catch (err) {\n      log.erro(CliComandoDesempMensagens.subcomandos.baseline.erro(err instanceof Error ? err.message : String(err)));\n      sair(ExitCode.Failure);\n      return;\n    }\n  }))\n  .addCommand(new Command('compare')\n    .description(CliComandoDesempMensagens.subcomandos.compare.descricao)\n    .action(async (opts, cmd) => {\n    const parent = cmd.parent?.opts?.() || {};\n    const dir = parent.dir ? String(parent.dir) : config.PERF_SNAPSHOT_DIR;\n    const limite = parent.limite;\n    let snaps;\n    try {\n      snaps = await carregarSnapshots(dir);\n    } catch (err) {\n      log.erro(CliComandoDesempMensagens.subcomandos.compare.erroSnapshots(err instanceof Error ? err.message : String(err)));\n      sair(ExitCode.Failure);\n      return;\n    }\n    if (snaps.length < 2) {\n      const msg = CliComandoDesempMensagens.subcomandos.compare.erroMenosDeDois;\n      if (parent.json) console.log(JSON.stringify({\n        erro: msg\n      }));else log.aviso(msg);\n      return;\n    }\n    const anterior = snaps[snaps.length - 2];\n    const atual = snaps[snaps.length - 1];\n    const diffs = compararSnapshots(anterior, atual);\n    const regressao = diffs.filter(d => d.campo === 'tempoAnaliseMs' || d.campo === 'tempoParsingMs').some(d => d.variacaoPct > limite);\n    if (parent.json) {\n      console.log(JSON.stringify({\n        base: anterior.hashConteudo,\n        atual: atual.hashConteudo,\n        limite,\n        diffs,\n        regressao\n      }, null, 2));\n    } else {\n      log.info(CliComandoDesempMensagens.tituloComparacaoSnapshotsComIcone(ICONES_DIAGNOSTICO.info));\n      diffs.forEach(d => {\n        log.info(`  ${d.campo}: ${d.anterior ?? '-'} => ${d.novo ?? '-'} (${formatPct(d.variacaoPct)})`);\n      });\n      if (regressao) logSistema.performanceRegressaoDetectada(limite);else logSistema.performanceSemRegressoes();\n    }\n    if (regressao) {\n      sair(ExitCode.Failure);\n      return;\n    }\n  }));\n}"]}