{"version":3,"file":"comando-analistas.js","sourceRoot":"","sources":["../../../src/cli/commands/comando-analistas.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\n// @prometheus-disable PROBLEMA_PERFORMANCE\n// Justificativa: CLI command que lista analistas\nimport path from 'node:path';\n\nimport { listarAnalistas, registroAnalistas } from '@analistas/registry/registry.js';\nimport { ExitCode, sair } from '@cli/helpers/exit-codes.js';\nimport { config } from '@core/config/config.js';\nimport { CliComandoAnalistasMensagens } from '@core/messages/cli/cli-comando-analistas-messages.js';\nimport { ICONES_DIAGNOSTICO, log } from '@core/messages/index.js';\nimport { salvarEstado } from '@shared/persistence/persistencia.js';\nimport { Command } from 'commander';\n\nexport function comandoAnalistas(): Command {\n  return new Command('analistas')\n    .description(CliComandoAnalistasMensagens.descricao)\n    .option('-j, --json', CliComandoAnalistasMensagens.opcoes.json)\n    .option('-o, --output <arquivo>', CliComandoAnalistasMensagens.opcoes.output)\n    .option('-d, --doc <arquivo>', CliComandoAnalistasMensagens.opcoes.doc)\n    .action(async (opts: {\n    json?: boolean;\n    output?: string;\n    doc?: string;\n  }) => {\n    try {\n      if (process.env.PROMETHEUS_TEST_FAST === '1') {\n        if (opts.json) {\n          log.info(JSON.stringify({\n            total: 0,\n            analistas: [],\n            meta: {\n              fast: true,\n              tipo: 'analistas'\n            }\n          }, null, 2));\n          return;\n        }\n        log.info(CliComandoAnalistasMensagens.fastModeTitulo);\n        log.info(CliComandoAnalistasMensagens.fastModeTotalZero);\n        return;\n      }\n      const lista = listarAnalistas();\n      // Geração de documentação markdown\n      if (opts.doc) {\n        const destinoDoc = path.isAbsolute(opts.doc) ? opts.doc : path.join(process.cwd(), opts.doc);\n        const linhas: string[] = [];\n        linhas.push(CliComandoAnalistasMensagens.docMdTitulo);\n        linhas.push('');\n        linhas.push(CliComandoAnalistasMensagens.docGeradoEm(new Date().toISOString()));\n        linhas.push('');\n        linhas.push(CliComandoAnalistasMensagens.docTabelaHeader);\n        linhas.push(CliComandoAnalistasMensagens.docTabelaSeparador);\n        for (const a of lista) {\n          const registroOriginal = (registroAnalistas as Array<{\n            nome: string;\n            limites?: Record<string, number>;\n            categoria?: string;\n            descricao?: string;\n          }>).find(r => r.nome === a.nome);\n          let limitesStr = '';\n          if (registroOriginal?.limites) {\n            limitesStr = Object.entries(registroOriginal.limites).map(([k, v]) => `${k}:${v}`).join('<br>');\n          }\n          linhas.push(CliComandoAnalistasMensagens.docLinhaAnalista(a.nome, a.categoria, a.descricao || '', limitesStr));\n        }\n        linhas.push('');\n        await salvarEstado(destinoDoc, linhas.join('\\n'));\n        log.sucesso(CliComandoAnalistasMensagens.docGerada(destinoDoc));\n        return;\n      }\n      if (opts.output) {\n        const destino = path.isAbsolute(opts.output) ? opts.output : path.join(process.cwd(), opts.output);\n        await salvarEstado(destino, {\n          geradoEm: new Date().toISOString(),\n          total: lista.length,\n          analistas: lista,\n          configLimites: config.ANALISE_LIMITES ?? {}\n        });\n        log.sucesso(CliComandoAnalistasMensagens.jsonExportado(destino));\n        return;\n      }\n      if (opts.json) {\n        log.info(JSON.stringify({\n          total: lista.length,\n          analistas: lista\n        }, null, 2));\n        return;\n      }\n      log.info(CliComandoAnalistasMensagens.titulo);\n      for (const a of lista) {\n        log.info(CliComandoAnalistasMensagens.linhaAnalista(a.nome, a.categoria, a.descricao));\n      }\n      log.info(CliComandoAnalistasMensagens.tituloComIcone(ICONES_DIAGNOSTICO.info));\n      log.info(CliComandoAnalistasMensagens.total(registroAnalistas.length));\n    } catch (err) {\n      log.erro(CliComandoAnalistasMensagens.erroListar(err instanceof Error ? err.message : String(err)));\n      sair(ExitCode.Failure);\n    }\n  });\n}"]}