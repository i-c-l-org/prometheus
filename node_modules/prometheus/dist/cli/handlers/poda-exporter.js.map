{"version":3,"file":"poda-exporter.js","sourceRoot":"","sources":["../../../src/cli/handlers/poda-exporter.ts"],"names":[],"mappings":"AAMA,OAAO,EAAE,QAAQ,IAAI,EAAE,EAAE,MAAM,SAAS,CAAC;AACzC,OAAO,IAAI,MAAM,WAAW,CAAC;AAE7B,OAAO,EAAE,MAAM,EAAE,MAAM,wBAAwB,CAAC;AAChD,OAAO,EAAE,qBAAqB,EAAE,MAAM,8CAA8C,CAAC;AACrF,OAAO,EAAE,GAAG,EAAE,MAAM,yBAAyB,CAAC;AAC9C,OAAO,EAAE,sBAAsB,EAAE,0BAA0B,EAAE,MAAM,+BAA+B,CAAC;AAmBnG,MAAM,CAAC,KAAK,UAAU,sBAAsB,CAAC,OAA0B;IACrE,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE,CAAC;QAClC,OAAO,IAAI,CAAC;IACd,CAAC;IACD,IAAI,CAAC;QACH,MAAM,EACJ,OAAO,EACP,OAAO,EACP,SAAS,EACT,QAAQ,EACT,GAAG,OAAO,CAAC;QAGZ,MAAM,GAAG,GAAG,OAAO,MAAM,CAAC,iBAAiB,KAAK,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;QAGvH,MAAM,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE;YAClB,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QAGH,MAAM,EAAE,GAAG,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QAC1D,MAAM,QAAQ,GAAG,mBAAmB,EAAE,EAAE,CAAC;QAGzC,MAAM,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,QAAQ,KAAK,CAAC,CAAC;QACnD,MAAM,0BAA0B,CAAC,SAAS,EAAE,OAAO,EAAE,SAAS,EAAE;YAC9D,QAAQ;SACT,CAAC,CAAC;QAGH,MAAM,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,QAAQ,OAAO,CAAC,CAAC;QACvD,MAAM,sBAAsB,CAAC,WAAW,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;QAG9D,GAAG,CAAC,OAAO,CAAC,qBAAqB,CAAC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAAC;QAClE,OAAO;YACL,QAAQ,EAAE,SAAS;YACnB,IAAI,EAAE,WAAW;YACjB,GAAG;SACJ,CAAC;IACJ,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,GAAG,CAAC,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,aAAa,CAAE,KAAe,CAAC,OAAO,CAAC,CAAC,CAAC;QAE7E,MAAM,KAAK,CAAC;IACd,CAAC;AACH,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT-0\n/**\n * Handler para exportação de relatórios de poda\n * Consolida lógica duplicada de geração de relatórios Markdown e JSON\n */\n\nimport { promises as fs } from 'node:fs';\nimport path from 'node:path';\n\nimport { config } from '@core/config/config.js';\nimport { CliExportersMensagens } from '@core/messages/cli/cli-exporters-messages.js';\nimport { log } from '@core/messages/index.js';\nimport { gerarRelatorioPodaJson, gerarRelatorioPodaMarkdown } from '@relatorios/relatorio-poda.js';\n\nimport type { PodaExportOptions, PodaExportResult } from '@';\n\n// Re-export para compatibilidade\nexport type { PodaExportOptions, PodaExportResult };\n\n/**\n * Exporta relatórios de poda (Markdown e JSON)\n *\n * Centraliza a lógica de:\n * - Criação de diretório de relatórios\n * - Geração de timestamp único\n * - Exportação em ambos os formatos\n * - Tratamento de erros\n *\n * @param options - Opções de exportação\n * @returns Caminhos dos arquivos gerados ou null em caso de erro\n */\nexport async function exportarRelatoriosPoda(options: PodaExportOptions): Promise<PodaExportResult | null> {\n  if (!config.REPORT_EXPORT_ENABLED) {\n    return null;\n  }\n  try {\n    const {\n      baseDir,\n      podados,\n      pendentes,\n      simulado\n    } = options;\n\n    // Determinar diretório de saída\n    const dir = typeof config.REPORT_OUTPUT_DIR === 'string' ? config.REPORT_OUTPUT_DIR : path.join(baseDir, 'relatorios');\n\n    // Criar diretório se não existir\n    await fs.mkdir(dir, {\n      recursive: true\n    });\n\n    // Gerar timestamp único para os arquivos\n    const ts = new Date().toISOString().replace(/[:.]/g, '-');\n    const nomeBase = `prometheus-poda-${ts}`;\n\n    // Gerar relatório Markdown\n    const caminhoMd = path.join(dir, `${nomeBase}.md`);\n    await gerarRelatorioPodaMarkdown(caminhoMd, podados, pendentes, {\n      simulado\n    });\n\n    // Gerar relatório JSON\n    const caminhoJson = path.join(dir, `${nomeBase}.json`);\n    await gerarRelatorioPodaJson(caminhoJson, podados, pendentes);\n\n    // Log de sucesso\n    log.sucesso(CliExportersMensagens.poda.relatoriosExportados(dir));\n    return {\n      markdown: caminhoMd,\n      json: caminhoJson,\n      dir\n    };\n  } catch (error) {\n    log.erro(CliExportersMensagens.poda.falhaExportar((error as Error).message));\n    // Re-throw para manter comportamento original do comando\n    throw error;\n  }\n}"]}