{"version":3,"file":"executor.js","sourceRoot":"","sources":["../../../src/core/execution/executor.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\nimport crypto from 'node:crypto';\n\nimport { config } from '@core/config/config.js';\nimport { formatMs } from '@core/config/format.js';\nimport { log, logCore, MENSAGENS_EXECUTOR } from '@core/messages/index.js';\nimport { logAnalistas } from '@core/messages/log/log-helper.js';\nimport { createDefaultReporter } from '@core/reporting/default-reporter.js';\nimport { WorkerPool } from '@core/workers/worker-pool.js';\nimport { lerEstado, salvarEstado } from '@shared/persistence/persistencia.js';\nimport XXH from 'xxhashjs';\n\nimport type { ContextoExecucao, EstadoIncremental, FileEntryWithAst, GuardianResult, MetricaAnalista, MetricaExecucao, MetricasGlobais, Ocorrencia, ReporterFn, ReportEvent,ResultadoInquisicao, Tecnica } from '@';\nimport { ocorrenciaErroAnalista } from '@';\n// Fallback para infoDestaque quando mock de log n√£o implementa\nconst __infoD = (msg: string) => {\n  const l = log as unknown as {\n    infoDestaque?: (m: string) => void;\n    info: (m: string) => void;\n  };\n  if (typeof l.infoDestaque === 'function') return l.infoDestaque(msg);\n  return l.info(msg);\n};\n/** Interface m√≠nima para emiss√£o de eventos (compat√≠vel com EventEmitter ou objeto custom). */\nexport interface ExecutorEventEmitter {\n  emit(event: string, data?: unknown): void;\n}\n\nexport async function executarInquisicao(fileEntriesComAst: FileEntryWithAst[], tecnicas: Tecnica[], baseDir: string, guardianResultado: GuardianResult, opts?: {\n  verbose?: boolean;\n  compact?: boolean;\n  fast?: boolean;\n  /** Opcional: emissor de eventos para file:processed e analysis:complete */\n  events?: ExecutorEventEmitter;\n  /** Opcional: reporter customizado (injet√°vel) */\n  reporter?: ReporterFn;\n}): Promise<ResultadoInquisicao> {\n  const ocorrencias: Ocorrencia[] = [];\n  const metricasAnalistas: MetricaAnalista[] = [];\n  const arquivosValidosSet = new Set(fileEntriesComAst.map(f => f.relPath));\n  const emitter = opts?.events;\n  const contextoGlobalBase: ContextoExecucao = {\n    baseDir,\n    arquivos: fileEntriesComAst,\n    ambiente: {\n      arquivosValidosSet,\n      guardian: guardianResultado\n    }\n  };\n  const reporter: ReporterFn = (opts?.reporter as ReporterFn) ?? createDefaultReporter();\n  const inicioExecucao = performance.now();\n\n  // Narrowing helper: detecta se um objeto se parece com NodePath do babel\n  function isNodePath(x // Type guard intencional: aceita entrada arbitr√°ria para valida√ß√£o estrutural\n    : unknown): x is import('@babel/traverse').NodePath<import('@babel/types').Node> {\n    if (typeof x !== 'object' || x === null) return false;\n    const maybe = x as Record<string, unknown>;\n    if (!('node' in maybe)) return false;\n    const node = maybe.node as unknown;\n    if (typeof node !== 'object' || node === null) return false;\n    return 'type' in (node as Record<string, unknown>);\n  }\n\n  // Incremental: carregar estado anterior (tipo importado de @types)\n  let estadoIncremental: EstadoIncremental | null = null;\n  if (config.ANALISE_INCREMENTAL_ENABLED) {\n    const lido = await lerEstado<EstadoIncremental>(config.ANALISE_INCREMENTAL_STATE_PATH).catch(() => null);\n    if (lido && lido.versao === config.ANALISE_INCREMENTAL_VERSION) estadoIncremental = lido;\n  }\n  const novoEstado: EstadoIncremental = {\n    versao: config.ANALISE_INCREMENTAL_VERSION,\n    arquivos: {},\n    estatisticas: {\n      totalReaproveitamentos: 0,\n      totalArquivosProcessados: 0,\n      ultimaDuracaoMs: 0\n    }\n  };\n  function hashConteudo(c: string) {\n    try {\n      // Usa xxhash64 (seed arbitr√°ria) para performance\n      return XXH.h64(c, 0xabcd).toString(16);\n    } catch {\n      // Fallback para SHA1 se algo der errado\n      // SHA1 usado apenas para cache de AST (fingerprinting de conte√∫do)\n      // N√£o √© usado para seguran√ßa/criptografia - contexto: deduplica√ß√£o de parsing\n      return crypto.createHash('sha1').update(c).digest('hex');\n    }\n  }\n\n  // T√©cnicas globais\n  for (const tecnica of tecnicas) {\n    if (tecnica.global) {\n      // in√≠cio medido apenas por analista espec√≠fico (inicioAnalista)\n      const timeoutMs = config.ANALISE_TIMEOUT_POR_ANALISTA_MS;\n      try {\n        const inicioAnalista = performance.now();\n\n        // Implementa timeout para analistas globais se configurado\n        let resultado: Awaited<ReturnType<typeof tecnica.aplicar>> | undefined;\n        if (timeoutMs > 0) {\n          // Promise.race entre execu√ß√£o do analista global e timeout\n          const execPromise = tecnica.aplicar('', '', null, undefined, contextoGlobalBase);\n          resultado = await (async () => {\n            let timer: NodeJS.Timeout | null = null;\n            try {\n              const race = Promise.race([execPromise, new Promise<never>((_, reject) => {\n                timer = setTimeout(() => reject(new Error(`Timeout: analista global '${tecnica.nome}' excedeu ${timeoutMs}ms`)), timeoutMs);\n              })]);\n              return await race;\n            } finally {\n              if (timer) clearTimeout(timer);\n            }\n          })();\n        } else {\n          // Execu√ß√£o sem timeout\n          resultado = await tecnica.aplicar('', '', null, undefined, contextoGlobalBase);\n        }\n        if (Array.isArray(resultado)) {\n          ocorrencias.push(...resultado);\n        }\n        const duracaoMs = performance.now() - inicioAnalista;\n        if (config.ANALISE_METRICAS_ENABLED) {\n          metricasAnalistas.push({\n            nome: tecnica.nome || 'desconhecido',\n            duracaoMs,\n            ocorrencias: Array.isArray(resultado) ? resultado.length : resultado ? 1 : 0,\n            global: true\n          });\n        }\n        if (opts?.verbose) {\n          log.sucesso(MENSAGENS_EXECUTOR.tecnicaGlobalSucesso(tecnica.nome || 'desconhecido'));\n        }\n        if (config.LOG_ESTRUTURADO) {\n          log.info(JSON.stringify({\n            tipo: 'analista',\n            escopo: 'global',\n            nome: tecnica.nome,\n            duracaoMs,\n            ocorrencias: metricasAnalistas.at(-1)?.ocorrencias\n          }));\n        }\n      } catch (error) {\n        const err = error as Error;\n        const isTempoLimite = err.message.includes('Timeout: analista global');\n        const nivelLog = isTempoLimite ? 'aviso' : 'erro';\n\n        // Log apropriado baseado no tipo de erro\n        if (nivelLog === 'aviso') {\n          log.aviso(MENSAGENS_EXECUTOR.tecnicaGlobalTimeout(tecnica.nome || 'desconhecido'));\n        } else {\n          log.erro(MENSAGENS_EXECUTOR.tecnicaGlobalErro(tecnica.nome || 'desconhecido', err.message));\n          // Exibe stack trace em modo verbose ou debug\n          if (err.stack) {\n            if (opts?.verbose || config.DEV_MODE) {\n              log.info(MENSAGENS_EXECUTOR.stackTrace);\n              log.info(err.stack);\n            }\n          }\n        }\n\n        // Registra ocorr√™ncia de erro/timeout\n        ocorrencias.push(ocorrenciaErroAnalista({\n          mensagem: isTempoLimite\n            ? MENSAGENS_EXECUTOR.tecnicaGlobalTimeoutOcorrencia(tecnica.nome || 'desconhecido', timeoutMs)\n            : MENSAGENS_EXECUTOR.tecnicaGlobalErroOcorrencia(tecnica.nome || 'desconhecido', err.message),\n          relPath: '[execu√ß√£o global]',\n          origem: tecnica.nome,\n          stack: !isTempoLimite && err.stack ? err.stack : undefined\n        }));\n      }\n    }\n  }\n\n  // Modo Fast: usar WorkerPool para processamento paralelo\n  if (opts?.fast && fileEntriesComAst.length > 0) {\n    log.info(MENSAGENS_EXECUTOR.fastModeAtivado);\n    const workerPool = new WorkerPool({\n      enabled: true,\n      maxWorkers: config.WORKER_POOL_MAX_WORKERS || undefined,\n      batchSize: 10,\n      timeoutMs: config.ANALISE_TIMEOUT_POR_ANALISTA_MS\n    });\n    // Importante: n√£o passar fun√ß√µes (ex.: contexto.report) para worker threads.\n    const resultadoWorkers = await workerPool.processFiles(\n      fileEntriesComAst,\n      tecnicas.filter(t => !t.global),\n      // Apenas t√©cnicas n√£o-globais\n      contextoGlobalBase,\n    );\n    ocorrencias.push(...resultadoWorkers.occurrences);\n    metricasAnalistas.push(...resultadoWorkers.metrics);\n    const duracaoTotal = performance.now() - inicioExecucao;\n    log.sucesso(MENSAGENS_EXECUTOR.analiseRapidaConcluida(fileEntriesComAst.length, formatMs(duracaoTotal)));\n\n    // Salvar estado incremental (se habilitado)\n    if (config.ANALISE_INCREMENTAL_ENABLED) {\n      try {\n        for (const entry of fileEntriesComAst) {\n          const hash = hashConteudo(entry.content ?? '');\n          novoEstado.arquivos[entry.relPath] = {\n            hash,\n            ocorrencias: [],\n            reaproveitadoCount: 0\n          };\n        }\n        if (novoEstado.estatisticas) {\n          novoEstado.estatisticas.totalArquivosProcessados = fileEntriesComAst.length;\n          novoEstado.estatisticas.ultimaDuracaoMs = duracaoTotal;\n        }\n        await salvarEstado(config.ANALISE_INCREMENTAL_STATE_PATH, novoEstado);\n      } catch {\n        /* Ignora erro ao salvar cache */\n      }\n    }\n    const metricasExecucao: MetricaExecucao = {\n      totalArquivos: fileEntriesComAst.length,\n      tempoTotal: duracaoTotal,\n      ocorrenciasEncontradas: ocorrencias.length,\n      analistas: metricasAnalistas,\n      workerPool: {\n        workersAtivos: resultadoWorkers.totalProcessed,\n        duracaoTotalMs: resultadoWorkers.duration\n      }\n    };\n\n    // Retorna resultado do processamento paralelo\n    const resultadoFast: ResultadoInquisicao = {\n      totalArquivos: fileEntriesComAst.length,\n      arquivosAnalisados: fileEntriesComAst.map(e => e.relPath),\n      ocorrencias,\n      timestamp: Date.now(),\n      duracaoMs: duracaoTotal,\n      metricas: metricasExecucao\n    };\n    if (emitter) {\n      emitter.emit('analysis:complete', resultadoFast);\n    }\n    return resultadoFast;\n  }\n\n  // T√©cnicas por arquivo (modo sequencial padr√£o)\n  const contextoGlobal: ContextoExecucao = {\n    ...contextoGlobalBase,\n    report: (event) => {\n      try {\n        const oc = reporter(event as ReportEvent);\n        if (oc) ocorrencias.push(oc);\n      } catch (e) {\n        // Reporter nunca deve quebrar a an√°lise; se falhar, emite ocorr√™ncia gen√©rica.\n        ocorrencias.push(ocorrenciaErroAnalista({\n          mensagem: `Falha no reporter: ${(e as Error).message}`,\n          relPath: event?.relPath || '[report]',\n          origem: 'reporter'\n        }));\n      }\n    }\n  };\n  let arquivoAtual = 0;\n  const totalArquivos = fileEntriesComAst.length;\n  // Limiar para logs detalhados por arquivo\n  const LIMIAR_DETALHE_TOTAL = 100; // at√© aqui permite detalhar por arquivo\n  const LIMIAR_DETALHE_LIMITADO_MAX = 250; // at√© aqui permite \"Arquivo X/Y\" com throttle\n  // Define passo de logging quando em modo verbose para evitar spam massivo\n\n  function passoDeLog(total: number): number {\n    // Assumimos faixas: at√© 100 => cada arquivo; 101-250 => a cada 10; 251-500 => a cada 25; >500 => a cada 100\n    if (total <= 100) return 1;\n    if (total <= 250) return 10;\n    if (total <= 500) return 25;\n    return 100;\n  }\n  const stepVerbose = passoDeLog(totalArquivos);\n  const detalharPorArquivo = (opts?.verbose ?? false) && totalArquivos <= LIMIAR_DETALHE_TOTAL;\n  const permitirArquivoXY = (opts?.verbose ?? false) && totalArquivos <= LIMIAR_DETALHE_LIMITADO_MAX;\n\n  // üéØ Inicializa sistema de logs inteligente\n  logAnalistas.iniciarBatch(totalArquivos);\n  for (const entry of fileEntriesComAst) {\n    arquivoAtual++;\n    if (opts?.compact) {\n      if (arquivoAtual === totalArquivos) {\n        log.info(MENSAGENS_EXECUTOR.arquivosAnalisadosTotal(totalArquivos));\n      }\n    } else if (opts?.verbose) {\n      // Em verbose: detalha por arquivo somente at√© o limiar; entre 101-250 mostra \"Arquivo X/Y\" com throttle; acima disso, s√≥ resumo de progresso.\n      if (permitirArquivoXY) {\n        if (arquivoAtual === 1 || arquivoAtual % stepVerbose === 0 || arquivoAtual === totalArquivos) {\n          log.info(MENSAGENS_EXECUTOR.arquivoProcessando(arquivoAtual, totalArquivos, entry.relPath));\n        }\n      } else {\n        if (arquivoAtual === 1 || arquivoAtual % stepVerbose === 0 || arquivoAtual === totalArquivos) {\n          log.info(MENSAGENS_EXECUTOR.arquivosAnalisadosProgress(arquivoAtual, totalArquivos));\n        }\n      }\n    } else if (arquivoAtual % 50 === 0 || arquivoAtual === totalArquivos) {\n      // Modo padr√£o: log apenas a cada 50 arquivos para reduzir ru√≠do\n      if (arquivoAtual === totalArquivos) {\n        __infoD(MENSAGENS_EXECUTOR.arquivosAnalisadosProgress(arquivoAtual, totalArquivos));\n      }\n    }\n    // Verifica incremento\n    const conteudo = entry.content ?? '';\n    const h = hashConteudo(conteudo);\n    const cacheAnterior = estadoIncremental?.arquivos[entry.relPath];\n    let reaproveitou = false;\n    if (config.ANALISE_INCREMENTAL_ENABLED && cacheAnterior && cacheAnterior.hash === h) {\n      // Reaproveita ocorr√™ncias anteriores do arquivo\n      ocorrencias.push(...cacheAnterior.ocorrencias);\n      novoEstado.arquivos[entry.relPath] = cacheAnterior; // mant√©m\n      novoEstado.arquivos[entry.relPath].reaproveitadoCount = (cacheAnterior.reaproveitadoCount || 0) + 1;\n      if (novoEstado.estatisticas) {\n        novoEstado.estatisticas.totalReaproveitamentos = (novoEstado.estatisticas.totalReaproveitamentos || 0) + 1;\n      }\n      reaproveitou = true;\n      if (detalharPorArquivo) logCore.reaproveitadoIncremental(entry.relPath);\n      if (config.LOG_ESTRUTURADO) {\n        log.info(JSON.stringify({\n          tipo: 'incremental-reuse',\n          arquivo: entry.relPath,\n          ocorrencias: cacheAnterior.ocorrencias.length\n        }));\n      }\n    }\n    if (reaproveitou) continue; // pula analistas\n\n    for (const tecnica of tecnicas) {\n      if (tecnica.global) continue;\n      if (tecnica.test && !tecnica.test(entry.relPath)) continue;\n      // in√≠cio medido apenas por analista espec√≠fico (inicioAnalista)\n      const timeoutMs = config.ANALISE_TIMEOUT_POR_ANALISTA_MS;\n      try {\n        const inicioAnalista = performance.now();\n\n        // Log adaptativo: in√≠cio da an√°lise\n        const tamanhoArquivo = entry.content ? Math.round(entry.content.length / 1024) : 0;\n        logAnalistas.iniciandoAnalista(tecnica.nome || 'analista-desconhecido', entry.relPath, tamanhoArquivo);\n\n        // Implementa timeout por analista se configurado\n        let resultado: Awaited<ReturnType<typeof tecnica.aplicar>> | undefined;\n        if (timeoutMs > 0) {\n          // Promise.race entre execu√ß√£o do analista e timeout\n          const astParam = isNodePath(entry.ast) ? entry.ast as import('@babel/traverse').NodePath<import('@babel/types').Node> : null;\n          const execPromise = tecnica.aplicar(entry.content ?? '', entry.relPath, astParam, entry.fullCaminho, contextoGlobal);\n          resultado = await (async () => {\n            let timer: NodeJS.Timeout | null = null;\n            try {\n              const race = Promise.race([execPromise, new Promise<never>((_, reject) => {\n                timer = setTimeout(() => reject(new Error(`Timeout: analista '${tecnica.nome}' excedeu ${timeoutMs}ms para ${entry.relPath}`)), timeoutMs);\n              })]);\n              return await race;\n            } finally {\n              if (timer) clearTimeout(timer);\n            }\n          })();\n        } else {\n          // Execu√ß√£o sem timeout\n          const astParam2 = isNodePath(entry.ast) ? entry.ast as import('@babel/traverse').NodePath<import('@babel/types').Node> : null;\n          resultado = await tecnica.aplicar(entry.content ?? '', entry.relPath, astParam2, entry.fullCaminho, contextoGlobal);\n        }\n        if (Array.isArray(resultado)) {\n          ocorrencias.push(...resultado);\n        }\n        const duracaoMs = performance.now() - inicioAnalista;\n        if (config.ANALISE_METRICAS_ENABLED) {\n          metricasAnalistas.push({\n            nome: tecnica.nome || 'desconhecido',\n            duracaoMs,\n            ocorrencias: Array.isArray(resultado) ? resultado.length : resultado ? 1 : 0,\n            global: false\n          });\n        }\n\n        // Log adaptativo: conclus√£o da an√°lise\n        const ocorrenciasContagem = Array.isArray(resultado) ? resultado.length : resultado ? 1 : 0;\n        logAnalistas.concluido(tecnica.nome || 'analista-desconhecido', entry.relPath, ocorrenciasContagem, duracaoMs);\n        if (detalharPorArquivo) {\n          log.info(MENSAGENS_EXECUTOR.analiseCompleta(tecnica.nome || 'desconhecido', entry.relPath, formatMs(duracaoMs)));\n        }\n        if (config.LOG_ESTRUTURADO) {\n          log.info(JSON.stringify({\n            tipo: 'analista',\n            arquivo: entry.relPath,\n            nome: tecnica.nome,\n            duracaoMs,\n            ocorrencias: metricasAnalistas.at(-1)?.ocorrencias\n          }));\n        }\n      } catch (error) {\n        const err = error as Error;\n        const isTempoLimite = err.message.includes('Timeout: analista');\n        const nivelLog = isTempoLimite ? 'aviso' : 'erro';\n\n        // Log adaptativo para erros e timeouts\n        if (isTempoLimite) {\n          const duracaoEstimada = config.ANALISE_TIMEOUT_POR_ANALISTA_MS || 30000;\n          logAnalistas.timeout(tecnica.nome || 'analista-desconhecido', duracaoEstimada);\n        } else {\n          logAnalistas.erro(tecnica.nome || 'analista-desconhecido', err.message);\n        }\n\n        // Log apropriado baseado no tipo de erro\n        if (nivelLog === 'aviso') {\n          log.aviso(MENSAGENS_EXECUTOR.tecnicaLocalErro(tecnica.nome || 'desconhecido', entry.relPath, err.message));\n        } else {\n          log.erro(MENSAGENS_EXECUTOR.tecnicaLocalErro(tecnica.nome || 'desconhecido', entry.relPath, err.message));\n          // Exibe stack trace em modo verbose ou debug\n          if (err.stack) {\n            if (opts?.verbose || config.DEV_MODE) {\n              log.info(MENSAGENS_EXECUTOR.stackTrace);\n              log.info(err.stack);\n            }\n          }\n        }\n\n        // Registra ocorr√™ncia de erro/timeout com stack trace\n        ocorrencias.push(ocorrenciaErroAnalista({\n          mensagem: isTempoLimite\n            ? MENSAGENS_EXECUTOR.tecnicaLocalTimeoutOcorrencia(tecnica.nome || 'desconhecido', entry.relPath, timeoutMs)\n            : MENSAGENS_EXECUTOR.tecnicaLocalErroOcorrencia(tecnica.nome || 'desconhecido', entry.relPath, err.message),\n          relPath: entry.relPath,\n          origem: tecnica.nome,\n          stack: !isTempoLimite && err.stack ? err.stack : undefined\n        }));\n      }\n    }\n    // Salva estado incremental do arquivo processado\n    if (config.ANALISE_INCREMENTAL_ENABLED) {\n      const ocorrArq = ocorrencias.filter(o => o.relPath === entry.relPath);\n      // Extrai m√©tricas por analista espec√≠ficas do arquivo\n      const analistasArquivo: Record<string, {\n        ocorrencias: number;\n        duracaoMs: number;\n      }> = {};\n      for (const m of metricasAnalistas.filter(m => !m.global)) {\n        analistasArquivo[m.nome] = {\n          ocorrencias: m.ocorrencias,\n          duracaoMs: m.duracaoMs\n        };\n      }\n      novoEstado.arquivos[entry.relPath] = {\n        hash: h,\n        ocorrencias: ocorrArq,\n        analistas: analistasArquivo,\n        ultimaExecucaoMs: Date.now(),\n        reaproveitadoCount: 0\n      };\n      if (novoEstado.estatisticas) {\n        novoEstado.estatisticas.totalArquivosProcessados = (novoEstado.estatisticas.totalArquivosProcessados || 0) + 1;\n      }\n    }\n\n    // üéØ NOVO: Atualiza progresso por arquivo (n√£o por analista)\n    logAnalistas.arquivoProcessado();\n    if (emitter) {\n      const ocorrArquivo = ocorrencias.filter(o => o.relPath === entry.relPath);\n      emitter.emit('file:processed', { relPath: entry.relPath, ocorrencias: ocorrArquivo.length });\n    }\n  }\n  const fimExecucao = performance.now();\n  const duracaoMs = Math.round(fimExecucao - inicioExecucao);\n\n  // üéØ Finaliza sistema de logs inteligente\n  logAnalistas.finalizarBatch(ocorrencias.length, duracaoMs);\n\n  // Agrega√ß√£o de m√©tricas\n  let metricasExecucao: MetricaExecucao | null = null;\n  if (config.ANALISE_METRICAS_ENABLED) {\n    const metricasGlobais: MetricasGlobais = (globalThis as unknown as Record<string, unknown>).__PROMETHEUS_METRICAS__ as MetricasGlobais || {\n      parsingTimeMs: 0,\n      cacheHits: 0,\n      cacheMiss: 0\n    };\n    metricasExecucao = {\n      totalArquivos: fileEntriesComAst.length,\n      tempoParsingMs: Math.round(metricasGlobais.parsingTimeMs),\n      tempoAnaliseMs: duracaoMs,\n      cacheAstHits: metricasGlobais.cacheHits,\n      cacheAstMiss: metricasGlobais.cacheMiss,\n      analistas: metricasAnalistas\n    };\n    if (config.LOG_ESTRUTURADO) {\n      log.info(JSON.stringify({\n        tipo: 'metricas',\n        ...metricasExecucao\n      }));\n    }\n    // Persistir hist√≥rico\n    try {\n      const historicoCaminho = config.ANALISE_METRICAS_HISTORICO_PATH as string | undefined;\n      if (historicoCaminho) {\n        type RegistroHistorico = MetricaExecucao & {\n          timestamp: number;\n        };\n        const anterior = await lerEstado<unknown>(historicoCaminho).catch(() => [] as RegistroHistorico[]);\n        const lista = Array.isArray(anterior) ? anterior as RegistroHistorico[] : [];\n        lista.push({\n          ...metricasExecucao,\n          timestamp: Date.now()\n        });\n        const max = config.ANALISE_METRICAS_HISTORICO_MAX || 200;\n        const recortado = lista.slice(-max);\n        await salvarEstado(historicoCaminho, recortado);\n      }\n    } catch (e) {\n      // Sempre registra em DEV e tamb√©m em execu√ß√£o normal para visibilidade dos testes\n      log.erro(MENSAGENS_EXECUTOR.falhaPersistirMetricas((e as Error).message));\n    }\n  }\n\n  // Persistir incremental\n  if (config.ANALISE_INCREMENTAL_ENABLED) {\n    if (novoEstado.estatisticas) {\n      novoEstado.estatisticas.ultimaDuracaoMs = duracaoMs;\n    }\n    await salvarEstado(config.ANALISE_INCREMENTAL_STATE_PATH, novoEstado);\n    if (config.LOG_ESTRUTURADO) {\n      log.info(JSON.stringify({\n        tipo: 'incremental-salvo',\n        arquivos: Object.keys(novoEstado.arquivos).length,\n        totalReaproveitamentos: novoEstado.estatisticas?.totalReaproveitamentos,\n        processados: novoEstado.estatisticas?.totalArquivosProcessados\n      }));\n    }\n  }\n  const resultado: ResultadoInquisicao = {\n    totalArquivos: fileEntriesComAst.length,\n    arquivosAnalisados: fileEntriesComAst.map(e => e.relPath),\n    ocorrencias,\n    timestamp: Date.now(),\n    duracaoMs,\n    metricas: metricasExecucao || undefined\n  };\n  if (emitter) {\n    emitter.emit('analysis:complete', resultado);\n  }\n  return resultado;\n}\n\n// Hook simples para expor √∫ltima m√©trica de execu√ß√£o (consumido por comando perf baseline)\n\nexport function registrarUltimasMetricas(metricas: MetricaExecucao | undefined): void {\n  try {\n    (globalThis as unknown as {\n      __ULTIMAS_METRICAS_PROMETHEUS__?: MetricaExecucao | null;\n    }).__ULTIMAS_METRICAS_PROMETHEUS__ = metricas || null;\n  } catch {\n    /* ignore */\n  }\n}"]}