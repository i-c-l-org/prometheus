{"version":3,"file":"detector-qualidade-testes.js","sourceRoot":"","sources":["../../../src/analistas/plugins/detector-qualidade-testes.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport type { NodePath } from '@babel/traverse';\nimport type { Node } from '@babel/types';\nimport { DetectorAgregadosMensagens } from '@core/messages/analistas/detector-agregados-messages.js';\nimport { detectarContextoProjeto } from '@shared/contexto-projeto.js';\n\nimport type { Analista, Ocorrencia, ProblemaTeste } from '@';\nimport { criarOcorrencia } from '@';\n\nexport const analistaQualidadeTestes: Analista = {\n  nome: 'qualidade-testes',\n  categoria: 'testes',\n  descricao: 'Avalia qualidade e completude dos testes automatizados',\n  test: (relPath: string): boolean => {\n    // Analisa tanto arquivos de teste quanto código fonte\n    return /\\.(js|jsx|ts|tsx|mjs|cjs)$/.test(relPath);\n  },\n  aplicar: (src: string, relPath: string, ast: NodePath<Node> | null): Ocorrencia[] => {\n    if (!src) return [];\n    const contextoArquivo = detectarContextoProjeto({\n      arquivo: relPath,\n      conteudo: src,\n      relPath\n    });\n    const problemas: ProblemaTeste[] = [];\n    try {\n      if (contextoArquivo.isTest) {\n        // Analisar arquivos de teste\n        analisarArquivoTeste(src, problemas, relPath, ast);\n      } else {\n        // Analisar código fonte para detectar falta de testes\n        analisarCodigoFonte(src, problemas, relPath, ast);\n      }\n\n      // Converter para ocorrências\n      const ocorrencias: Ocorrencia[] = [];\n\n      // Agrupar por severidade\n      const porSeveridade = agruparPorSeveridade(problemas);\n      for (const [severidade, items] of Object.entries(porSeveridade)) {\n        if (items.length > 0) {\n          const nivel = mapearSeveridadeParaNivel(severidade as ProblemaTeste['severidade']);\n          const resumo = items.slice(0, 3).map(p => p.tipo).join(', ');\n          ocorrencias.push(criarOcorrencia({\n            tipo: 'problemas-teste',\n            nivel,\n            mensagem: DetectorAgregadosMensagens.problemasTesteResumo(severidade, resumo, items.length),\n            relPath,\n            linha: items[0].linha\n          }));\n        }\n      }\n      return ocorrencias;\n    } catch (erro) {\n      return [criarOcorrencia({\n        tipo: 'erro-analise',\n        nivel: 'aviso',\n        mensagem: DetectorAgregadosMensagens.erroAnalisarQualidadeTestes(erro),\n        relPath,\n        linha: 1\n      })];\n    }\n  }\n};\nfunction analisarArquivoTeste(src: string, problemas: ProblemaTeste[], relPath: string, ast: NodePath<Node> | null): void {\n  const linhas = src.split('\\n');\n\n  // Contadores para métricas básicas\n  let totalTestes = 0;\n  let _testesComTimeout = 0;\n  let testesComMocks = 0;\n  let blocosDescribe = 0;\n  linhas.forEach((linha, index) => {\n    const numeroLinha = index + 1;\n\n    // Contar testes\n    if (/\\b(it|test)\\s*\\(/.test(linha)) {\n      totalTestes++;\n    }\n\n    // Detectar timeouts excessivos (formato }, timeout)\n    if (/},\\s*(\\d{4,})\\s*\\)/.test(linha)) {\n      const timeout = /},\\s*(\\d{4,})\\s*\\)/.exec(linha);\n      if (timeout && parseInt(timeout[1]) > 30000) {\n        _testesComTimeout++;\n        problemas.push({\n          tipo: 'slow-test',\n          descricao: `Teste com timeout muito alto (${timeout[1]}ms)`,\n          severidade: 'media',\n          linha: numeroLinha,\n          sugestao: 'Considere otimizar o teste ou dividir em testes menores'\n        });\n      }\n    }\n\n    // Detectar blocos describe\n    if (/\\bdescribe\\s*\\(/.test(linha)) {\n      blocosDescribe++;\n    }\n\n    // Detectar uso excessivo de mocks\n    if (/\\b(mock|stub|spy)\\s*\\(/.test(linha)) {\n      testesComMocks++;\n    }\n\n    // Detectar testes que podem ser flaky\n    if (/\\b(setTimeout|setInterval|Math\\.random|Date\\.now)\\s*\\(/.test(linha)) {\n      problemas.push({\n        tipo: 'flaky-test',\n        descricao: 'Teste usa operações não-determinísticas',\n        severidade: 'alta',\n        linha: numeroLinha,\n        sugestao: 'Use mocks para operações temporais ou aleatórias'\n      });\n    }\n\n    // Detectar test smells\n    if (/\\b(only|skip)\\s*\\(/.test(linha) && !/\\/\\//.test(linha)) {\n      problemas.push({\n        tipo: 'test-smells',\n        descricao: 'Teste com .only ou .skip pode afetar execução',\n        severidade: 'media',\n        linha: numeroLinha,\n        sugestao: 'Remova .only/.skip antes de commit'\n      });\n    }\n\n    // Detectar console.log em testes (pode indicar debug)\n    if (/console\\.(log|info|warn|error)\\s*\\(/.test(linha) && !/\\/\\//.test(linha)) {\n      problemas.push({\n        tipo: 'test-smells',\n        descricao: 'Console.log em teste pode ser debug esquecido',\n        severidade: 'baixa',\n        linha: numeroLinha,\n        sugestao: 'Remova logs de debug ou use biblioteca de logging adequada'\n      });\n    }\n  });\n\n  // Análises baseadas em métricas gerais\n  if (totalTestes === 0) {\n    problemas.push({\n      tipo: 'missing-tests',\n      descricao: 'Arquivo de teste sem testes detectáveis',\n      severidade: 'alta',\n      linha: 1,\n      sugestao: 'Adicione testes usando it() ou test()'\n    });\n  }\n  if (totalTestes > 0 && blocosDescribe === 0) {\n    problemas.push({\n      tipo: 'test-smells',\n      descricao: 'Testes sem organização em blocos describe',\n      severidade: 'baixa',\n      linha: 1,\n      sugestao: 'Organize testes em blocos describe para melhor estrutura'\n    });\n  }\n  if (testesComMocks > totalTestes * 0.8) {\n    problemas.push({\n      tipo: 'mock-abuse',\n      descricao: 'Uso excessivo de mocks pode indicar acoplamento forte',\n      severidade: 'media',\n      linha: 1,\n      sugestao: 'Considere refatorar código para reduzir dependências'\n    });\n  }\n\n  // Análise AST adicional\n  if (ast) {\n    analisarTestesComAST(ast, problemas);\n  }\n}\nfunction analisarCodigoFonte(src: string, problemas: ProblemaTeste[], relPath: string, ast: NodePath<Node> | null): void {\n  // Para código fonte, verificar se há indícios de falta de testes\n\n  // Arquivos de configuração ou utilitários geralmente não precisam de testes dedicados\n  if (relPath.includes('config') || relPath.includes('.config.') || relPath.endsWith('.d.ts')) {\n    return;\n  }\n  const linhas = src.split('\\n');\n  let temExportacaoPublica = false;\n  let temFuncaoComplice = false;\n  linhas.forEach((linha, _index) => {\n    // Detectar exportações públicas\n    if (/^export\\s+(function|class|const|let|var|default)/.test(linha.trim())) {\n      temExportacaoPublica = true;\n    }\n\n    // Detectar funções com lógica complexa\n    if (/\\b(if|else|switch|for|while|try|catch)\\b/.test(linha)) {\n      temFuncaoComplice = true;\n    }\n  });\n\n  // Heurística: arquivos com exportações e lógica complexa provavelmente precisam de testes\n  if (temExportacaoPublica && temFuncaoComplice) {\n    // Verificar se existe arquivo de teste correspondente seria ideal\n    // Por ora, apenas sugerir que considere testes\n    problemas.push({\n      tipo: 'missing-tests',\n      descricao: 'Arquivo com lógica complexa pode se beneficiar de testes',\n      severidade: 'baixa',\n      linha: 1,\n      sugestao: 'Considere criar arquivo de teste correspondente'\n    });\n  }\n\n  // Análise AST para detectar código que precisa de testes\n  if (ast) {\n    analisarCodigoFonteComAST(ast, problemas);\n  }\n}\nfunction analisarTestesComAST(ast: NodePath<Node>, problemas: ProblemaTeste[]): void {\n  try {\n    ast.traverse({\n      // Detectar testes vazios ou muito simples\n      CallExpression(path) {\n        if (path.node.callee.type === 'Identifier' && (path.node.callee.name === 'it' || path.node.callee.name === 'test')) {\n          const callback = path.node.arguments[1];\n          if (callback && (callback.type === 'ArrowFunctionExpression' || callback.type === 'FunctionExpression')) {\n            // Verificar se o teste tem corpo vazio ou muito simples\n            if (callback.body.type === 'BlockStatement' && callback.body.body.length === 0) {\n              problemas.push({\n                tipo: 'test-smells',\n                descricao: 'Teste vazio detectado',\n                severidade: 'media',\n                linha: path.node.loc?.start.line || 0,\n                sugestao: 'Implemente o teste ou remova se não for necessário'\n              });\n            }\n          }\n        }\n      }\n    });\n  } catch {\n    // Ignorar erros de traverse\n  }\n}\nfunction analisarCodigoFonteComAST(ast: NodePath<Node>, problemas: ProblemaTeste[]): void {\n  try {\n    let funcoesSemTestes = 0;\n    ast.traverse({\n      // Detectar funções exportadas que precisariam de testes\n      ExportDefaultDeclaration(path) {\n        if (path.node.declaration.type === 'FunctionDeclaration') {\n          funcoesSemTestes++;\n        }\n      },\n      ExportNamedDeclaration(path) {\n        if (path.node.declaration?.type === 'FunctionDeclaration') {\n          funcoesSemTestes++;\n        }\n      }\n    });\n    if (funcoesSemTestes > 2) {\n      problemas.push({\n        tipo: 'missing-tests',\n        descricao: `${funcoesSemTestes} funções exportadas podem precisar de testes`,\n        severidade: 'media',\n        linha: 1,\n        sugestao: 'Considere criar testes unitários para funções exportadas'\n      });\n    }\n  } catch {\n    // Ignorar erros de traverse\n  }\n}\nfunction agruparPorSeveridade(problemas: ProblemaTeste[]): Record<string, ProblemaTeste[]> {\n  return problemas.reduce((acc, problema) => {\n    if (!acc[problema.severidade]) {\n      acc[problema.severidade] = [];\n    }\n    acc[problema.severidade].push(problema);\n    return acc;\n  }, {} as Record<string, ProblemaTeste[]>);\n}\nfunction mapearSeveridadeParaNivel(severidade: ProblemaTeste['severidade']): 'info' | 'aviso' | 'erro' {\n  switch (severidade) {\n    case 'alta':\n      return 'aviso';\n    case 'media':\n      return 'aviso';\n    case 'baixa':\n    default:\n      return 'info';\n  }\n}"]}