{"version":3,"file":"detector-duplicacoes.js","sourceRoot":"","sources":["../../../src/analistas/detectores/detector-duplicacoes.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\n// @prometheus-disable PROBLEMA_PERFORMANCE\n// Justificativa: detector que analisa código-fonte - loops são esperados\nimport type { NodePath } from '@babel/traverse';\nimport type { ArrowFunctionExpression, ClassMethod, FunctionDeclaration, FunctionExpression, Node, ObjectMethod } from '@babel/types';\nimport { traverse } from '@core/config/traverse.js';\nimport { DetectorAgregadosMensagens } from '@core/messages/analistas/detector-agregados-messages.js';\nimport { createHash } from 'crypto';\n\nimport type { Analista, BlocoFuncao, ContextoExecucao, DuplicacaoEncontrada, Ocorrencia, ReportEvent } from '@';\nimport { criarOcorrencia } from '@';\n\nexport const analistaDuplicacoes: Analista = {\n  nome: 'detector-duplicacoes',\n  categoria: 'estrutura',\n  descricao: 'Detecta funções e blocos de código duplicados ou muito similares',\n  limites: {\n    similaridadeMinima: 80,\n    tamanhoMinimoFuncao: 5\n  },\n  test: (relPath: string): boolean => {\n    return /\\.(js|jsx|ts|tsx|mjs|cjs)$/.test(relPath);\n  },\n  aplicar: async (src: string, relPath: string, ast: NodePath<Node> | null, fullCaminho?: string, contexto?: ContextoExecucao): Promise<Ocorrencia[]> => {\n    if (!ast || !src || !contexto) {\n      return [];\n    }\n    try {\n      // Extrair todas as funções do arquivo atual\n      const funcoesAtuais = extrairFuncoes(ast, relPath, src);\n\n      // Extrair funções de outros arquivos para comparação\n      let todasFuncoes: BlocoFuncao[] = [];\n      try {\n        todasFuncoes = await extrairFuncoesDoContexto(contexto, relPath);\n      } catch (erro) {\n        const ev = {\n          tipo: 'detector-duplicacoes-erro',\n          nivel: 'aviso' as const,\n          mensagem: DetectorAgregadosMensagens.erroAnalisarDuplicacoes(erro),\n          relPath,\n          linha: 1\n        };\n        if (contexto && typeof contexto.report === 'function') {\n          try {\n            contexto.report(ev as ReportEvent);\n            return [];\n          } catch {\n            return [criarOcorrencia({\n              tipo: 'erro_analise',\n              nivel: 'aviso',\n              mensagem: DetectorAgregadosMensagens.erroAnalisarDuplicacoes(erro),\n              relPath,\n              linha: 1\n            })];\n          }\n        }\n        return [criarOcorrencia({\n          tipo: 'erro_analise',\n          nivel: 'aviso',\n          mensagem: DetectorAgregadosMensagens.erroAnalisarDuplicacoes(erro),\n          relPath,\n          linha: 1\n        })];\n      }\n      todasFuncoes.push(...funcoesAtuais);\n\n      // Detectar duplicações\n      const duplicacoes = detectarDuplicacoes(funcoesAtuais, todasFuncoes);\n      if (duplicacoes.length === 0) {\n        return [];\n      }\n\n      // Agrupar por tipo de similaridade\n      const porTipo = agruparPorTipoSimilaridade(duplicacoes);\n      const ocorrencias: Ocorrencia[] = [];\n      for (const [tipo, dups] of Object.entries(porTipo)) {\n        if (dups.length > 0) {\n          const nivel = tipo === 'identica' ? 'aviso' : 'info';\n          const primeiraFunc = dups[0]?.funcaoA;\n          const resumo = dups.map(d => `${d.funcaoA?.nome || 'unknown'} ≈ ${d.funcaoB?.nome || 'unknown'} (${d.similaridade.toFixed(0)}%)`).slice(0, 3).join(', ');\n          ocorrencias.push(criarOcorrencia({\n            tipo: 'codigo_duplicado',\n            nivel,\n            mensagem: DetectorAgregadosMensagens.duplicacoesResumo(tipo, resumo, dups.length),\n            relPath,\n            linha: primeiraFunc?.inicio || 1\n          }));\n        }\n      }\n      return ocorrencias;\n    } catch (erro) {\n      const ev = {\n        tipo: 'detector-duplicacoes-erro',\n        nivel: 'aviso' as const,\n        mensagem: DetectorAgregadosMensagens.erroAnalisarDuplicacoes(erro),\n        relPath,\n        linha: 1\n      };\n      if (contexto && typeof contexto.report === 'function') {\n        try {\n          contexto.report(ev as ReportEvent);\n          return [];\n        } catch {\n          return [criarOcorrencia({\n            tipo: 'erro_analise',\n            nivel: 'aviso',\n            mensagem: DetectorAgregadosMensagens.erroAnalisarDuplicacoes(erro),\n            relPath,\n            linha: 1\n          })];\n        }\n      }\n      return [criarOcorrencia({\n        tipo: 'erro_analise',\n        nivel: 'aviso',\n        mensagem: DetectorAgregadosMensagens.erroAnalisarDuplicacoes(erro),\n        relPath,\n        linha: 1\n      })];\n    }\n  }\n};\nfunction extrairFuncoes(ast: NodePath<Node>, caminho: string, src: string): BlocoFuncao[] {\n  const funcoes: BlocoFuncao[] = [];\n  const linhas = src.split('\\n');\n  traverse(ast.node, {\n    FunctionDeclaration(path: NodePath<FunctionDeclaration>) {\n      const func = extrairInfoFuncao(path, caminho, 'declaration', linhas);\n      if (func) funcoes.push(func);\n    },\n    FunctionExpression(path: NodePath<FunctionExpression>) {\n      const func = extrairInfoFuncao(path, caminho, 'expression', linhas);\n      if (func) funcoes.push(func);\n    },\n    ArrowFunctionExpression(path: NodePath<ArrowFunctionExpression>) {\n      const func = extrairInfoFuncao(path, caminho, 'arrow', linhas);\n      if (func) funcoes.push(func);\n    },\n    ObjectMethod(path: NodePath<ObjectMethod>) {\n      const func = extrairInfoFuncao(path, caminho, 'method', linhas);\n      if (func) funcoes.push(func);\n    },\n    ClassMethod(path: NodePath<ClassMethod>) {\n      const func = extrairInfoFuncao(path, caminho, 'method', linhas);\n      if (func) funcoes.push(func);\n    }\n  });\n  return funcoes;\n}\nfunction extrairInfoFuncao(path: NodePath, caminho: string, tipoFuncao: BlocoFuncao['tipoFuncao'], linhas: string[]): BlocoFuncao | null {\n  const node = path.node;\n  const inicio = node.loc?.start.line || 0;\n  const fim = node.loc?.end.line || 0;\n\n  // Ignorar funções muito pequenas\n  if (fim - inicio < 3) {\n    return null;\n  }\n  const conteudo = linhas.slice(inicio - 1, fim).join('\\n');\n  const conteudoNormalizado = normalizarConteudo(conteudo);\n  // MD5 usado apenas para fingerprinting rápido de código (detecção de duplicação)\n  // Não é usado para segurança/criptografia - contexto: cache de análise estática\n  const hash = createHash('md5').update(conteudoNormalizado).digest('hex');\n\n  // Extrair nome da função\n  let nome = 'anonymous';\n  if ('id' in node && node.id && 'name' in node.id) {\n    nome = node.id.name;\n  } else if ('key' in node && node.key && 'name' in node.key) {\n    nome = node.key.name as string;\n  } else if (path.parentPath?.isVariableDeclarator()) {\n    const parent = path.parentPath.node;\n    nome = 'id' in parent && parent.id && 'name' in parent.id ? parent.id.name as string : 'assigned';\n  }\n\n  // Extrair parâmetros\n  const parametros = ('params' in node && Array.isArray(node.params) ? node.params : []).map((param: Node) => {\n    // Function parameter nodes\n    if (param.type === 'Identifier' && 'name' in param) return param.name as string; // Identifier node\n    if (param.type === 'RestElement' && 'argument' in param && param.argument && 'name' in param.argument) {\n      return `...${param.argument.name as string}`; // RestElement node\n    }\n    return param.type;\n  });\n  return {\n    hash,\n    conteudo: conteudoNormalizado,\n    nome,\n    caminho,\n    inicio,\n    fim,\n    parametros,\n    tipoFuncao,\n    codigo: conteudoNormalizado\n  };\n}\nasync function extrairFuncoesDoContexto(contexto: ContextoExecucao, caminhoAtual: string): Promise<BlocoFuncao[]> {\n  const todasFuncoes: BlocoFuncao[] = [];\n\n  // Limitar a análise a alguns arquivos para performance\n  const arquivosParaComparar = contexto.arquivos.filter(arq => arq.relPath !== caminhoAtual && arq.ast).slice(0, 20); // Limitar para evitar overhead\n\n  for (const arquivo of arquivosParaComparar) {\n    if (arquivo.ast && arquivo.content) {\n      // Verificar se o AST é do tipo correto (NodePath<Node>)\n      if ('parent' in arquivo.ast && 'node' in arquivo.ast) {\n        const funcoes = extrairFuncoes(arquivo.ast as NodePath<Node>, arquivo.relPath, arquivo.content);\n        todasFuncoes.push(...funcoes);\n      }\n    }\n  }\n  return todasFuncoes;\n}\nfunction detectarDuplicacoes(funcoesAtuais: BlocoFuncao[], todasFuncoes: BlocoFuncao[]): DuplicacaoEncontrada[] {\n  const duplicacoes: DuplicacaoEncontrada[] = [];\n  for (const funcaoAtual of funcoesAtuais) {\n    for (const outraFuncao of todasFuncoes) {\n      // Não comparar função consigo mesma\n      if (funcaoAtual.caminho === outraFuncao.caminho && funcaoAtual.inicio === outraFuncao.inicio) {\n        continue;\n      }\n      const similaridade = calcularSimilaridade(funcaoAtual, outraFuncao);\n      if (similaridade >= 80) {\n        const tipoSimilaridade = determinarTipoSimilaridade(funcaoAtual, outraFuncao, similaridade);\n        duplicacoes.push({\n          funcaoA: funcaoAtual,\n          funcaoB: outraFuncao,\n          similaridade,\n          tipoSimilaridade,\n          arquivo1: funcaoAtual.caminho || '',\n          arquivo2: outraFuncao.caminho || '',\n          bloco1: funcaoAtual,\n          bloco2: outraFuncao\n        });\n      }\n    }\n  }\n  return duplicacoes;\n}\nfunction calcularSimilaridade(funcaoA: BlocoFuncao, funcaoB: BlocoFuncao): number {\n  // Similaridade por hash (exata)\n  if (funcaoA.hash === funcaoB.hash) {\n    return 100;\n  }\n\n  // Similaridade estrutural (tokens)\n  const tokensA = tokenizar(funcaoA.conteudo || '');\n  const tokensB = tokenizar(funcaoB.conteudo || '');\n  const similaridadeJaccard = calcularJaccard(tokensA, tokensB);\n\n  // Bonus se parâmetros forem similares\n  const similaridadeParametros = calcularSimilaridadeParametros(funcaoA.parametros || [], funcaoB.parametros || []);\n  return (similaridadeJaccard * 0.8 + similaridadeParametros * 0.2) * 100;\n}\nfunction determinarTipoSimilaridade(funcaoA: BlocoFuncao, funcaoB: BlocoFuncao, similaridade: number): DuplicacaoEncontrada['tipoSimilaridade'] {\n  if (similaridade >= 95) return 'identica';\n  if (similaridade >= 85) return 'estrutural';\n  return 'semantica';\n}\nfunction normalizarConteudo(conteudo: string): string {\n  return conteudo\n  // Remover comentários\n  .replace(/\\/\\/.*$/gm, '').replace(/\\/\\*[\\s\\S]*?\\*\\//g, '')\n  // Normalizar espaços\n  .replace(/\\s+/g, ' ')\n  // Remover espaços antes/depois de símbolos\n  .replace(/\\s*([{}();,])\\s*/g, '$1').trim();\n}\nfunction tokenizar(texto: string): string[] {\n  return texto.split(/[\\s\\(\\)\\{\\}\\[\\];,\\.]+/).filter(token => token.length > 0 && !/^[0-9]+$/.test(token)); // Remover números puros\n}\nfunction calcularJaccard(tokensA: string[], tokensB: string[]): number {\n  const conjuntoA = new Set(tokensA);\n  const conjuntoB = new Set(tokensB);\n  const intersecao = new Set([...conjuntoA].filter(x => conjuntoB.has(x)));\n  const uniao = new Set([...conjuntoA, ...conjuntoB]);\n  return uniao.size === 0 ? 0 : intersecao.size / uniao.size;\n}\nfunction calcularSimilaridadeParametros(paramsA: string[], paramsB: string[]): number {\n  if (paramsA.length === 0 && paramsB.length === 0) return 1;\n  if (paramsA.length === 0 || paramsB.length === 0) return 0;\n  const maxLength = Math.max(paramsA.length, paramsB.length);\n  let matches = 0;\n  for (let i = 0; i < maxLength; i++) {\n    if (paramsA[i] === paramsB[i]) {\n      matches++;\n    }\n  }\n  return matches / maxLength;\n}\nfunction agruparPorTipoSimilaridade(duplicacoes: DuplicacaoEncontrada[]): Record<string, DuplicacaoEncontrada[]> {\n  return duplicacoes.reduce((acc, dup) => {\n    const tipo = dup.tipoSimilaridade;\n    if (tipo) {\n      if (!acc[tipo]) {\n        acc[tipo] = [];\n      }\n      acc[tipo].push(dup);\n    }\n    return acc;\n  }, {} as Record<string, DuplicacaoEncontrada[]>);\n}"]}