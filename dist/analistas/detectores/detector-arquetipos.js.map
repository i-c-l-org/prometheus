{"version":3,"file":"detector-arquetipos.js","sourceRoot":"","sources":["../../../src/analistas/detectores/detector-arquetipos.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n// @prometheus-disable PROBLEMA_PERFORMANCE\n// Justificativa: detector que analisa c√≥digo-fonte - loops s√£o esperados\n// Nota: manter ARQUETIPOS importado vis√≠vel como lembrete para integra√ß√£o futura\nimport path from 'node:path';\n\nimport { extrairSinaisAvancados } from '@analistas/arquitetos/sinais-projeto-avancados.js';\nimport { ARQUETIPOS } from '@analistas/estrategistas/arquetipos-defs.js';\nimport { OperarioEstrutura } from '@analistas/estrategistas/operario-estrutura.js';\nimport { carregarArquetipoPersonalizado, integrarArquetipos, obterArquetipoOficial } from '@analistas/js-ts/arquetipos-personalizados.js';\nimport { scoreArquetipoAvancado } from '@analistas/pontuadores/pontuador.js';\nimport { config } from '@core/config/config.js';\nimport { lerEstado, salvarEstado } from '@shared/persistence/persistencia.js';\n\nimport type { ArquetipoDrift, ArquetipoEstruturaDef, ArquetipoPersonalizado, ContextoExecucao, PackageJson, ResultadoContexto, ResultadoDeteccaoArquetipo, SinaisProjetoAvancados, SnapshotEstruturaBaseline } from '@';\n\nfunction scoreArquetipo(def: ArquetipoEstruturaDef, arquivos: string[], _sinaisAvancados: SinaisProjetoAvancados): ResultadoDeteccaoArquetipo {\n  // Implementa√ß√£o simplificada tempor√°ria.\n  // Mantemos a assinatura e a forma do retorno para compatibilidade.\n  const matchedRequired: string[] = (def.requiredDirs || []).filter(d => arquivos.some(f => f.startsWith(`${d}/`) || f === d));\n  const missingRequired: string[] = (def.requiredDirs || []).filter(d => !matchedRequired.includes(d));\n  return {\n    nome: def.nome,\n    score: def.pesoBase ? def.pesoBase * 10 : 10,\n    confidence: 50,\n    matchedRequired,\n    missingRequired,\n    matchedOptional: [],\n    dependencyMatches: [],\n    filePadraoMatches: [],\n    forbiddenPresent: [],\n    anomalias: [],\n    sugestaoPadronizacao: '',\n    explicacaoSimilaridade: '',\n    descricao: def.descricao || '',\n    candidatoExtra: undefined\n  };\n}\n\n// Exposi√ß√£o somente para testes (n√£o altera API p√∫blica)\n// Evita exportar diretamente para n√£o vazar em produ√ß√£o\nif (process.env.VITEST) {\n  type TestExports = Record<string, unknown> & {\n    scoreArquetipo: typeof scoreArquetipo;\n  };\n  const g = globalThis as unknown as {\n    __PROMETHEUS_TESTS__?: TestExports;\n  };\n  const prev = g.__PROMETHEUS_TESTS__ ?? {} as TestExports;\n  g.__PROMETHEUS_TESTS__ = {\n    ...prev,\n    scoreArquetipo\n  };\n}\nexport async function detectarArquetipos(contexto: Pick<ContextoExecucao, 'arquivos' | 'baseDir'>, baseDir: string, options?: {\n  quiet?: boolean;\n}): Promise<{\n  candidatos: ResultadoDeteccaoArquetipo[];\n  baseline?: SnapshotEstruturaBaseline;\n  drift?: ArquetipoDrift;\n  arquetipoPersonalizado?: ArquetipoPersonalizado | null; // Para compatibilidade futura\n}> {\n  if (!options?.quiet && config.VERBOSE) {\n    console.log('üîç detectarArquetipos chamado com', contexto.arquivos.length, 'arquivos');\n  }\n  const arquivos = contexto.arquivos.map(f => f.relPath);\n\n  // Carregar arqu√©tipo personalizado se existir\n  const arquetipoPersonalizado = await carregarArquetipoPersonalizado(baseDir);\n  let arquetiposParaAvaliar = ARQUETIPOS;\n\n  // Se h√° arqu√©tipo personalizado, integr√°-lo com o oficial\n  if (arquetipoPersonalizado) {\n    const arquetipoOficial = obterArquetipoOficial(arquetipoPersonalizado);\n    if (arquetipoOficial) {\n      const arquetipoIntegrado = integrarArquetipos(arquetipoPersonalizado, arquetipoOficial);\n      // Substituir o oficial pelo personalizado na lista de avalia√ß√£o\n      arquetiposParaAvaliar = ARQUETIPOS.map((arq: ArquetipoEstruturaDef) => arq.nome === arquetipoPersonalizado.arquetipoOficial ? arquetipoIntegrado : arq);\n    }\n  }\n\n  // Extrai sinais avan√ßados do projeto\n  let packageJsonParaSinais: PackageJson = {};\n  try {\n    packageJsonParaSinais = (await lerEstado(path.join(baseDir, 'package.json'))) as PackageJson;\n  } catch {\n    // Package.json n√£o encontrado - usar objeto vazio\n    packageJsonParaSinais = {};\n  }\n  const sinaisAvancados = extrairSinaisAvancados(contexto.arquivos, packageJsonParaSinais, undefined, baseDir, arquivos);\n\n  // Pontua todos os arqu√©tipos dispon√≠veis usando sinais avan√ßados\n  let candidatos: ResultadoDeteccaoArquetipo[] = arquetiposParaAvaliar.map((def: ArquetipoEstruturaDef) => scoreArquetipoAvancado(def, arquivos, sinaisAvancados));\n\n  // üöÄ INTEGRA√á√ÉO SISTEMA INTELIGENTE: Aplicar boost contextual\n  if (!options?.quiet && config.VERBOSE) {\n    console.log('üîç Tentando chamar detector contextual...');\n  }\n  try {\n    const {\n      detectarContextoInteligente\n    } = await import('./detector-contexto-inteligente.js');\n    const estruturaDetectada = arquivos; // Lista de caminhos\n    // Carregar package.json com tratamento de erro adequado\n    let packageJsonContent: PackageJson = {};\n    try {\n      packageJsonContent = (await lerEstado(path.join(baseDir, 'package.json'))) as PackageJson;\n    } catch {\n      // Package.json n√£o encontrado ou inv√°lido - usar objeto vazio\n      packageJsonContent = {};\n    }\n    const resultadosContextuais = detectarContextoInteligente(estruturaDetectada, contexto.arquivos, packageJsonContent, { ...(options || {}), contexto }) as ResultadoContexto[];\n\n    // Pegar o resultado com maior confian√ßa\n    const melhorDeteccao = resultadosContextuais.reduce((melhor: ResultadoContexto, atual: ResultadoContexto) => atual.confiancaTotal > melhor.confiancaTotal ? atual : melhor, {\n      confiancaTotal: 0\n    });\n    if (melhorDeteccao && melhorDeteccao.confiancaTotal > 0.6) {\n      // Escala 0-1, n√£o 0-100\n      // Mapear tecnologias detectadas para arqu√©tipos conhecidos\n      const mapeamentoTecnologia: Record<string, string[]> = {\n        'discord-bot': ['bot-discord', 'bot', 'discord-bot'],\n        'telegram-bot': ['bot-telegram', 'bot', 'telegram-bot'],\n        'express-api': ['api-rest-express', 'api-rest', 'express-api'],\n        'fastify-api': ['api-rest-fastify', 'api-rest', 'fastify-api'],\n        'nestjs-api': ['api-rest-nestjs', 'api-rest', 'nestjs-api'],\n        'cli-modular': ['cli-modular', 'cli', 'cli-tool'],\n        'electron-app': ['electron-app', 'electron', 'desktop-app'],\n        'nextjs-app': ['nextjs-app', 'nextjs', 'fullstack'],\n        'react-spa': ['react-spa', 'react', 'spa']\n      };\n      const tecnologiaDetectada = melhorDeteccao.tecnologia ?? 'desconhecido';\n      const arquetiposCandidatos: string[] = mapeamentoTecnologia[tecnologiaDetectada] || [];\n\n      // Aplicar boost de confian√ßa para arqu√©tipos relacionados\n      let boostAplicado = false;\n      candidatos = candidatos.map((candidato: ResultadoDeteccaoArquetipo) => {\n        if (arquetiposCandidatos.some((arq: string) => candidato.nome.includes(arq) || arq.includes(candidato.nome))) {\n          const boostConfianca = Math.min(melhorDeteccao.confiancaTotal * 100 * 0.8, 60); // Boost agressivo at√© 60%\n          boostAplicado = true;\n          return {\n            ...candidato,\n            confidence: Math.max(candidato.confidence + boostConfianca, 70),\n            // M√≠nimo 70% se detectado\n            explicacaoSimilaridade: `[Boost contextual: ${melhorDeteccao.tecnologia} detectado com ${(melhorDeteccao.confiancaTotal * 100).toFixed(0)}% confian√ßa] ${candidato.explicacaoSimilaridade || ''}`\n          };\n        }\n        return candidato;\n      });\n\n      // Se n√£o encontrou arqu√©tipo compat√≠vel, criar um virtual baseado na detec√ß√£o\n      if (!boostAplicado) {\n        const arquetipoVirtual: ResultadoDeteccaoArquetipo = {\n          nome: tecnologiaDetectada,\n          score: Math.round(melhorDeteccao.confiancaTotal * 100),\n          confidence: Math.round(melhorDeteccao.confiancaTotal * 100),\n          matchedRequired: [],\n          missingRequired: [],\n          matchedOptional: [],\n          dependencyMatches: (melhorDeteccao.evidencias || []).filter(e => e.tipo === 'dependencia').map(e => e.valor),\n          filePadraoMatches: (melhorDeteccao.evidencias || []).filter(e => e.tipo === 'estrutura').map(e => e.valor),\n          forbiddenPresent: [],\n          anomalias: [],\n          sugestaoPadronizacao: (melhorDeteccao.sugestoesMelhoria || []).join('; '),\n          explicacaoSimilaridade: `Detectado via sistema inteligente contextual com ${(melhorDeteccao.confiancaTotal * 100).toFixed(0)}% confian√ßa`,\n          descricao: `Projeto ${melhorDeteccao.tecnologia} identificado por an√°lise contextual`\n        };\n        candidatos.unshift(arquetipoVirtual); // Adiciona no in√≠cio\n      }\n    }\n  } catch (error) {\n    // Falha silenciosa - sistema inteligente √© opcional\n    if (process.env.NODE_ENV !== 'production') {\n      console.debug('Sistema inteligente n√£o dispon√≠vel:', error);\n    }\n  }\n\n  // Ordena por confian√ßa/score decrescente\n  candidatos.sort((a: ResultadoDeteccaoArquetipo, b: ResultadoDeteccaoArquetipo) => b.confidence - a.confidence || b.score - a.score);\n\n  // Decis√£o final: dominante, misto ou desconhecido\n  // Agora considera fatores contextuais e thresholds adaptativos\n  const scoresValidos = candidatos.filter(c => c.confidence >= 30);\n  if (!scoresValidos.length) {\n    // Nenhum padr√£o relevante - verificar se √© um projeto muito pequeno ou n√£o estruturado\n    const temAlgumaEstrutura = arquivos.some(f => f.includes('src/') || f.includes('lib/') || f.includes('app/') || f.includes('packages/'));\n    candidatos = [{\n      nome: 'desconhecido',\n      score: 0,\n      confidence: temAlgumaEstrutura ? 10 : 0,\n      // pequena confian√ßa se h√° alguma estrutura\n      matchedRequired: [],\n      missingRequired: [],\n      matchedOptional: [],\n      dependencyMatches: [],\n      filePadraoMatches: [],\n      forbiddenPresent: [],\n      anomalias: [],\n      sugestaoPadronizacao: temAlgumaEstrutura ? 'Projeto tem alguma estrutura, mas n√£o corresponde a arqu√©tipos conhecidos. Considere organizar em src/, lib/ ou app/.' : 'Projeto sem estrutura clara detectada. Considere criar uma organiza√ß√£o b√°sica.',\n      explicacaoSimilaridade: temAlgumaEstrutura ? 'Estrutura parcial detectada, mas n√£o suficiente para classifica√ß√£o.' : 'Nenhum arqu√©tipo identificado.',\n      descricao: 'Nenhum arqu√©tipo identificado.'\n    }];\n  } else {\n    // An√°lise mais sofisticada para decidir entre dominante e misto\n    const top = scoresValidos[0];\n    const proximos = scoresValidos.filter(c => c !== top && Math.abs(c.confidence - top.confidence) <= 15 // threshold aumentado\n    );\n\n    // Verificar se √© realmente um caso h√≠brido ou apenas competi√ß√£o pr√≥xima\n    const ehHibridoReal = proximos.some(c =>\n    // Verificar se h√° sobreposi√ß√£o significativa de caracter√≠sticas\n    c.matchedRequired.some(req => top.matchedRequired.includes(req)) || c.dependencyMatches.some(dep => top.dependencyMatches.includes(dep)));\n    if (proximos.length > 0 && ehHibridoReal) {\n      // Sistema de pontua√ß√£o para casos h√≠bridos\n      const scoreHibrido = top.score * 0.7 + proximos.reduce((acc: number, c: ResultadoDeteccaoArquetipo) => acc + c.score * 0.3 / proximos.length, 0);\n      const confidenceHibrido = Math.max(top.confidence - 10, 40); // reduzir confian√ßa mas manter m√≠nimo\n\n      candidatos = [{\n        nome: 'misto',\n        score: Math.round(scoreHibrido),\n        confidence: confidenceHibrido,\n        matchedRequired: [],\n        missingRequired: [],\n        matchedOptional: [],\n        dependencyMatches: [],\n        filePadraoMatches: [],\n        forbiddenPresent: [],\n        anomalias: [],\n        sugestaoPadronizacao: '',\n        explicacaoSimilaridade: `Estrutura h√≠brida detectada: combina elementos de ${[top.nome, ...proximos.map(p => p.nome)].join(', ')}. Recomenda-se avaliar se a separa√ß√£o em projetos distintos seria ben√©fica.`,\n        descricao: 'Estrutura h√≠brida'\n      }];\n    } else {\n      // Dominante claro\n      candidatos = [top];\n    }\n  }\n  const baselineCaminho = path.join(baseDir, '.prometheus', 'baseline-estrutura.json');\n  let baseline: SnapshotEstruturaBaseline | undefined;\n  const existente = await lerEstado<SnapshotEstruturaBaseline | []>(baselineCaminho);\n  if (existente && !Array.isArray(existente) && typeof existente === 'object' && 'arquetipo' in existente) {\n    baseline = existente as SnapshotEstruturaBaseline;\n  }\n  if (!baseline && candidatos[0]) {\n    baseline = {\n      version: 1,\n      timestamp: new Date().toISOString(),\n      arquetipo: candidatos[0].nome,\n      confidence: candidatos[0].confidence,\n      arquivosRaiz: arquivos.filter(p => !p.includes('/')).sort()\n    };\n    await salvarEstado(baselineCaminho, baseline);\n  }\n  // Prioriza baseline apenas se o candidato principal for 'desconhecido' ou confian√ßa baixa\n  if (baseline && baseline.arquetipo !== 'desconhecido') {\n    const arquivosRaizAtuais = arquivos.filter(p => !p.includes('/'));\n    const setBase = new Set(baseline.arquivosRaiz || []);\n    const temIntersecao = arquivosRaizAtuais.some(f => setBase.has(f));\n    const candidatoTop = candidatos[0];\n    if (temIntersecao && (candidatoTop.nome === 'desconhecido' || candidatoTop.confidence < 50)) {\n      const melhorLinhaBase: ResultadoDeteccaoArquetipo = {\n        nome: baseline.arquetipo,\n        score: 999,\n        // for√ßa topo da lista\n        confidence: baseline.confidence,\n        matchedRequired: [],\n        missingRequired: [],\n        matchedOptional: [],\n        dependencyMatches: [],\n        filePadraoMatches: [],\n        forbiddenPresent: [],\n        anomalias: [],\n        sugestaoPadronizacao: '',\n        explicacaoSimilaridade: 'Detectado via baseline existente (.prometheus/baseline-estrutura.json).',\n        descricao: 'Arqu√©tipo determinado pelo baseline'\n      };\n      candidatos = [melhorLinhaBase, ...candidatos.filter((c: ResultadoDeteccaoArquetipo) => c.nome !== baseline.arquetipo)];\n    }\n  }\n  let drift: ArquetipoDrift | undefined;\n  if (baseline && candidatos[0]) {\n    const atual = candidatos[0];\n    const arquivosRaizAtuais = arquivos.filter(p => !p.includes('/')).sort();\n    const setBase = new Set(baseline.arquivosRaiz);\n    const setAtual = new Set(arquivosRaizAtuais);\n    const novos: string[] = [];\n    const removidos: string[] = [];\n    for (const f of setAtual) if (!setBase.has(f)) novos.push(f as string);\n    for (const f of setBase) if (!setAtual.has(f)) removidos.push(f as string);\n    drift = {\n      alterouArquetipo: baseline.arquetipo !== atual.nome,\n      anterior: baseline.arquetipo,\n      atual: atual.nome,\n      deltaConfidence: atual.confidence - baseline.confidence,\n      arquivosRaizNovos: novos,\n      arquivosRaizRemovidos: removidos\n    };\n  }\n  // Sugest√£o de plano para o candidato top\n  if (candidatos[0]) {\n    try {\n      // Usa plano de arqu√©tipos se preset for diferente de 'prometheus' ou em ambiente de teste\n      const preset = (contexto as {\n        preset?: string;\n      }).preset ?? 'prometheus';\n      const emTeste = !!process.env.VITEST;\n      const preferEstrategista = preset === 'prometheus' && !emTeste;\n      const {\n        plano\n      } = await OperarioEstrutura.planejar(baseDir, contexto.arquivos, {\n        preferEstrategista,\n        preset\n      });\n      if (plano) candidatos[0].planoSugestao = plano;\n    } catch {\n      // mant√©m default vazio se falhar\n    }\n  }\n  return {\n    candidatos,\n    baseline,\n    drift,\n    arquetipoPersonalizado\n  };\n}"]}