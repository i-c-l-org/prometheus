{"version":3,"file":"relatorio-arquetipos.js","sourceRoot":"","sources":["../../src/relatorios/relatorio-arquetipos.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\nimport path from 'node:path';\n\nimport { ExcecoesMensagens } from '@core/messages/core/excecoes-messages.js';\nimport { RelatorioMensagens } from '@core/messages/index.js';\nimport { lerArquivoTexto, salvarEstado } from '@shared/persistence/persistencia.js';\n\nimport type { ResultadoDeteccaoArquetipo } from '@';\n\nexport async function exportarRelatorioArquetiposMarkdown(destino: string, candidatos: ResultadoDeteccaoArquetipo[], contexto?: {\n  origem?: string;\n}, detalhado = false): Promise<void> {\n  const linhas: string[] = [];\n  linhas.push(`# ${RelatorioMensagens.arquetipos.titulo}`);\n  if (contexto?.origem) linhas.push(`*Origem: ${contexto.origem}*`);\n  linhas.push('');\n  const cols = RelatorioMensagens.arquetipos.secoes.candidatos;\n  linhas.push(`| ${cols.nome} | ${cols.confianca} | ${cols.score} | Explicação | Sugestão |`);\n  linhas.push('|-----------|---------------|-------|------------|----------|');\n  for (const c of candidatos) {\n    if (!detalhado) {\n      // Relatório compacto\n      const missing = c.missingRequired?.slice(0, 3) || [];\n      const forbidden = c.forbiddenPresent?.slice(0, 3) || [];\n      const dependFalt = c.dependencyMatches?.length === 0 && c.dependencyMatches !== undefined ? c.dependencyMatches : [];\n      let resumo = '';\n      if (missing.length) resumo += `Faltam pastas: ${missing.join(', ')}. `;\n      if (forbidden.length) resumo += `Estruturas proibidas: ${forbidden.join(', ')}. `;\n      if (dependFalt.length) resumo += `Dependências ausentes: ${dependFalt.join(', ')}. `;\n      if (c.sugestaoPadronizacao) resumo += c.sugestaoPadronizacao.replace(/\\n/g, ' ');\n      if (!resumo) resumo = 'Estrutura próxima do ideal.';\n      // Compacta explicação\n      const explicacao = (c.explicacaoSimilaridade || '').split('\\n').slice(0, 2).join(' ');\n      linhas.push(`| ${c.nome} | ${c.confidence} | ${c.score} | ${explicacao} | ${resumo} |`);\n    } else {\n      // Relatório detalhado enriquecido\n      linhas.push(`\\n## ${c.nome}`);\n      linhas.push(`Confiança: ${c.confidence} | Score: ${c.score}`);\n      linhas.push(`Explicação: ${c.explicacaoSimilaridade?.replace(/\\n/g, ' ')}`);\n      linhas.push(`Sugestão: ${c.sugestaoPadronizacao?.replace(/\\n/g, ' ')}`);\n      // Gravidade dos problemas\n      if (c.missingRequired?.length) linhas.push(`Pastas faltantes (gravidade: crítico): ${c.missingRequired.map(p => `${p} [mkdir ${p}]`).join(', ')}`);\n      if (c.forbiddenPresent?.length) linhas.push(`Estruturas proibidas (gravidade: risco): ${c.forbiddenPresent.join(', ')}`);\n      if (c.dependencyMatches?.length) linhas.push(`Dependências detectadas: ${c.dependencyMatches.join(', ')}`);\n      if (c.filePadraoMatches?.length) linhas.push(`Padrões de arquivos: ${c.filePadraoMatches.join(', ')}`);\n      if (c.anomalias?.length) linhas.push(`Anomalias: ${c.anomalias.map(a => `${a.path} (${a.motivo})`).join(', ')}`);\n      // Sugestões automáticas de comandos/scripts\n      if (c.missingRequired?.length) {\n        linhas.push(`Sugestão de comandos:`);\n        c.missingRequired.forEach(p => linhas.push(`  mkdir ${p}`));\n      }\n      // Dependências ausentes (simples)\n      if (c.dependencyMatches && Array.isArray(c.dependencyMatches)) {\n        const ausentes = c.dependencyMatches.length === 0 && c.dependencyMatches !== undefined ? c.dependencyMatches : [];\n        if (ausentes.length) {\n          linhas.push(`Sugestão de comandos para dependências:`);\n          ausentes.forEach(dep => linhas.push(`  npm install ${dep}`));\n        }\n      }\n      // Links para documentação oficial\n      if (c.nome) {\n        const docLinks: Record<string, string> = {\n          'api-rest-express': 'https://expressjs.com/pt-br/',\n          fullstack: 'https://nextjs.org/docs',\n          monorepo: 'https://turborepo.org/docs',\n          cli: 'https://nodejs.org/api/cli.html',\n          lib: 'https://www.typescriptlang.org/docs/'\n        };\n        if (docLinks[c.nome]) linhas.push(`Documentação oficial: ${docLinks[c.nome]}`);\n      }\n      // Frameworks detectados\n      if (c.dependencyMatches?.length) {\n        const fwLinks: Record<string, string> = {\n          express: 'https://expressjs.com/pt-br/',\n          react: 'https://react.dev/',\n          next: 'https://nextjs.org/docs',\n          electron: 'https://www.electronjs.org/docs',\n          'discord.js': 'https://discord.js.org/#/docs',\n          telegraf: 'https://telegraf.js.org/'\n        };\n        c.dependencyMatches.forEach(dep => {\n          if (fwLinks[dep]) linhas.push(`Doc ${dep}: ${fwLinks[dep]}`);\n        });\n      }\n      // Pr�ticas inseguras e smells (exemplo)\n      if (c.explicacaoSimilaridade && /função longa|require dinâmico|import misto|eval/.test(c.explicacaoSimilaridade)) {\n        linhas.push(`Práticas inseguras detectadas: ${c.explicacaoSimilaridade}`);\n      }\n      // Dependências desatualizadas/vulneráveis (simples)\n      try {\n        const pkgCaminho = path.resolve(process.cwd(), 'package.json');\n        try {\n          const raw = await lerArquivoTexto(pkgCaminho);\n          const pkg = raw ? JSON.parse(raw) : null;\n          if (!pkg) throw new Error(ExcecoesMensagens.semPkg);\n          if (pkg.dependencies) {\n            for (const dep in pkg.dependencies) {\n              // Simulação: destaca dependências com versão \"0.\" ou \"^0.\" como desatualizadas/vulneráveis\n              if (/^0\\./.test(pkg.dependencies[dep]) || /^\\^0\\./.test(pkg.dependencies[dep])) {\n                linhas.push(`Dependência potencialmente desatualizada/vulnerável: ${dep} (${pkg.dependencies[dep]}) [grave]`);\n                linhas.push(`Sugestão: npm update ${dep}`);\n              }\n            }\n          }\n        } catch { }\n      } catch { }\n      // Status do npm audit\n      try {\n        const { exec } = await import('node:child_process');\n        const { promisify } = await import('node:util');\n        const execp = promisify(exec);\n        let auditRaw = '';\n        try {\n          const { stdout } = await execp('npm audit --json', {\n            encoding: 'utf-8',\n          });\n          auditRaw = stdout;\n        } catch {\n          auditRaw = '';\n        }\n        const audit = auditRaw ? JSON.parse(auditRaw) : {};\n        if (audit.metadata?.vulnerabilities?.total > 0) {\n          linhas.push(`Vulnerabilidades detectadas pelo npm audit:`);\n          for (const [sev, qtd] of Object.entries(audit.metadata.vulnerabilities)) {\n            if (typeof qtd === 'number' && qtd > 0 && sev !== 'total') {\n              linhas.push(`  ${sev}: ${qtd}`);\n            }\n          }\n          linhas.push('Sugestão: npm audit fix');\n        } else {\n          linhas.push('Nenhuma vulnerabilidade encontrada pelo npm audit.');\n        }\n      } catch { }\n      linhas.push('---');\n    }\n  }\n  linhas.push('');\n  linhas.push('---');\n  linhas.push('**Como o diagnóstico foi feito:**');\n  linhas.push(`A pontuação de cada arquétipo considera presença de pastas obrigatórias, opcionais, padrões de arquivos, dependências e penalidades por estruturas proibidas. O campo \"Explicação\" detalha os fatores que levaram à sugestão.`);\n  await salvarEstado(destino, linhas.join('\\n'));\n}\nexport async function exportarRelatorioArquetiposJson(destino: string, candidatos: ResultadoDeteccaoArquetipo[], contexto?: {\n  origem?: string;\n}, detalhado = false): Promise<void> {\n  const {\n    criarRelatorioComVersao\n  } = await import('@core/schema/version.js');\n  const relatorio = {\n    origem: contexto?.origem ?? null,\n    candidatos: candidatos.map(c => {\n      if (!detalhado) {\n        // Compacto\n        const missing = c.missingRequired?.slice(0, 3) || [];\n        const forbidden = c.forbiddenPresent?.slice(0, 3) || [];\n        const dependFalt = c.dependencyMatches?.length === 0 && c.dependencyMatches !== undefined ? c.dependencyMatches : [];\n        let resumo = '';\n        if (missing.length) resumo += `Faltam pastas: ${missing.join(', ')}. `;\n        if (forbidden.length) resumo += `Estruturas proibidas: ${forbidden.join(', ')}. `;\n        if (dependFalt.length) resumo += `Dependências ausentes: ${dependFalt.join(', ')}. `;\n        if (c.sugestaoPadronizacao) resumo += c.sugestaoPadronizacao.replace(/\\n/g, ' ');\n        if (!resumo) resumo = 'Estrutura próxima do ideal.';\n        // Compacta explicação\n        const explicacao = (c.explicacaoSimilaridade || '').split('\\n').slice(0, 2).join(' ');\n        return {\n          nome: c.nome,\n          confidence: c.confidence,\n          score: c.score,\n          explicacao,\n          resumo,\n          matchedRequired: c.matchedRequired?.slice(0, 3) || [],\n          missingRequired: missing,\n          forbiddenPresent: forbidden,\n          descricao: c.descricao\n        };\n      } else {\n        // Detalhado\n        return {\n          nome: c.nome,\n          confidence: c.confidence,\n          score: c.score,\n          explicacao: c.explicacaoSimilaridade,\n          sugestao: c.sugestaoPadronizacao,\n          matchedRequired: c.matchedRequired,\n          missingRequired: c.missingRequired,\n          matchedOptional: c.matchedOptional,\n          dependencyMatches: c.dependencyMatches,\n          filePadraoMatches: c.filePadraoMatches,\n          forbiddenPresent: c.forbiddenPresent,\n          anomalias: c.anomalias,\n          descricao: c.descricao\n        };\n      }\n    })\n  };\n\n  // Criar relatório com versão\n  const relatorioVersionado = criarRelatorioComVersao(relatorio, undefined,\n    // usar versão atual\n    'Relatório de detecção de arquétipos estruturais');\n  await salvarEstado(destino, relatorioVersionado);\n}"]}