{"version":3,"file":"relatorio-poda.js","sourceRoot":"","sources":["../../src/relatorios/relatorio-poda.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport { RelatorioMensagens } from '@core/messages/index.js';\nimport { salvarEstado } from '@shared/persistence/persistencia.js';\n\nimport type { OpcoesRelatorioPoda, Pendencia, PendenciaProcessavel } from '@';\n\nexport async function gerarRelatorioPodaMarkdown(caminho: string, podados: Pendencia[], mantidos: Pendencia[], opcoes?: OpcoesRelatorioPoda): Promise<void> {\n  const dataISO = new Date().toISOString();\n  const totalPodados = podados.length;\n  const totalMantidos = mantidos.length;\n  const simulado = opcoes?.simulado;\n  let md = `# ${RelatorioMensagens.poda.titulo}\\n\\n`;\n  md += `**${RelatorioMensagens.poda.secoes.metadados.data}:** ${dataISO}  \\n`;\n  md += `**${RelatorioMensagens.poda.secoes.metadados.execucao}:** ${simulado ? RelatorioMensagens.poda.secoes.metadados.simulacao : RelatorioMensagens.poda.secoes.metadados.real}  \\n`;\n  md += `**${RelatorioMensagens.poda.secoes.metadados.arquivosPodados}:** ${totalPodados}  \\n`;\n  md += `**${RelatorioMensagens.poda.secoes.metadados.arquivosMantidos}:** ${totalMantidos}  \\n`;\n  md += `\\n---\\n`;\n  md += `## ${RelatorioMensagens.poda.secoes.podados.titulo}\\n`;\n  if (totalPodados === 0) {\n    md += `${RelatorioMensagens.poda.secoes.podados.vazio}\\n`;\n  } else {\n    const cols = RelatorioMensagens.poda.secoes.podados.colunas;\n    md += `| ${cols.arquivo} | ${cols.motivo} | ${cols.diasInativo} | ${cols.detectadoEm} |\\n`;\n    md += '|---------|--------|--------------|--------------|\\n';\n    for (const p of podados) {\n      const pendenciaObj = p as PendenciaProcessavel;\n      const diasInativo = typeof pendenciaObj.diasInativo === 'number' ? String(pendenciaObj.diasInativo) : '-';\n      md += `| ${p.arquivo} | ${p.motivo} | ${diasInativo} | ${p.detectedAt ? new Date(p.detectedAt).toISOString().slice(0, 10) : '-'} |\\n`;\n    }\n  }\n  md += '\\n---\\n';\n  md += `## ${RelatorioMensagens.poda.secoes.mantidos.titulo}\\n`;\n  if (totalMantidos === 0) {\n    md += `${RelatorioMensagens.poda.secoes.mantidos.vazio}\\n`;\n  } else {\n    const cols = RelatorioMensagens.poda.secoes.mantidos.colunas;\n    md += `| ${cols.arquivo} | ${cols.motivo} |\\n`;\n    md += '|---------|--------|\\n';\n    for (const p of mantidos) {\n      md += `| ${p.arquivo} | ${p.motivo} |\\n`;\n    }\n  }\n  await salvarEstado(caminho, md);\n}\nexport async function gerarRelatorioPodaJson(caminho: string, podados: Pendencia[], mantidos: Pendencia[]): Promise<void> {\n  const json = {\n    podados: podados.map(p => {\n      const pendenciaObj = p as PendenciaProcessavel;\n      return {\n        arquivo: p.arquivo,\n        motivo: p.motivo,\n        diasInativo: typeof pendenciaObj.diasInativo === 'number' ? pendenciaObj.diasInativo : undefined\n      };\n    }),\n    mantidos: mantidos.map(p => ({\n      arquivo: p.arquivo,\n      motivo: p.motivo\n    })),\n    totalPodados: podados.length,\n    totalMantidos: mantidos.length,\n    timestamp: Date.now()\n  };\n  await salvarEstado(caminho, json);\n}"]}