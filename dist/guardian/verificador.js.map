{"version":3,"file":"verificador.js","sourceRoot":"","sources":["../../src/guardian/verificador.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,uBAAuB,EAAE,MAAM,WAAW,CAAC;AAUpD,MAAM,UAAU,kBAAkB,CAChC,WAAwB,EACxB,eAAsC;IAEtC,MAAM,YAAY,GAAG,IAAI,GAAG,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAC9E,MAAM,WAAW,GAAa,EAAE,CAAC;IAEjC,KAAK,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,WAAW,EAAE,CAAC;QAC/C,IAAI,CAAC,OAAO,IAAI,OAAO,OAAO,KAAK,QAAQ,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;YAAE,SAAS;QACzE,MAAM,SAAS,GAAG,uBAAuB,CAAC,OAAO,CAAC,CAAC;QACnD,MAAM,YAAY,GAAG,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC/C,IAAI,YAAY,IAAI,SAAS,KAAK,YAAY,EAAE,CAAC;YAC/C,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC5B,CAAC;IACH,CAAC;IAED,OAAO;QACL,WAAW;QACX,WAAW,EAAE,eAAe,CAAC,MAAM;KACpC,CAAC;AACJ,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT\nimport type { FileEntry, RegistroIntegridade, ResultadoVerificacao } from '@';\n\nimport { gerarSnapshotDoConteudo } from './hash.js';\n\n/**\n * Compara os arquivos atuais com os registros de integridade salvos e detecta divergências.\n *\n * @param fileEntries Arquivos atuais lidos do sistema\n * @param registrosSalvos Registros prévios salvos (hashes de referência)\n * @returns Resultado contendo lista de arquivos corrompidos e total verificado\n */\n\nexport function verificarRegistros(\n  fileEntries: FileEntry[],\n  registrosSalvos: RegistroIntegridade[],\n): ResultadoVerificacao {\n  const registrosMap = new Map(registrosSalvos.map((r) => [r.arquivo, r.hash]));\n  const corrompidos: string[] = [];\n\n  for (const { relPath, content } of fileEntries) {\n    if (!relPath || typeof content !== 'string' || !content.trim()) continue;\n    const hashAtual = gerarSnapshotDoConteudo(content); // retorna string\n    const hashEsperado = registrosMap.get(relPath);\n    if (hashEsperado && hashAtual !== hashEsperado) {\n      corrompidos.push(relPath);\n    }\n  }\n\n  return {\n    corrompidos,\n    verificados: registrosSalvos.length,\n  };\n}\n"]}