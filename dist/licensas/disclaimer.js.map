{"version":3,"file":"disclaimer.js","sourceRoot":"","sources":["../../src/licensas/disclaimer.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport { execFile as _execFile } from 'node:child_process';\nimport { promises as fs } from 'node:fs';\nimport path from 'node:path';\n\nexport interface DisclaimerOptions {\n  root?: string;\n  disclaimerPath?: string;\n  dryRun?: boolean;\n}\nfunction execFileAsync(cmd: string, args: string[], opts: Record<string, unknown> = {}): Promise<{\n  stdout: string;\n  stderr: string;\n}> {\n  return new Promise((resolve, reject) => {\n    _execFile(cmd, args, {\n      shell: false,\n      ...opts\n    }, (err: Error | null, stdout: string | Buffer, stderr: string | Buffer) => {\n      if (err) return reject(Object.assign(err, {\n        stdout,\n        stderr\n      }));\n      resolve({\n        stdout: String(stdout || ''),\n        stderr: String(stderr || '')\n      });\n    });\n  });\n}\nconst defaultDisclaimerCaminho = 'docs/partials/AVISO-PROVENIENCIA.md';\nconst marker = /Proveni[eÃª]ncia e Autoria/i;\nasync function listMarkdown(root: string): Promise<string[]> {\n  try {\n    const {\n      stdout\n    } = await execFileAsync('git', ['ls-files', '*.md'], {\n      cwd: root\n    });\n    return stdout.split(/\\r?\\n/).map(s => s.trim()).filter(Boolean);\n  } catch {\n    const out: string[] = [];\n    async function walk(dir: string): Promise<string[]> {\n      const entries = await fs.readdir(dir, {\n        withFileTypes: true\n      });\n      for (const e of entries) {\n        const p = path.join(dir, e.name);\n        if (e.isDirectory()) {\n          if (/^(node_modules|dist|\\.git|pre-public|preview-prometheus|coverage|relatorios|\\.prometheus)$/i.test(e.name)) continue;\n          out.push(...(await walk(p)));\n        } else if (/\\.md$/i.test(e.name)) {\n          out.push(path.relative(root, p));\n        }\n      }\n      return out;\n    }\n    return walk(root);\n  }\n}\nexport async function addDisclaimer({\n  root = process.cwd(),\n  disclaimerPath = defaultDisclaimerCaminho,\n  dryRun = false\n}: DisclaimerOptions = {}): Promise<{\n  updatedArquivos: string[];\n}> {\n  const absDisclaimer = path.join(root, disclaimerPath);\n  await fs.access(absDisclaimer).catch(() => {\n    throw new Error(`Disclaimer not found: ${disclaimerPath}`);\n  });\n  const disclaimerText = await fs.readFile(absDisclaimer, 'utf8');\n  const files = (await listMarkdown(root)).filter(f => f !== disclaimerPath && !f.startsWith('pre-public/')).filter(f => !f.startsWith('.abandonados/') && !f.startsWith('.deprecados/') && !f.startsWith('coverage/') && !f.startsWith('relatorios/'));\n  const updatedArquivos: string[] = [];\n  for (const rel of files) {\n    const abs = path.join(root, rel);\n    try {\n      await fs.access(abs);\n    } catch {\n      continue;\n    }\n    const content = await fs.readFile(abs, 'utf8');\n    const head = content.split('\\n').slice(0, 30).join('\\n');\n    if (marker.test(head)) continue;\n    const updated = `${disclaimerText}\\n\\n${content.trimStart()}\\n`;\n    if (!dryRun) await fs.writeFile(abs, updated, 'utf8');\n    updatedArquivos.push(rel);\n  }\n  return {\n    updatedArquivos\n  };\n}\nexport async function verifyDisclaimer({\n  root = process.cwd(),\n  disclaimerPath = defaultDisclaimerCaminho\n}: Pick<DisclaimerOptions, 'root' | 'disclaimerPath'> = {}): Promise<{\n  missing: string[];\n}> {\n  const files = (await listMarkdown(root)).filter(f => f !== disclaimerPath && !f.startsWith('pre-public/') && !f.startsWith('preview-prometheus/')).filter(f => !f.startsWith('.abandonados/') && !f.startsWith('.deprecados/') && !f.startsWith('coverage/') && !f.startsWith('relatorios/'));\n  const missing: string[] = [];\n  for (const rel of files) {\n    const abs = path.join(root, rel);\n    try {\n      await fs.access(abs);\n    } catch {\n      continue;\n    }\n    const content = await fs.readFile(abs, 'utf8');\n    const head = content.split('\\n').slice(0, 30).join('\\n');\n    if (!marker.test(head)) missing.push(rel);\n  }\n  return {\n    missing\n  };\n}\nconst disclaimerModule = {\n  addDisclaimer,\n  verifyDisclaimer\n};\nexport default disclaimerModule;"]}