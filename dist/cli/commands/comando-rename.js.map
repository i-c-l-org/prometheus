{"version":3,"file":"comando-rename.js","sourceRoot":"","sources":["../../../src/cli/commands/comando-rename.ts"],"names":[],"mappings":"AAIA,OAAO,cAAc,MAAM,kBAAkB,CAAC;AAC9C,OAAO,EAAE,KAAK,EAAE,MAAM,eAAe,CAAC;AACtC,OAAO,cAAc,MAAM,iBAAiB,CAAC;AAC7C,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,4BAA4B,CAAC;AAC5D,OAAO,EAAE,qBAAqB,EAAE,cAAc,EAAE,MAAM,+BAA+B,CAAC;AACtF,OAAO,KAAK,MAAM,4BAA4B,CAAC;AAC/C,OAAO,EAAE,MAAM,EAAE,MAAM,wBAAwB,CAAC;AAChD,OAAO,EAAE,yBAAyB,EAAE,MAAM,mDAAmD,CAAC;AAC9F,OAAO,EAAE,GAAG,EAAE,MAAM,yBAAyB,CAAC;AAC9C,OAAO,EAAE,OAAO,EAAE,MAAM,WAAW,CAAC;AACpC,OAAO,KAAK,EAAE,MAAM,IAAI,CAAC;AACzB,OAAO,KAAK,IAAI,MAAM,MAAM,CAAC;AAI7B,MAAM,QAAQ,GAAG,cAAc,CAAC,OAAO,IAAI,cAAc,CAAC;AAG1D,MAAM,QAAQ,GAAG,cAAc,CAAC,OAAO,IAAI,cAAc,CAAC;AAE1D,SAAS,gBAAgB,CAAC,IAAY;IACpC,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC9B,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC;QAAE,OAAO,IAAI,CAAC;IAClC,MAAM,OAAO,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;IAChC,MAAM,OAAO,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;IAChC,IAAI,CAAC,OAAO,IAAI,CAAC,OAAO,IAAI,OAAO,KAAK,OAAO;QAAE,OAAO,IAAI,CAAC;IAC7D,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC;AACvC,CAAC;AAED,SAAS,oBAAoB,CAC3B,QAAgB,EAChB,QAA6B,EAC7B,OAAe;IAEf,MAAM,OAAO,GAAG,EAAE,CAAC,YAAY,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;IACnD,MAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IAClC,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;QACzB,MAAM,MAAM,GAAG,gBAAgB,CAAC,IAAI,CAAC,CAAC;QACtC,IAAI,MAAM,EAAE,CAAC;YACX,MAAM,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;YAC9C,IAAI,QAAQ,KAAK,SAAS,IAAI,QAAQ,KAAK,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;gBAC5E,GAAG,CAAC,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,QAAQ,CAAC,EAAE,MAAM,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC,CAAC;YAClI,CAAC;YACD,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,OAAO,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC;QAC/C,CAAC;IACH,CAAC;AACH,CAAC;AAED,MAAM,UAAU,aAAa,CAC3B,mBAA4D;IAE5D,OAAO,IAAI,OAAO,CAAC,QAAQ,CAAC;SACzB,WAAW,CAAC,yBAAyB,CAAC,SAAS,CAAC;SAChD,MAAM,CAAC,KAAK;QACX,IAAI,CAAC;YACH,MAAM,mBAAmB,CACvB,IAAI,CAAC,MAAM,IAAI,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,KAAK,UAAU;gBACnD,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;gBACpB,CAAC,CAAC,EAAE,CACP,CAAC;QACJ,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,GAAG,CAAC,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,UAAU,CAAC,GAAG,YAAY,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YACvG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;YACvB,OAAO;QACT,CAAC;QAED,MAAM,QAAQ,GAAG,OAAO,CAAC,GAAG,EAAE,CAAC;QAC/B,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QAC9C,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;QAClD,MAAM,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;QAE5D,MAAM,QAAQ,GAAG,IAAI,GAAG,EAAkB,CAAC;QAE3C,IAAI,EAAE,CAAC,UAAU,CAAC,eAAe,CAAC,EAAE,CAAC;YACnC,oBAAoB,CAAC,eAAe,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;QAC5D,CAAC;aAAM,IAAI,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE,CAAC;YACpC,MAAM,QAAQ,GAAG,qBAAqB,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;YAC1D,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;gBAC1B,GAAG,CAAC,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;gBAC3D,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;gBACvB,OAAO;YACT,CAAC;YACD,KAAK,MAAM,CAAC,IAAI,QAAQ,EAAE,CAAC;gBACzB,oBAAoB,CAAC,CAAC,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC9C,CAAC;QACH,CAAC;aAAM,CAAC;YACN,GAAG,CAAC,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,kBAAkB,CAAC,CAAC;YAC7D,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;YACvB,OAAO;QACT,CAAC;QAED,IAAI,QAAQ,CAAC,IAAI,KAAK,CAAC,EAAE,CAAC;YACxB,GAAG,CAAC,KAAK,CAAC,yBAAyB,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC;YAC3D,OAAO;QACT,CAAC;QAED,MAAM,KAAK,GAAG,cAAc,CAAC,OAAO,CAAC,CAAC;QACtC,IAAI,oBAAoB,GAAG,CAAC,CAAC;QAC7B,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAG7E,MAAM,YAAY,GAAwB,IAAI,GAAG,EAAE,CAAC;QACpD,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;YACzB,IAAI,CAAC;gBACH,YAAY,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,CAAC,YAAY,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC;YACzD,CAAC;YAAC,MAAM,CAAC;YAET,CAAC;QACH,CAAC;QAGD,KAAK,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,YAAY,EAAE,CAAC;YACxC,IAAI,CAAC;gBACH,MAAM,GAAG,GAAG,KAAK,CAAC,IAAI,EAAE;oBACtB,UAAU,EAAE,QAAQ;oBACpB,OAAO,EAAE,CAAC,YAAY,EAAE,mBAAmB,CAAC;iBAC7C,CAAC,CAAC;gBACH,IAAI,OAAO,GAAG,KAAK,CAAC;gBACpB,QAAQ,CAAC,GAAG,EAAE;oBACZ,UAAU,CAAC,IAAI;wBACb,MAAM,OAAO,GAAG,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;wBAC7C,IAAI,OAAO,IAAI,OAAO,KAAK,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;4BAC1C,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,OAAO,CAAC;4BACzB,OAAO,GAAG,IAAI,CAAC;wBACjB,CAAC;oBACH,CAAC;iBACF,CAAC,CAAC;gBACH,IAAI,OAAO,EAAE,CAAC;oBACZ,MAAM,MAAM,GAAG,QAAQ,CACrB,GAAG,EACH;wBACE,WAAW,EAAE,KAAK;wBAClB,QAAQ,EAAE,IAAI;wBACd,OAAO,EAAE,KAAK;qBACf,EACD,IAAI,CACL,CAAC;oBACF,EAAE,CAAC,aAAa,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;oBACpC,IAAI,MAAM,CAAC,OAAO;wBAChB,GAAG,CAAC,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;oBACvF,oBAAoB,EAAE,CAAC;gBACzB,CAAC;YACH,CAAC;YAAC,MAAM,CAAC;YAET,CAAC;QACH,CAAC;QACD,GAAG,CAAC,OAAO,CAAC,yBAAyB,CAAC,MAAM,CAAC,SAAS,CAAC,oBAAoB,CAAC,CAAC,CAAC;IAChF,CAAC,CAAC,CAAC;AACP,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT-0\n// @prometheus-disable PROBLEMA_PERFORMANCE\n// Justificativa: CLI command que pré-carrega conteúdos antes do processamento\n\nimport generateModule from '@babel/generator';\nimport { parse } from '@babel/parser';\nimport traverseModule from '@babel/traverse';\nimport { ExitCode, sair } from '@cli/helpers/exit-codes.js';\nimport { getFilesWithExtension, getSourceFiles } from '@cli/helpers/get-files-src.js';\nimport chalk from '@core/config/chalk-safe.js';\nimport { config } from '@core/config/config.js';\nimport { CliComandoRenameMensagens } from '@core/messages/cli/cli-comando-rename-messages.js';\nimport { log } from '@core/messages/index.js';\nimport { Command } from 'commander';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment -- CJS default interop\n// @ts-ignore\nconst traverse = traverseModule.default || traverseModule;\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment -- CJS default interop\n// @ts-ignore\nconst generate = generateModule.default || generateModule;\n\nfunction parseMappingLine(line: string): { oldName: string; newName: string } | null {\n  const parts = line.split('=');\n  if (parts.length < 2) return null;\n  const oldName = parts[0].trim();\n  const newNome = parts[1].trim();\n  if (!oldName || !newNome || oldName === newNome) return null;\n  return { oldName, newName: newNome };\n}\n\nfunction loadMappingsFromFile(\n  filePath: string,\n  mappings: Map<string, string>,\n  raizDir: string,\n): void {\n  const content = fs.readFileSync(filePath, 'utf-8');\n  const lines = content.split('\\n');\n  for (const line of lines) {\n    const parsed = parseMappingLine(line);\n    if (parsed) {\n      const existing = mappings.get(parsed.oldName);\n      if (existing !== undefined && existing !== parsed.newName && config.VERBOSE) {\n        log.info(CliComandoRenameMensagens.status.conflito(parsed.oldName, path.relative(raizDir, filePath), parsed.newName, existing));\n      }\n      mappings.set(parsed.oldName, parsed.newName);\n    }\n  }\n}\n\nexport function comandoRename(\n  aplicarFlagsGlobais: (opts: Record<string, unknown>) => void,\n): Command {\n  return new Command('rename')\n    .description(CliComandoRenameMensagens.descricao)\n    .action(async function (this: Command) {\n      try {\n        await aplicarFlagsGlobais(\n          this.parent && typeof this.parent.opts === 'function'\n            ? this.parent.opts()\n            : {},\n        );\n      } catch (err) {\n        log.erro(CliComandoRenameMensagens.erros.falhaFlags(err instanceof Error ? err.message : String(err)));\n        sair(ExitCode.Failure);\n        return;\n      }\n\n      const RAIZ_DIR = process.cwd();\n      const SRC_DIR = path.resolve(RAIZ_DIR, 'src');\n      const NAMES_DIR = path.resolve(RAIZ_DIR, 'names');\n      const MAPPING_ARQUIVO = path.resolve(NAMES_DIR, 'name.txt');\n\n      const mappings = new Map<string, string>();\n\n      if (fs.existsSync(MAPPING_ARQUIVO)) {\n        loadMappingsFromFile(MAPPING_ARQUIVO, mappings, RAIZ_DIR);\n      } else if (fs.existsSync(NAMES_DIR)) {\n        const txtFiles = getFilesWithExtension(NAMES_DIR, '.txt');\n        if (txtFiles.length === 0) {\n          log.erro(CliComandoRenameMensagens.erros.nenhumMapeamento);\n          sair(ExitCode.Failure);\n          return;\n        }\n        for (const f of txtFiles) {\n          loadMappingsFromFile(f, mappings, RAIZ_DIR);\n        }\n      } else {\n        log.erro(CliComandoRenameMensagens.erros.pastaNaoEncontrada);\n        sair(ExitCode.Failure);\n        return;\n      }\n\n      if (mappings.size === 0) {\n        log.aviso(CliComandoRenameMensagens.erros.mapeamentoVazio);\n        return;\n      }\n\n      const files = getSourceFiles(SRC_DIR);\n      let totalArquivosUpdated = 0;\n      log.info(chalk.cyan(CliComandoRenameMensagens.status.inicio(mappings.size)));\n\n      // Pre-load all file contents to avoid blocking operations in loop\n      const fileContents: Map<string, string> = new Map();\n      for (const file of files) {\n        try {\n          fileContents.set(file, fs.readFileSync(file, 'utf-8'));\n        } catch {\n          // Skip files that can't be read\n        }\n      }\n\n      // Now process the pre-loaded contents\n      for (const [file, code] of fileContents) {\n        try {\n          const ast = parse(code, {\n            sourceType: 'module',\n            plugins: ['typescript', 'decorators-legacy'],\n          });\n          let changed = false;\n          traverse(ast, {\n            Identifier(path) {\n              const newNome = mappings.get(path.node.name);\n              if (newNome && newNome !== path.node.name) {\n                path.node.name = newNome;\n                changed = true;\n              }\n            },\n          });\n          if (changed) {\n            const output = generate(\n              ast,\n              {\n                retainLines: false,\n                comments: true,\n                compact: false,\n              },\n              code,\n            );\n            fs.writeFileSync(file, output.code);\n            if (config.VERBOSE)\n              log.info(CliComandoRenameMensagens.status.atualizado(path.relative(RAIZ_DIR, file)));\n            totalArquivosUpdated++;\n          }\n        } catch {\n          // ignora erros de parse por arquivo\n        }\n      }\n      log.sucesso(CliComandoRenameMensagens.status.concluido(totalArquivosUpdated));\n    });\n}\n"]}