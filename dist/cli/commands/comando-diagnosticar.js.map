{"version":3,"file":"comando-diagnosticar.js","sourceRoot":"","sources":["../../../src/cli/commands/comando-diagnosticar.ts"],"names":[],"mappings":"AAGA,OAAO,EAAE,mBAAmB,EAAE,MAAM,8BAA8B,CAAC;AACnE,OAAO,EAAE,oBAAoB,EAAE,MAAM,mCAAmC,CAAC;AACzE,OAAO,EAAE,+BAA+B,EAAE,MAAM,yDAAyD,CAAC;AAC1G,OAAO,EAAE,UAAU,EAAE,GAAG,EAAE,MAAM,yBAAyB,CAAC;AAC1D,OAAO,EAAE,cAAc,EAAE,MAAM,8BAA8B,CAAC;AAC9D,OAAO,EAAE,OAAO,EAAE,MAAM,WAAW,CAAC;AACpC,OAAO,GAAG,MAAM,KAAK,CAAC;AAItB,MAAM,UAAU,mBAAmB,CAAC,mBAA4D;IAC9F,MAAM,GAAG,GAAG,IAAI,OAAO,CAAC,cAAc,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,+BAA+B,CAAC,SAAS,CAAC,CAAC;IAI7G,GAAG,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;IAI7B,GAAG,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC;IAG/B,KAAK,MAAM,GAAG,IAAI,mBAAmB,EAAE,CAAC;QACtC,IAAI,QAAQ,IAAI,GAAG,IAAI,GAAG,CAAC,MAAM,EAAE,CAAC;YAClC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,YAAY,CAAC,CAAC;QAChE,CAAC;aAAM,IAAI,cAAc,IAAI,GAAG,EAAE,CAAC;YACjC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,YAAY,CAAC,CAAC;QACpD,CAAC;aAAM,CAAC;YACN,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC;QAClC,CAAC;IACH,CAAC;IACD,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,IAgBjB,EAAE,OAAgB,EAAE,EAAE;QAGrB,IAAI,CAAC;YACH,MAAM,SAAS,GAAG,OAAO,CAAC,MAEb,CAAC;YACd,MAAM,WAAW,GAAG,SAAS,IAAI,OAAO,SAAS,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;YAC9F,MAAM,UAAU,GAAG,OAAO,OAAO,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;YAC5E,MAAM,MAAM,GAAG;gBACb,GAAG,CAAC,WAAW,IAAI,EAAE,CAAC;gBACtB,GAAG,CAAC,UAAU,IAAI,EAAE,CAAC;gBACrB,GAAG,CAAC,IAAI,IAAI,EAAE,CAAC;aAChB,CAAC;YACF,MAAM,mBAAmB,CAAC,MAAM,CAAC,CAAC;QACpC,CAAC;QAAC,MAAM,CAAC;YAEP,IAAI,CAAC;gBACH,MAAM,mBAAmB,CAAC,IAA0C,CAAC,CAAC;YACxE,CAAC;YAAC,MAAM,CAAC;YAET,CAAC;QACH,CAAC;QAGD,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB,KAAK,GAAG,EAAE,CAAC;YAC7C,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;gBAEd,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC;oBACzB,IAAI,EAAE;wBACJ,IAAI,EAAE,IAAI;wBACV,IAAI,EAAE,+BAA+B,CAAC,YAAY;qBACnD;oBACD,aAAa,EAAE,CAAC;oBAChB,WAAW,EAAE,EAAE;iBAChB,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;gBACb,OAAO;YACT,CAAC;YACD,OAAO;QACT,CAAC;QAED,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;YACd,cAAc,EAAE,CAAC;QACnB,CAAC;QAID,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAkB,IAAI,MAAM,CAAC;QACnD,MAAM,SAAS,GAAG,IAAI,CAAC,IAAI,IAAI,QAAQ,KAAK,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC;QACtE,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,SAAS,EAAE,CAAC;YAC5B,IAAI,CAAC;gBACH,MAAM,EACJ,OAAO,EAAE,KAAK,EACf,GAAG,MAAM,MAAM,CAAC,4BAA4B,CAAC,CAAC;gBAC/C,MAAM,EACJ,MAAM,EACP,GAAG,MAAM,MAAM,CAAC,wBAAwB,CAAC,CAAC;gBAC3C,MAAM,WAAW,GAAa,EAAE,CAAC;gBACjC,MAAM,OAAO,GAAa,EAAE,CAAC;gBAC7B,MAAM,MAAM,GAAG,OAAO,CAAC,MAA+C,CAAC;gBACvE,MAAM,UAAU,GAA4B,MAAM,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;gBAG7G,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;oBACd,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAC3B,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,uBAAuB,CAAC,CAAC;gBACxE,CAAC;gBACD,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;oBACvB,WAAW,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;oBACrC,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,eAAe,CAAC,CAAC;gBAChE,CAAC;gBACD,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;oBACnB,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;oBAChC,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,gBAAgB,CAAC,CAAC;gBACjE,CAAC;gBACD,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;oBACd,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAC3B,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,WAAW,CAAC,CAAC;gBAC5D,CAAC;gBACD,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;oBACd,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAC3B,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,WAAW,CAAC,CAAC;gBAC5D,CAAC;gBAED,MAAM,YAAY,GAAG,OAAO,CAAE,IAA2C,CAAC,SAAS,CAAC,CAAC,CAAC;gBACtF,MAAM,gBAAgB,GAAG,YAAY,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC;gBACrE,IAAI,gBAAgB,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;oBACnC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;oBAC9B,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,cAAc,CAAC,CAAC;gBAC/D,CAAC;gBACD,IAAI,IAAI,CAAC,eAAe,EAAE,CAAC;oBACzB,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;gBACzC,CAAC;gBACD,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;oBACjB,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;oBAC/B,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,cAAc,CAAC,CAAC;gBAC/D,CAAC;gBACD,IAAI,IAAI,CAAC,mBAAmB,EAAE,CAAC;oBAC7B,WAAW,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;oBAC5C,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,0BAA0B,CAAC,CAAC;gBAC3E,CAAC;gBAED,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAmB,IAAI,EAAE,CAAC;gBAChD,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAmB,IAAI,EAAE,CAAC;gBAChD,IAAI,QAAQ,CAAC,MAAM;oBAAE,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,sBAAsB,CAAC,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBAChI,IAAI,QAAQ,CAAC,MAAM;oBAAE,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,sBAAsB,CAAC,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBAGhI,MAAM,YAAY,GAAG,OAAO,CAAC,UAAU,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,IAAI,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gBACxI,MAAM,gBAAgB,GAAG,OAAO,CAAC,UAAU,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,EAAE,YAAY,CAAC,IAAI,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;gBACpJ,MAAM,WAAW,GAAG,OAAO,CAAE,IAA2C,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACpF,MAAM,eAAe,GAAG,OAAO,CAAE,IAA2C,CAAC,YAAY,CAAC,CAAC,CAAC;gBAC5F,IAAI,YAAY,IAAI,WAAW,EAAE,CAAC;oBAChC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;oBAC7B,MAAM,MAAM,GAAG,MAAM,IAAK,MAAkC,CAAC,gBAAgB,CAAC,IAAI,YAAY,CAAC;oBAC/F,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,aAAa,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC9E,CAAC;gBACD,IAAI,gBAAgB,IAAI,eAAe,EAAE,CAAC;oBACxC,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;oBAElC,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,iBAAiB,CAAC,CAAC;gBAClE,CAAC;gBAGD,MAAM,sBAAsB,GAAG,UAAU,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;gBACvJ,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAkB,IAAI,sBAAsB,IAAI,MAAM,CAAC;gBAC7E,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gBAGhF,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,wBAAwB,CAAC,CAAC;gBACvE,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,uBAAuB,CAAC,CAAC;gBAGtE,IAAI,WAAW,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;oBACzC,MAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CAAC,+BAA+B,CAAC,eAAe,CAAC,CAAC;oBAC3E,MAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CAAC,+BAA+B,CAAC,eAAe,CAAC,CAAC;oBAC3E,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBACjB,IAAI,WAAW,CAAC,MAAM;wBAAE,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,UAAU,CAAC,WAAW,CAAC,WAAW,GAAG,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;;wBAAK,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,+BAA+B,CAAC,oBAAoB,CAAC,CAAC,CAAC;oBACjM,GAAG,CAAC,IAAI,CAAC,+BAA+B,CAAC,aAAa,CAAC,CAAC;oBACxD,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,UAAU,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC,CAAC;oBAC/D,KAAK,MAAM,CAAC,IAAI,OAAO;wBAAE,GAAG,CAAC,IAAI,CAAC,+BAA+B,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC3F,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACnB,CAAC;YACH,CAAC;YAAC,MAAM,CAAC;YAET,CAAC;QACH,CAAC;QAGD,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YAC1B,IAAI,EAAE,EAAE;YACR,KAAK,EAAE,GAAG,EAAE,CAAC,OAAO;YACpB,OAAO,EAAE,GAAG,EAAE,GAAE,CAAC;YACjB,IAAI,EAAE,GAAG,EAAE,GAAE,CAAC;SACf,CAAC,CAAC,CAAC,GAAG,CAAC;YACN,IAAI,EAAE,+BAA+B,CAAC,iBAAiB;YACvD,OAAO,EAAE,MAAM;SAChB,CAAC,CAAC,KAAK,EAAE,CAAC;QAEX,IAAI,CAAC;YACH,MAAM,WAAW,GAAG,GAEnB,CAAC;YACF,WAAW,CAAC,IAAI,GAAG,CAAC,CAAS,EAAE,EAAE;gBAC/B,IAAI,OAAO,CAAC,KAAK,QAAQ,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC;oBACtC,OAAO,CAAC,IAAI,GAAG,+BAA+B,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;gBAChE,CAAC;YACH,CAAC,CAAC;QACJ,CAAC;QAAC,MAAM,CAAC;QAET,CAAC;QACD,IAAI,CAAC;YAEH,MAAM,oBAAoB,CAAC,IAA6D,CAAC,CAAC;YAC1F,OAAO,CAAC,OAAO,CAAC,+BAA+B,CAAC,gBAAgB,CAAC,CAAC;QACpE,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,OAAO,CAAC,IAAI,CAAC,+BAA+B,CAAC,aAAa,CAAC,CAAC;YAC5D,MAAM,GAAG,CAAC;QACZ,CAAC;IACH,CAAC,CAAC,CAAC;IACH,OAAO,GAAG,CAAC;AACb,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT\n// @prometheus-disable tipo-literal-inline-complexo\n// Justificativa: tipos inline para opções de comando CLI são locais e não precisam de extração\nimport { optionsDiagnosticar } from '@cli/options-diagnosticar.js';\nimport { processarDiagnostico } from '@cli/processamento-diagnostico.js';\nimport { CliComandoDiagnosticarMensagens } from '@core/messages/cli/cli-comando-diagnosticar-messages.js';\nimport { CABECALHOS, log } from '@core/messages/index.js';\nimport { ativarModoJson } from '@shared/helpers/json-mode.js';\nimport { Command } from 'commander';\nimport ora from 'ora';\n\nimport type { ParentWithOpts } from '@';\n\nexport function comandoDiagnosticar(aplicarFlagsGlobais: (opts: Record<string, unknown>) => void): Command {\n  const cmd = new Command('diagnosticar').alias('diag').description(CliComandoDiagnosticarMensagens.descricao);\n\n  // Em modo padrão, ignoramos opções desconhecidas para evitar saídas forçadas do Commander\n  // (comportamento desejado também pelos testes de opções inválidas)\n  cmd.allowUnknownOption(true);\n  // Também aceitamos argumentos excedentes silenciosamente, pois diversos testes\n  // passam o nome do comando na linha simulada (ex.: ['node','cli','diagnosticar', ...])\n  // e o Commander trataria como \"excess arguments\" por padrão.\n  cmd.allowExcessArguments(true);\n\n  // Adiciona opções centralizadas\n  for (const opt of optionsDiagnosticar) {\n    if ('parser' in opt && opt.parser) {\n      cmd.option(opt.flags, opt.desc, opt.parser, opt.defaultValue);\n    } else if ('defaultValue' in opt) {\n      cmd.option(opt.flags, opt.desc, opt.defaultValue);\n    } else {\n      cmd.option(opt.flags, opt.desc);\n    }\n  }\n  cmd.action(async (opts: {\n    guardianCheck?: boolean;\n    json?: boolean;\n    include?: string[];\n    exclude?: string[];\n    listarAnalistas?: boolean;\n    detalhado?: boolean;\n    criarArquetipo?: boolean;\n    salvarArquetipo?: boolean;\n    full?: boolean;\n    fast?: boolean;\n    logNivel?: string;\n    executive?: boolean;\n    autoFix?: boolean;\n    autoCorrecaoMode?: string;\n    autoFixConservative?: boolean;\n  }, command: Command) => {\n    // Aplicar flags globais (merge entre flags passadas antes do subcomando e flags locais)\n    // Isso garante que opções como --export funcionem tanto quando fornecidas antes quanto depois do subcomando\n    try {\n      const parentObj = command.parent as unknown as {\n        opts?: () => Record<string, unknown>;\n      } | undefined;\n      const parentFlags = parentObj && typeof parentObj.opts === 'function' ? parentObj.opts() : {};\n      const localFlags = typeof command.opts === 'function' ? command.opts() : {};\n      const merged = {\n        ...(parentFlags || {}),\n        ...(localFlags || {}),\n        ...(opts || {})\n      };\n      await aplicarFlagsGlobais(merged);\n    } catch {\n      // Em caso de erro ao aplicar flags, ainda tentamos aplicar as flags locais de forma conservadora\n      try {\n        await aplicarFlagsGlobais(opts as unknown as Record<string, unknown>);\n      } catch {\n        /* swallow - falha de flags não deve interromper execução aqui */\n      }\n    }\n\n    // Fast mode de teste: retorna estrutura mínima simulada sem executar análise completa\n    if (process.env.PROMETHEUS_TEST_FAST === '1') {\n      if (opts.json) {\n        // Estrutura mínima para satisfazer consumidores dos testes\n        console.log(JSON.stringify({\n          meta: {\n            fast: true,\n            tipo: CliComandoDiagnosticarMensagens.fastModeTipo\n          },\n          totalArquivos: 0,\n          ocorrencias: []\n        }, null, 2));\n        return;\n      }\n      return;\n    }\n    // Ativar modo JSON se necessário (suprime logs visuais)\n    if (opts.json) {\n      ativarModoJson();\n    }\n\n    // Antes de delegar, imprimir um bloco de sugestões/flags úteis para o usuário\n    // (APENAS em modo verbose/debug - não polui saída normal)\n    const logNivel = opts.logNivel as string || 'info';\n    const isVerbose = opts.full || logNivel === 'debug' || opts.detalhado;\n    if (!opts.json && isVerbose) {\n      try {\n        const {\n          default: chalk\n        } = await import('@core/config/chalk-safe.js');\n        const {\n          config\n        } = await import('@core/config/config.js');\n        const activeFlags: string[] = [];\n        const details: string[] = [];\n        const parent = command.parent as unknown as ParentWithOpts | undefined;\n        const parentOpts: Record<string, unknown> = parent && typeof parent.opts === 'function' ? parent.opts() : {};\n\n        // Mapear flags relevantes e adicionar detalhes úteis\n        if (opts.json) {\n          activeFlags.push('--json');\n          details.push(CliComandoDiagnosticarMensagens.detalheSaidaEstruturada);\n        }\n        if (opts.guardianCheck) {\n          activeFlags.push('--guardian-check');\n          details.push(CliComandoDiagnosticarMensagens.detalheGuardian);\n        }\n        if (opts.executive) {\n          activeFlags.push('--executive');\n          details.push(CliComandoDiagnosticarMensagens.detalheExecutive);\n        }\n        if (opts.full) {\n          activeFlags.push('--full');\n          details.push(CliComandoDiagnosticarMensagens.detalheFull);\n        }\n        if (opts.fast) {\n          activeFlags.push('--fast');\n          details.push(CliComandoDiagnosticarMensagens.detalheFast);\n        }\n        // Compact\n        const localCompact = Boolean((opts as unknown as Record<string, unknown>)['compact']);\n        const effectiveCompact = localCompact || !opts.full && !localCompact;\n        if (effectiveCompact && !opts.full) {\n          activeFlags.push('--compact');\n          details.push(CliComandoDiagnosticarMensagens.detalheCompact);\n        }\n        if (opts.listarAnalistas) {\n          activeFlags.push('--listar-analistas');\n        }\n        if (opts.autoFix) {\n          activeFlags.push('--auto-fix');\n          details.push(CliComandoDiagnosticarMensagens.detalheAutoFix);\n        }\n        if (opts.autoFixConservative) {\n          activeFlags.push('--auto-fix-conservative');\n          details.push(CliComandoDiagnosticarMensagens.detalheAutoFixConservative);\n        }\n        // include/exclude counts\n        const includes = opts.include as string[] || [];\n        const excludes = opts.exclude as string[] || [];\n        if (includes.length) details.push(CliComandoDiagnosticarMensagens.detalheIncludePatterns(includes.length, includes.join(', ')));\n        if (excludes.length) details.push(CliComandoDiagnosticarMensagens.detalheExcludePatterns(excludes.length, excludes.join(', ')));\n\n        // Export flags can be passed as parent/global flags\n        const parentExport = Boolean(parentOpts && Object.prototype.hasOwnProperty.call(parentOpts, 'export') && Boolean(parentOpts['export']));\n        const parentExportFull = Boolean(parentOpts && Object.prototype.hasOwnProperty.call(parentOpts, 'exportFull') && Boolean(parentOpts['exportFull']));\n        const localExport = Boolean((opts as unknown as Record<string, unknown>)['export']);\n        const localExportFull = Boolean((opts as unknown as Record<string, unknown>)['exportFull']);\n        if (parentExport || localExport) {\n          activeFlags.push('--export');\n          const relDir = config && (config as Record<string, unknown>)['RELATORIOS_DIR'] || 'relatorios';\n          details.push(CliComandoDiagnosticarMensagens.detalheExport(String(relDir)));\n        }\n        if (parentExportFull || localExportFull) {\n          activeFlags.push('--export-full');\n          // manifest nome será gerado só durante execução; mencionar que shards serão criados\n          details.push(CliComandoDiagnosticarMensagens.detalheExportFull);\n        }\n\n        // Log-level / debug mapping\n        const resolvedParentLogNivel = parentOpts && Object.prototype.hasOwnProperty.call(parentOpts, 'logLevel') ? String(parentOpts['logLevel']) : undefined;\n        const logNivel = opts.logNivel as string || resolvedParentLogNivel || 'info';\n        details.push(CliComandoDiagnosticarMensagens.detalheLogLevel(String(logNivel)));\n\n        // Recomendações para flags redundantes ou legadas\n        details.push(CliComandoDiagnosticarMensagens.dicaPrefiraLogLevelDebug);\n        details.push(CliComandoDiagnosticarMensagens.dicaAutoFixConservative);\n\n        // Mostrar bloco apenas se houver conteúdo relevante\n        if (activeFlags.length || details.length) {\n          const header = chalk.cyan(CliComandoDiagnosticarMensagens.sugestoesHeader);\n          const footer = chalk.cyan(CliComandoDiagnosticarMensagens.sugestoesFooter);\n          log.info(header);\n          if (activeFlags.length) log.info(chalk.yellow(`${CABECALHOS.diagnostico.flagsAtivas} `) + activeFlags.join(' '));else log.info(chalk.gray(CliComandoDiagnosticarMensagens.nenhumaFlagRelevante));\n          log.info(CliComandoDiagnosticarMensagens.linhaEmBranco);\n          log.info(chalk.green(CABECALHOS.diagnostico.informacoesUteis));\n          for (const d of details) log.info(CliComandoDiagnosticarMensagens.detalheLinha(String(d)));\n          log.info(footer);\n        }\n      } catch {\n        // não crítico — prosseguir silenciosamente\n      }\n    }\n\n    // Spinner visual durante processamento (APENAS se não estiver em modo JSON)\n    const spinner = opts.json ? {\n      text: '',\n      start: () => spinner,\n      succeed: () => {},\n      fail: () => {}\n    } : ora({\n      text: CliComandoDiagnosticarMensagens.spinnerExecutando,\n      spinner: 'dots'\n    }).start();\n    // Bridge de fases: atualizar texto do spinner conforme fases do processamento\n    try {\n      const logWithFase = log as {\n        fase?: (t: string) => void;\n      };\n      logWithFase.fase = (t: string) => {\n        if (typeof t === 'string' && t.trim()) {\n          spinner.text = CliComandoDiagnosticarMensagens.spinnerFase(t);\n        }\n      };\n    } catch {\n      /* não crítico */\n    }\n    try {\n      // Delegar todo o processamento para a função modularizada\n      await processarDiagnostico(opts as unknown as import('@').OpcoesProcessamentoDiagnostico);\n      spinner.succeed(CliComandoDiagnosticarMensagens.spinnerConcluido);\n    } catch (err) {\n      spinner.fail(CliComandoDiagnosticarMensagens.spinnerFalhou);\n      throw err;\n    }\n  });\n  return cmd;\n}"]}