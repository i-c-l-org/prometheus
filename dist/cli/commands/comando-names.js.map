{"version":3,"file":"comando-names.js","sourceRoot":"","sources":["../../../src/cli/commands/comando-names.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n\nimport { parse } from '@babel/parser';\nimport traverseModule from '@babel/traverse';\nimport { ExitCode, sair } from '@cli/helpers/exit-codes.js';\nimport { getSourceFiles } from '@cli/helpers/get-files-src.js';\nimport chalk from '@core/config/chalk-safe.js';\nimport { CliComandoNamesMensagens } from '@core/messages/cli/cli-comando-names-messages.js';\nimport { log } from '@core/messages/index.js';\nimport { Command } from 'commander';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nconst traverse = traverseModule.default || traverseModule;\n\nexport function comandoNames(\n  aplicarFlagsGlobais: (opts: Record<string, unknown>) => void,\n): Command {\n  return new Command('names')\n    .description(CliComandoNamesMensagens.descricao)\n    .option('--legacy', CliComandoNamesMensagens.opcoes.legacy, false)\n    .action(async function (this: Command, opts: {\n    legacy?: boolean;\n  }) {\n      try {\n        await aplicarFlagsGlobais(\n          this.parent && typeof this.parent.opts === 'function'\n            ? this.parent.opts()\n            : {},\n        );\n      } catch (err) {\n        log.erro(CliComandoNamesMensagens.erros.falhaFlags(err instanceof Error ? err.message : String(err)));\n        sair(ExitCode.Failure);\n        return;\n      }\n\n      const RAIZ_DIR = process.cwd();\n      const SRC_DIR = path.resolve(RAIZ_DIR, 'src');\n      const SAIDA_DIR = path.resolve(RAIZ_DIR, 'names');\n\n      if (!fs.existsSync(SAIDA_DIR)) {\n        fs.mkdirSync(SAIDA_DIR, { recursive: true });\n      }\n\n      log.info(chalk.cyan(CliComandoNamesMensagens.status.inicio));\n\n      const files = getSourceFiles(SRC_DIR);\n      const allNomes = new Set<string>();\n      let arquivosComNomes = 0;\n\n      for (const file of files) {\n        try {\n          const code = fs.readFileSync(file, 'utf-8');\n          const ast = parse(code, {\n            sourceType: 'module',\n            plugins: ['typescript', 'decorators-legacy'],\n          });\n\n          const variableNomes = new Set<string>();\n          traverse(ast, {\n            VariableDeclarator(path) {\n              if (path.node.id.type === 'Identifier') {\n                const name = path.node.id.name;\n                variableNomes.add(name);\n                allNomes.add(name);\n              }\n            },\n          });\n\n          if (variableNomes.size > 0) {\n            const relPath = path.relative(SRC_DIR, file);\n            const outRelPath = relPath.replace(/\\.(ts|js)$/i, '.txt');\n            const outFile = path.join(SAIDA_DIR, outRelPath);\n            const outDir = path.dirname(outFile);\n            if (!fs.existsSync(outDir)) {\n              fs.mkdirSync(outDir, { recursive: true });\n            }\n            const sorted = Array.from(variableNomes).sort();\n            const content = sorted.map((name) => `${name} = `).join('\\n');\n            fs.writeFileSync(outFile, content);\n            arquivosComNomes++;\n          }\n        } catch {\n          console.warn(CliComandoNamesMensagens.erros.erroProcessar(path.relative(RAIZ_DIR, file)));\n        }\n      }\n\n      if (opts.legacy) {\n        const SAIDA_ARQUIVO = path.resolve(SAIDA_DIR, 'name.txt');\n        const sortedNomes = Array.from(allNomes).sort();\n        const content = sortedNomes.map(name => `${name} = `).join('\\n');\n        fs.writeFileSync(SAIDA_ARQUIVO, content);\n        const relSaida = path.relative(RAIZ_DIR, SAIDA_ARQUIVO);\n        log.sucesso(CliComandoNamesMensagens.status.concluidoLegacy(sortedNomes.length, arquivosComNomes, chalk.bold(relSaida)));\n      } else {\n        log.sucesso(CliComandoNamesMensagens.status.concluido(allNomes.size, arquivosComNomes));\n      }\n    });\n}\n"]}