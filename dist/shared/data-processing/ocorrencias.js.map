{"version":3,"file":"ocorrencias.js","sourceRoot":"","sources":["../../../src/shared/data-processing/ocorrencias.ts"],"names":[],"mappings":"AAWA,MAAM,UAAU,iBAAiB,CAO/B,GAAQ;IACR,MAAM,IAAI,GAAG,IAAI,GAAG,EAAa,CAAC;IAClC,KAAK,MAAM,CAAC,IAAI,GAAG,IAAI,EAAE,EAAE,CAAC;QAC1B,MAAM,GAAG,GAAG,GAAG,CAAC,CAAC,OAAO,IAAI,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,EAAE,IAAI,CAAC,CAAC,QAAQ,IAAI,EAAE,EAAE,CAAC;QAC9F,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;IACvC,CAAC;IACD,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;AACnC,CAAC;AAOD,MAAM,UAAU,gBAAgB,CAC9B,SAA0C;IAQ1C,IAAI,CAAC,SAAS,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC;QACnE,OAAO,EAAE,CAAC;IACZ,MAAM,GAAG,GAAG,IAAI,GAAG,EAShB,CAAC;IACJ,KAAK,MAAM,CAAC,IAAI,SAAS,EAAE,CAAC;QAC1B,MAAM,IAAI,GAAG,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,cAAc,CAAC,CAAC;QACxD,MAAM,GAAG,GAAG,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;QAC/C,MAAM,GAAG,GAAG,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;QACjD,MAAM,UAAU,GAAG,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC;QACxD,MAAM,KAAK,GAAG,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI;YAC7B,IAAI;YACJ,SAAS,EAAE,CAAC;YACZ,WAAW,EAAE,CAAC;YACd,SAAS,EAAE,CAAC;YACZ,MAAM,EAAE,KAAK;SACd,CAAC;QACF,KAAK,CAAC,SAAS,IAAI,GAAG,CAAC;QACvB,KAAK,CAAC,WAAW,IAAI,GAAG,CAAC;QACzB,KAAK,CAAC,SAAS,IAAI,CAAC,CAAC;QACrB,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,IAAI,UAAU,CAAC;QAC1C,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;IACvB,CAAC;IACD,OAAO,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;QAC5C,OAAO,CAAC,CAAC,WAAW,GAAG,CAAC,CAAC,WAAW,IAAI,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,CAAC;IACpE,CAAC,CAAC,CAAC;AACL,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT\n/**\n * Helpers utilitários para manipulação de ocorrências e métricas de analistas.\n *\n * Observação: centralizados conforme diretriz de helpers em src/shared/.\n */\n\n/**\n * Deduplica ocorrências preservando a primeira ocorrência encontrada.\n * A chave de deduplicação é composta por: relPath|linha|tipo|mensagem.\n */\nexport function dedupeOcorrencias<\n  T extends {\n    relPath?: string;\n    linha?: number;\n    tipo?: string;\n    mensagem?: string;\n  },\n>(arr: T[]): T[] {\n  const seen = new Map<string, T>();\n  for (const o of arr || []) {\n    const key = `${o.relPath || ''}|${String(o.linha ?? '')}|${o.tipo || ''}|${o.mensagem || ''}`;\n    if (!seen.has(key)) seen.set(key, o);\n  }\n  return Array.from(seen.values());\n}\n\n/**\n * Agrupa métricas de analistas por nome, somando duração e ocorrências e contando execuções.\n * Retorna array ordenado por ocorrências desc, depois duração desc.\n */\n\nexport function agruparAnalistas(\n  analistas?: Array<Record<string, unknown>>,\n): Array<{\n  nome: string;\n  duracaoMs: number;\n  ocorrencias: number;\n  execucoes: number;\n  global: boolean;\n}> {\n  if (!analistas || !Array.isArray(analistas) || analistas.length === 0)\n    return [];\n  const map = new Map<\n    string,\n    {\n      nome: string;\n      duracaoMs: number;\n      ocorrencias: number;\n      execucoes: number;\n      global: boolean;\n    }\n  >();\n  for (const a of analistas) {\n    const nome = String((a && a['nome']) || 'desconhecido');\n    const dur = Number((a && a['duracaoMs']) || 0);\n    const occ = Number((a && a['ocorrencias']) || 0);\n    const globalFlag = Boolean((a && a['global']) || false);\n    const entry = map.get(nome) || {\n      nome,\n      duracaoMs: 0,\n      ocorrencias: 0,\n      execucoes: 0,\n      global: false,\n    };\n    entry.duracaoMs += dur;\n    entry.ocorrencias += occ;\n    entry.execucoes += 1;\n    entry.global = entry.global || globalFlag;\n    map.set(nome, entry);\n  }\n  return Array.from(map.values()).sort((x, y) => {\n    return y.ocorrencias - x.ocorrencias || y.duracaoMs - x.duracaoMs;\n  });\n}\n"]}