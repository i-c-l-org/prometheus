{"version":3,"file":"json.js","sourceRoot":"","sources":["../../../src/shared/data-processing/json.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n/**\n * Utilidades de JSON: escape Unicode e stringificação segura para consumidores legados.\n *\n * Regras:\n * - Converte qualquer caractere fora do ASCII básico em sequências \\uXXXX.\n * - Para caracteres fora do BMP, emite pares substitutos (dois \\uXXXX).\n * - Mantém caracteres ASCII intactos.\n */\n\n// Constantes Unicode e BMP\nconst ASCII_MAX = 0x7f;\nconst BMP_MAX = 0xffff;\nconst SUPPLEMENTARY_PLANO_DESLOCAMENTO = 0x10000;\nconst HIGH_SURROGATE_BASE = 0xd800;\nconst LOW_SURROGATE_BASE = 0xdc00;\nconst SURROGATE_DESLOCAMENTO = 10;\nconst SURROGATE_MASCARA = 0x3ff;\nconst HEX_PAD_LENGTH = 4;\nconst JSON_INDENTACAO_PADRAO = 2;\n\n/**\n * Escapa caracteres não-ASCII para sequências \\uXXXX, incluindo pares substitutos.\n */\n\nexport function escapeNonAscii(s: string): string {\n  let out = '';\n  for (const ch of s) {\n    const cp = ch.codePointAt(0);\n    if (cp === undefined || cp === null || cp <= ASCII_MAX) {\n      out += ch;\n    } else if (cp <= BMP_MAX) {\n      out += `\\\\u${cp.toString(16).padStart(HEX_PAD_LENGTH, '0')}`;\n    } else {\n      // caracteres fora do BMP -> pares substitutos\n      const codePointOffset = cp - SUPPLEMENTARY_PLANO_DESLOCAMENTO;\n      const highSurrogate = HIGH_SURROGATE_BASE + (codePointOffset >> SURROGATE_DESLOCAMENTO);\n      const lowSurrogate = LOW_SURROGATE_BASE + (codePointOffset & SURROGATE_MASCARA);\n      out += `\\\\u${highSurrogate.toString(16).padStart(HEX_PAD_LENGTH, '0')}`;\n      out += `\\\\u${lowSurrogate.toString(16).padStart(HEX_PAD_LENGTH, '0')}`;\n    }\n  }\n  return out;\n}\n\n/**\n * Stringifica um objeto em JSON aplicando escapeNonAscii em todos os strings do objeto.\n * Normaliza possíveis double-escapes (\"\\\\uXXXX\" -> \"\\uXXXX\").\n */\n\n/**\n * Converte uma string JSON (já gerada) em uma versão ASCII-only\n * substituindo todos os codepoints >= 0x80 por \\uXXXX (pares substitutos\n * para codepoints fora do BMP).\n */\nexport function escapeJsonAscii(raw: string): string {\n  let out = '';\n  for (let i = 0; i < raw.length; i++) {\n    const cp = raw.codePointAt(i) as number;\n    if (cp <= ASCII_MAX) {\n      out += raw[i];\n    } else if (cp <= BMP_MAX) {\n      out += `\\\\u${cp.toString(16).padStart(HEX_PAD_LENGTH, '0')}`;\n    } else {\n      // fora do BMP: gerar pares substitutos\n      const codePointOffset = cp - SUPPLEMENTARY_PLANO_DESLOCAMENTO;\n      const highSurrogate = HIGH_SURROGATE_BASE + (codePointOffset >> SURROGATE_DESLOCAMENTO);\n      const lowSurrogate = LOW_SURROGATE_BASE + (codePointOffset & SURROGATE_MASCARA);\n      out += `\\\\u${highSurrogate.toString(16).padStart(HEX_PAD_LENGTH, '0')}\\\\u${lowSurrogate.toString(16).padStart(HEX_PAD_LENGTH, '0')}`;\n      // pular o segundo code unit já consumido pelo codePointAt\n      i++;\n    }\n  }\n  return out;\n}\n\n/**\n * Stringifica um objeto em JSON. Por padrão emite UTF-8 (legível). Se\n * options.asciiOnly for true, converte o JSON resultante em ASCII-only\n * substituindo caracteres > 0x7F por \\uXXXX.\n */\nexport function stringifyJsonEscaped(value: unknown, space: number = JSON_INDENTACAO_PADRAO, options?: {\n  asciiOnly?: boolean;\n}): string {\n  const raw = JSON.stringify(value, null, space);\n  if (options && options.asciiOnly) return escapeJsonAscii(raw);\n  return raw;\n}"]}