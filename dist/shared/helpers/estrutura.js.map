{"version":3,"file":"estrutura.js","sourceRoot":"","sources":["../../../src/shared/helpers/estrutura.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n// @prometheus-disable tipo-literal-inline-complexo\n// Justificativa: tipos locais para helpers de estrutura\nimport path from 'node:path';\n\nimport { lerEstado } from '@shared/persistence/persistencia.js';\n\nimport type { NomeacaoEstilo, OpcoesEstrategista, ParseNomeResultado } from '@';\n\n// Re-exporta os tipos para compatibilidade\nexport type { NomeacaoEstilo, OpcoesEstrategista, ParseNomeResultado };\nexport const CATEGORIAS_PADRAO: Required<NonNullable<OpcoesEstrategista['categoriasMapa']>> = {\n  controller: 'controllers',\n  controllers: 'controllers',\n  webhook: 'webhooks',\n  webhooks: 'webhooks',\n  cliente: 'clients',\n  client: 'clients',\n  service: 'services',\n  repository: 'repositories',\n  config: 'config',\n  test: '__tests__',\n  spec: '__tests__',\n  type: 'types',\n  types: 'types',\n  handler: 'handlers'\n};\nexport const PADRAO_OPCOES: Required<Pick<OpcoesEstrategista, 'raizCodigo' | 'criarSubpastasPorEntidade' | 'apenasCategoriasConfiguradas' | 'categoriasMapa' | 'ignorarPastas'>> & Pick<OpcoesEstrategista, 'estiloPreferido'> = {\n  raizCodigo: 'src',\n  criarSubpastasPorEntidade: true,\n  apenasCategoriasConfiguradas: true,\n  estiloPreferido: 'kebab',\n  categoriasMapa: {},\n  ignorarPastas: ['node_modules', '.git', 'dist', 'build', 'coverage', '.prometheus']\n};\n\n// Presets de estrutura: baseiam-se nos defaults, aplicando ajustes de organização\nexport const PRESETS: Record<string, Partial<typeof PADRAO_OPCOES> & {\n  nome: string;\n}> = {\n  prometheus: {\n    nome: 'prometheus',\n    // No preset \"prometheus\" não organizamos por entidade/domains\n    criarSubpastasPorEntidade: false,\n    apenasCategoriasConfiguradas: false,\n    categoriasMapa: {\n      ...CATEGORIAS_PADRAO\n    },\n    ignorarPastas: [...PADRAO_OPCOES.ignorarPastas, 'tests', 'tests/fixtures', 'src/analistas', 'src/arquitetos', 'src/relatorios', 'src/guardian', 'src/nucleo', 'src/cli', 'src/zeladores']\n  },\n  'node-community': {\n    nome: 'node-community',\n    criarSubpastasPorEntidade: false,\n    apenasCategoriasConfiguradas: false,\n    categoriasMapa: {\n      ...CATEGORIAS_PADRAO\n    }\n  },\n  'ts-lib': {\n    nome: 'ts-lib',\n    criarSubpastasPorEntidade: false,\n    apenasCategoriasConfiguradas: false,\n    categoriasMapa: {\n      ...CATEGORIAS_PADRAO\n    }\n  }\n};\nexport function normalizarRel(p: string): string {\n  return p.replace(/\\\\/g, '/');\n}\nexport function deveIgnorar(rel: string, ignorar: string[]): boolean {\n  const norm = normalizarRel(rel);\n  // Ignora se qualquer padrão ocorrer em qualquer nível do caminho (não apenas na raiz)\n  // Exemplos suportados:\n  //  - 'node_modules' casa 'node_modules/...', 'a/b/node_modules/...'\n  //  - 'dist' casa 'dist/...', 'x/dist/...'\n  //  - padrões com subpastas ('coverage/html') ainda casam por substring segmentada\n  return ignorar.some(raw => {\n    const pat = normalizarRel(raw);\n    if (!pat) return false;\n    if (norm === pat) return true;\n    if (norm.startsWith(`${pat}/`)) return true;\n    if (norm.endsWith(`/${pat}`)) return true;\n    // Casa por segmento intermediário:\n    //  - '/pat/' ocorre no meio do caminho\n    //  - ou qualquer segmento exatamente igual ao pat (quando pat é um único segmento)\n    if (norm.includes(`/${pat}/`)) return true;\n    if (!pat.includes('/')) {\n      const segs = norm.split('/');\n      if (segs.includes(pat)) return true;\n    }\n    return false;\n  });\n}\nexport function parseNomeArquivo(baseNome: string): ParseNomeResultado {\n  const semExt = baseNome.replace(/\\.[^.]+$/i, '');\n  const lower = semExt.toLowerCase();\n\n  // Apenas aceite categorias reconhecidas (singular/plural) para evitar falsos positivos\n  const CATS = new Set(Object.keys(CATEGORIAS_PADRAO).map(c => c.toLowerCase()));\n  const dotMatch = /^(?<ent>[\\w-]+)\\.(?<cat>[\\w-]+)$/.exec(semExt);\n  if (dotMatch?.groups) {\n    const cat = dotMatch.groups.cat.toLowerCase();\n    if (CATS.has(cat)) return {\n      entidade: dotMatch.groups.ent,\n      categoria: cat\n    };\n  }\n  const kebabMatch = /^(?<ent>[\\w-]+)-(?<cat>[\\w-]+)$/.exec(lower);\n  if (kebabMatch?.groups) {\n    const cat = kebabMatch.groups.cat.toLowerCase();\n    if (CATS.has(cat)) return {\n      entidade: kebabMatch.groups.ent,\n      categoria: cat\n    };\n  }\n  const camelMatch = /^(?<ent>[A-Za-z][A-Za-z0-9]*?)(?<cat>Controller|Webhook|Cliente|Client|Service|Repository)$/.exec(semExt);\n  if (camelMatch?.groups) return {\n    entidade: camelMatch.groups.ent,\n    categoria: camelMatch.groups.cat.toLowerCase()\n  };\n  const tokens = ['controller', 'controllers', 'webhook', 'webhooks', 'cliente', 'client', 'service', 'repository'];\n  for (const tk of tokens) {\n    if (lower.endsWith(`-${tk}`) || lower.endsWith(`.${tk}`)) {\n      const entidade = lower.replace(new RegExp(`[.-]${tk}$`), '');\n      return {\n        entidade: entidade || null,\n        categoria: tk\n      };\n    }\n  }\n  return {\n    entidade: null,\n    categoria: null\n  };\n}\nexport function destinoPara(relPath: string, raizCodigo: string, criarSubpastasPorEntidade: boolean, apenasCategoriasConfiguradas: boolean, categoriasMapa: Record<string, string>): {\n  destinoDir: string | null;\n  motivo?: string;\n} {\n  const baseNome = path.posix.basename(normalizarRel(relPath));\n  const {\n    entidade,\n    categoria\n  } = parseNomeArquivo(baseNome);\n  if (!categoria) return {\n    destinoDir: null\n  };\n\n  // Evita pluralização incorreta quando já termina com 's'\n  const normCat = categoria.toLowerCase();\n  const pastaMapeada = categoriasMapa[normCat];\n  if (!pastaMapeada && apenasCategoriasConfiguradas) {\n    return {\n      destinoDir: null,\n      motivo: `categoria ${categoria} não configurada`\n    };\n  }\n  const pastaFinal = pastaMapeada || (normCat.endsWith('s') ? normCat : `${normCat}s`);\n  if (criarSubpastasPorEntidade && entidade) {\n    const ent = entidade.toString().replace(/[^a-z0-9-]/gi, '').toLowerCase();\n    const dir = path.posix.join(raizCodigo, 'domains', ent, pastaFinal);\n    return {\n      destinoDir: dir,\n      motivo: `categoria ${categoria} organizada por entidade ${ent}`\n    };\n  }\n  return {\n    destinoDir: path.posix.join(raizCodigo, pastaFinal),\n    motivo: `categoria ${categoria} organizada por camada`\n  };\n}\nexport async function carregarConfigEstrategia(baseDir: string, overrides?: OpcoesEstrategista): Promise<Required<typeof PADRAO_OPCOES>> {\n  const caminho = path.join(baseDir, '.prometheus', 'estrutura.json');\n  const lido = await lerEstado<Record<string, unknown> | []>(caminho);\n  const cfgArquivo = (lido && !Array.isArray(lido) && typeof lido === 'object' ? lido : {}) as (Partial<typeof PADRAO_OPCOES> & {\n    preset?: string;\n  }) | {};\n  const nomePreset = (overrides?.preset || (cfgArquivo as {\n    preset?: string;\n  }).preset) as string | undefined;\n  const preset = nomePreset && PRESETS[nomePreset]?.nome ? PRESETS[nomePreset] : undefined;\n\n  // Merge determinístico: DEFAULT -> PRESET -> ARQUIVO -> OVERRIDES (apenas chaves definidas)\n  const base = {\n    ...PADRAO_OPCOES\n  } as Required<typeof PADRAO_OPCOES>;\n  const aplicarParcial = (src?: Partial<typeof PADRAO_OPCOES>) => {\n    if (!src) return;\n    if (src.raizCodigo) base.raizCodigo = src.raizCodigo as string;\n    if (typeof src.criarSubpastasPorEntidade === 'boolean') base.criarSubpastasPorEntidade = src.criarSubpastasPorEntidade as boolean;\n    if (typeof src.apenasCategoriasConfiguradas === 'boolean') base.apenasCategoriasConfiguradas = src.apenasCategoriasConfiguradas as boolean;\n    if (src.estiloPreferido) base.estiloPreferido = src.estiloPreferido as NomeacaoEstilo;\n    if (src.categoriasMapa) base.categoriasMapa = {\n      ...base.categoriasMapa,\n      ...src.categoriasMapa\n    } as Record<string, string>;\n    if (src.ignorarPastas && Array.isArray(src.ignorarPastas)) base.ignorarPastas = Array.from(new Set([...base.ignorarPastas, ...src.ignorarPastas]));\n  };\n  aplicarParcial(preset as Partial<typeof PADRAO_OPCOES>);\n  aplicarParcial(cfgArquivo as Partial<typeof PADRAO_OPCOES>);\n  aplicarParcial(overrides as Partial<typeof PADRAO_OPCOES>);\n\n  // No modo de preset (apenasCategoriasConfiguradas=false), garantimos defaults base.\n  // No modo manual (true), o usuário controla explicitamente o que será mapeado.\n  if (!base.apenasCategoriasConfiguradas) {\n    base.categoriasMapa = {\n      ...CATEGORIAS_PADRAO,\n      ...base.categoriasMapa\n    } as Record<string, string>;\n  }\n  return base;\n}"]}