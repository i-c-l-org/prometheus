{"version":3,"file":"contexto-projeto.js","sourceRoot":"","sources":["../../src/shared/contexto-projeto.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n\n/**\n * Utilitário para detectar contexto inteligente de projetos\n * Evita falsos positivos em analistas ao identificar o tipo de projeto e framework\n */\n\nimport type { ContextoProjeto, DetectarContextoOpcoes } from '@';\n\n// Re-exporta os tipos para compatibilidade\nexport type { ContextoProjeto, DetectarContextoOpcoes };\n\n/**\n * Detecta o contexto de um arquivo/projeto para análise inteligente\n */\n\nexport function detectarContextoProjeto(opcoes: DetectarContextoOpcoes): ContextoProjeto {\n  const {\n    arquivo,\n    conteudo,\n    relPath,\n    packageJson\n  } = opcoes;\n  const p = arquivo.replace(/\\\\/g, '/').toLowerCase();\n  const rel = (relPath || arquivo).replace(/\\\\/g, '/').toLowerCase();\n  const contexto: ContextoProjeto = {\n    isBot: false,\n    isCLI: false,\n    isWebApp: false,\n    isLibrary: false,\n    isTest: false,\n    isConfiguracao: false,\n    isInfrastructure: false,\n    frameworks: [],\n    linguagens: []\n  };\n\n  // Detecta linguagens\n  if (/\\.(ts|tsx)$/.test(p)) contexto.linguagens.push('typescript');\n  if (/\\.(js|jsx)$/.test(p)) contexto.linguagens.push('javascript');\n  if (/\\.(py)$/.test(p)) contexto.linguagens.push('python');\n  if (/\\.(php)$/.test(p)) contexto.linguagens.push('php');\n  if (/\\.(html|htm)$/.test(p)) contexto.linguagens.push('html');\n  if (/\\.(css)$/.test(p)) contexto.linguagens.push('css');\n\n  // Detecta se é arquivo de teste (PRIORIDADE ALTA - deve ser verificado primeiro)\n  contexto.isTest = /(^|\\/)tests?(\\/|\\.)/i.test(rel) || /\\.(test|spec)\\.(ts|js|tsx|jsx)$/i.test(p) || /__tests__/.test(rel) || /describe\\s*\\(|it\\s*\\(|test\\s*\\(|expect\\s*\\(/.test(conteudo);\n\n  // Se é arquivo de teste, não deve ser classificado como outros tipos\n  if (contexto.isTest) {\n    return {\n      ...contexto,\n      isBot: false,\n      isCLI: false,\n      isWebApp: false,\n      isLibrary: false\n    };\n  }\n\n  // Detecta se é arquivo de configuração\n  contexto.isConfiguracao = /config|\\.config\\.|\\.rc\\.|\\.json$|\\.yaml$|\\.yml$|\\.env/.test(p) || /(^|\\/)(\\.|config|configs?)(\\/|\\.)/i.test(rel) || /package\\.json|tsconfig|eslint|prettier|vitest|jest|babel/.test(p) || /stub|mock|fixture|example/i.test(p); // Inclui stubs e mocks\n\n  // Detecta se é arquivo de infraestrutura (setup, main, index)\n  contexto.isInfrastructure = /index\\.|main\\.|app\\.|server\\.|setup\\.|bootstrap/.test(p) || /(client\\.login|client\\.connect|createApp|express\\(\\)|listen\\(|server\\.start)/.test(conteudo) || /export\\s+default|module\\.exports\\s*=/.test(conteudo) || /(guardian|sentinela|verificador|hash|diff|baseline)/i.test(p) ||\n  // Guardian e verificação\n  /(monitor|watch|observer|scanner)/i.test(p); // Monitoring\n\n  // Detecta frameworks por imports/requires\n  const importMatches = conteudo.match(/import.*from.*['\"`]([^'\"`]+)['\"`]|require\\(['\"`]([^'\"`]+)['\"`]\\)/g) || [];\n  const allImports = importMatches.join(' ').toLowerCase();\n\n  // Frameworks de bot\n  if (/discord\\.js|@discordjs|eris/.test(allImports)) {\n    contexto.frameworks.push('discord.js');\n    contexto.isBot = true;\n  }\n  if (/telegraf|grammy|node-telegram-bot/.test(allImports)) {\n    contexto.frameworks.push('telegraf');\n    contexto.isBot = true;\n  }\n\n  // Frameworks CLI\n  if (/commander|yargs|inquirer|chalk|ora/.test(allImports)) {\n    contexto.frameworks.push('cli');\n    contexto.isCLI = true;\n  }\n  if (/oclif/.test(allImports)) {\n    contexto.frameworks.push('oclif');\n    contexto.isCLI = true;\n  }\n\n  // Frameworks web\n  if (/express|fastify|koa|hapi/.test(allImports)) {\n    contexto.frameworks.push('backend');\n    contexto.isWebApp = true;\n  }\n  if (/react|vue|angular|svelte/.test(allImports)) {\n    contexto.frameworks.push('frontend');\n    contexto.isWebApp = true;\n  }\n  if (/next|nuxt|gatsby|remix/.test(allImports)) {\n    contexto.frameworks.push('fullstack');\n    contexto.isWebApp = true;\n  }\n\n  // Detecta por conteúdo específico se imports não cobrirem\n  if (!contexto.isBot && /slash.*command|interaction\\.|commandName|client\\.on.*message/i.test(conteudo)) {\n    contexto.isBot = true;\n  }\n  if (!contexto.isCLI && /process\\.argv|command.*line|\\.option\\(|\\.command\\(/i.test(conteudo)) {\n    contexto.isCLI = true;\n  }\n\n  // Detecta se é arquivo de infraestrutura por conteúdo (NÃO é comando)\n  if (/export\\s+(interface|type|class.*\\{)/i.test(conteudo) || /import.*types?.*from|export.*types?/i.test(conteudo) || /function\\s+format|function\\s+display|function\\s+render/i.test(conteudo) || /console\\.log|logger\\.|\\.write\\(|\\.render\\(/i.test(conteudo)) {\n    contexto.isInfrastructure = true;\n  }\n\n  // Detecta se é biblioteca por estrutura de exports\n  if (/export\\s+(class|function|const|interface|type)|module\\.exports/.test(conteudo) && !contexto.isWebApp && !contexto.isBot && !contexto.isCLI) {\n    contexto.isLibrary = true;\n  }\n\n  // Detecta por path patterns (mais específico)\n  if (/(^|\\/)bot(\\/|\\.|-)|discord|telegram/.test(rel)) {\n    contexto.isBot = true;\n  }\n\n  // CLI paths - mais específico para evitar falsos positivos\n  if (/(^|\\/)(cli|commands?|comandos?)(\\/|\\.|-)|bin\\//.test(rel)) {\n    // Mas não se for apenas processamento, display, options, ou utilitários\n    if (!/\\/(processing|display|options|utils|helpers|types|interfaces)\\//.test(rel) && !/\\/(options|display|processing|filter|helper|util|type)\\./.test(rel) && !/(options|processing|display|filter|helper|util|types?)[-.]/.test(p)) {\n      contexto.isCLI = true;\n    }\n  }\n  if (/(^|\\/)src\\/(pages|app|routes|components|views)/.test(rel)) {\n    contexto.isWebApp = true;\n  }\n\n  // Detecta por package.json se disponível\n  if (packageJson) {\n    const deps = {\n      ...(packageJson.dependencies as Record<string, string> || {}),\n      ...(packageJson.devDependencies as Record<string, string> || {})\n    };\n    Object.keys(deps).forEach(dep => {\n      if (/discord\\.js|eris|@discordjs/.test(dep)) {\n        contexto.isBot = true;\n        contexto.frameworks.push('discord.js');\n      }\n      if (/telegraf|grammy/.test(dep)) {\n        contexto.isBot = true;\n        contexto.frameworks.push('telegraf');\n      }\n      if (/commander|yargs|oclif/.test(dep)) {\n        contexto.isCLI = true;\n        contexto.frameworks.push('cli');\n      }\n      if (/express|fastify|react|vue|next/.test(dep)) {\n        contexto.isWebApp = true;\n      }\n    });\n  }\n\n  // Remove duplicatas\n  contexto.frameworks = [...new Set(contexto.frameworks)];\n  contexto.linguagens = [...new Set(contexto.linguagens)];\n  return contexto;\n}\n\n/**\n * Verifica se um arquivo é relevante para um tipo específico de análise\n */\n\nexport function isRelevanteParaAnalise(contexto: ContextoProjeto, tipoAnalise: 'comando' | 'web' | 'bot' | 'cli' | 'biblioteca'): boolean {\n  // Nunca analise arquivos de teste, config ou infraestrutura para padrões específicos\n  if (contexto.isTest || contexto.isConfiguracao || contexto.isInfrastructure) return false;\n  switch (tipoAnalise) {\n    case 'comando':\n    case 'bot':\n      // Para análise de comando, deve ser bot/CLI E não ser infraestrutura\n      return (contexto.isBot || contexto.isCLI) && !contexto.isInfrastructure;\n    case 'cli':\n      return contexto.isCLI && !contexto.isInfrastructure;\n    case 'web':\n      return contexto.isWebApp;\n    case 'biblioteca':\n      return contexto.isLibrary;\n    default:\n      return true;\n  }\n}\n\n/**\n * Sugere frameworks baseado no contexto detectado\n */\n\nexport function sugerirFrameworks(contexto: ContextoProjeto): string[] {\n  const sugestoes: string[] = [];\n  if (contexto.isBot && !contexto.frameworks.some((f: string) => f.includes('discord') || f.includes('telegraf'))) {\n    sugestoes.push('Considere usar discord.js ou telegraf para bots');\n  }\n  if (contexto.isCLI && !contexto.frameworks.some((f: string) => f.includes('cli') || f.includes('commander'))) {\n    sugestoes.push('Considere usar commander.js ou yargs para CLI');\n  }\n  return sugestoes;\n}"]}