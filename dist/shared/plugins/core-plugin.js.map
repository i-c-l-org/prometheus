{"version":3,"file":"core-plugin.js","sourceRoot":"","sources":["../../../src/shared/plugins/core-plugin.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT-0\nimport type { ParserOptions as BabelParserOptions } from '@babel/parser';\nimport { parse as babelParse } from '@babel/parser';\nimport type { File as BabelFile } from '@babel/types';\nimport { log, logCore } from '@core/messages/index.js';\nimport { getCurrentParsingFile } from '@core/parsing/parser.js';\nimport * as csstree from 'css-tree';\nimport { XMLParser, XMLValidator } from 'fast-xml-parser';\nimport { parseDocument } from 'htmlparser2';\nimport { createRequire } from 'module';\n\nimport type { BabelFileExtra, ParserOptions, ParserPlugin, RawAst } from '@';\n\nconst localRequire = createRequire(import.meta.url);\n\n/**\n * Plugin core do Prometheus - cont√©m parsers para linguagens principais\n * JavaScript, TypeScript, HTML, CSS, XML\n */\nexport class CorePlugin implements ParserPlugin {\n  name = 'core';\n  version = '0.2.0';\n  extensions = [\n    '.js',\n    '.jsx',\n    '.ts',\n    '.tsx',\n    '.mjs',\n    '.cjs',\n    '.html',\n    '.htm',\n    '.css',\n    '.xml',\n    '.php',\n    '.py',\n    '.d.ts', // tratado especialmente (retorna null)\n  ];\n\n  async parse(codigo: string, opts?: ParserOptions): Promise<BabelFile | null> {\n    // Determina extens√£o baseada no contexto ou configura√ß√£o\n    const ext = this.inferExtension(codigo, opts);\n\n    switch (ext) {\n      case '.js':\n      case '.jsx':\n      case '.mjs':\n      case '.cjs':\n        return this.parseJavaScript(codigo, opts);\n\n      case '.ts':\n      case '.tsx':\n        return this.parseTypeScript(codigo, opts);\n\n      case '.d.ts':\n        // Arquivos de defini√ß√£o n√£o t√™m AST √∫til\n        return null;\n\n      case '.html':\n      case '.htm':\n        return this.parseHtml(codigo);\n\n      case '.css':\n        return this.parseCss(codigo);\n\n      case '.xml':\n        return this.parseXml(codigo);\n\n      case '.php':\n        return this.parsePhp(codigo);\n\n      case '.py':\n        return this.parsePython(codigo);\n\n      default:\n        logCore.extensaoNaoSuportada(ext);\n        return null;\n    }\n  }\n\n  /**\n   * Parse JavaScript com suporte a Flow e fallbacks\n   */\n  private parseJavaScript(\n    codigo: string,\n    opts?: ParserOptions,\n  ): BabelFile | null {\n    // Primeira tentativa com plugins padr√£o\n    let result = this.parseComBabel(codigo, opts?.plugins);\n\n    if (result === null) {\n      // Heur√≠stica Flow\n      const pareceFlow =\n        /@flow\\b/.test(codigo) || /\\bimport\\s+type\\b/.test(codigo);\n      if (pareceFlow) {\n        const flowPlugins = [\n          'flow',\n          'jsx',\n          'decorators-legacy',\n          'importAttributes',\n          'importAssertions',\n          'classProperties',\n          'classPrivateProperties',\n          'classPrivateMethods',\n          'optionalChaining',\n          'nullishCoalescingOperator',\n          'topLevelAwait',\n        ];\n        result = this.parseComBabel(codigo, flowPlugins);\n      }\n\n      // Fallback JS moderno sem TypeScript\n      if (result === null) {\n        const jsModernPlugins = [\n          'jsx',\n          'decorators-legacy',\n          'importAttributes',\n          'importAssertions',\n          'classProperties',\n          'classPrivateProperties',\n          'classPrivateMethods',\n          'optionalChaining',\n          'nullishCoalescingOperator',\n          'topLevelAwait',\n        ];\n        result = this.parseComBabel(codigo, jsModernPlugins);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Parse TypeScript com fallback para compilador TS\n   */\n  private parseTypeScript(\n    codigo: string,\n    opts?: ParserOptions,\n  ): BabelFile | null {\n    const ext = this.inferExtension(codigo, opts);\n    const isTsx = ext === '.tsx';\n\n    // Primeira tentativa com Babel\n    let result = this.parseComBabel(codigo, opts?.plugins);\n\n    // Fallback para TypeScript compiler\n    if (result === null) {\n      result = this.parseComTypeScriptCompiler(codigo, isTsx);\n    }\n\n    return result;\n  }\n\n  /**\n   * Parse com Babel (m√©todo base)\n   */\n  private parseComBabel(codigo: string, plugins?: string[]): BabelFile | null {\n    const defaultPlugins = [\n      'typescript',\n      'jsx',\n      'decorators-legacy',\n      'importAttributes',\n      'importAssertions',\n      'classProperties',\n      'classPrivateProperties',\n      'classPrivateMethods',\n      'optionalChaining',\n      'nullishCoalescingOperator',\n      'topLevelAwait',\n    ];\n\n    const options: BabelParserOptions = {\n      sourceType: 'unambiguous',\n      plugins: (Array.isArray(plugins)\n        ? plugins\n        : defaultPlugins) as BabelParserOptions['plugins'],\n    };\n\n    try {\n      return babelParse(codigo, options);\n    } catch (e) {\n      logCore.erroBabel((e as Error).message, getCurrentParsingFile());\n      return null;\n    }\n  }\n\n  /**\n   * Fallback usando TypeScript compiler\n   */\n  private parseComTypeScriptCompiler(\n    codigo: string,\n    tsx = false,\n  ): BabelFile | null {\n    try {\n      const ts: typeof import('typescript') = localRequire('typescript');\n      const sf = ts.createSourceFile(\n        tsx ? 'file.tsx' : 'file.ts',\n        codigo,\n        ts.ScriptTarget.Latest,\n        false,\n        tsx ? ts.ScriptKind.TSX : ts.ScriptKind.TS,\n      );\n\n      return this.wrapMinimal(tsx ? 'tsx-tsc' : 'ts-tsc', {\n        kind: sf.kind,\n        statements: sf.statements?.length ?? 0,\n      });\n    } catch (e) {\n      logCore.erroTs((e as Error).message, getCurrentParsingFile());\n      return null;\n    }\n  }\n\n  /**\n   * Parse HTML\n   */\n  private parseHtml(codigo: string): BabelFile | null {\n    try {\n      const dom = parseDocument(codigo, { xmlMode: false });\n      return this.wrapMinimal('html', dom);\n    } catch (e) {\n      logCore.erroHtml((e as Error).message, getCurrentParsingFile());\n      return null;\n    }\n  }\n\n  /**\n   * Parse CSS\n   */\n  private parseCss(codigo: string): BabelFile | null {\n    try {\n      const ast = csstree.parse(codigo, { positions: false });\n      return this.wrapMinimal('css', ast);\n    } catch (e) {\n      logCore.erroCss((e as Error).message, getCurrentParsingFile());\n      return null;\n    }\n  }\n\n  /**\n   * Parse XML\n   */\n  private parseXml(codigo: string): BabelFile | null {\n    try {\n      // Valida√ß√£o pr√©via para garantir que XML malformado retorne null (conforme testes)\n      const isValid = XMLValidator.validate(codigo);\n      if (isValid !== true) {\n        log.debug(\n          `‚ö†Ô∏è XML inv√°lido: ${typeof isValid === 'object' ? (isValid as { err?: { msg?: string } }).err?.msg : 'desconhecido'}`,\n        );\n        return null;\n      }\n      const parser = new XMLParser({\n        ignoreAttributes: false,\n        attributeNamePrefix: '@',\n      });\n      const ast = parser.parse(codigo);\n      return this.wrapMinimal('xml', ast);\n    } catch (e) {\n      logCore.erroXml((e as Error).message, getCurrentParsingFile());\n      return null;\n    }\n  }\n\n  /**\n   * Parse PHP\n   */\n  private parsePhp(codigo: string): BabelFile | null {\n    try {\n      // Heur√≠stica simples para PHP: extrai classes, fun√ß√µes e namespaces\n      const classes = Array.from(\n        codigo.matchAll(/\\bclass\\s+([A-Za-z0-9_]+)/g),\n      ).map((m) => m[1]);\n      const functions = Array.from(\n        codigo.matchAll(/\\bfunction\\s+([A-Za-z0-9_]+)/g),\n      ).map((m) => m[1]);\n      const namespaces = Array.from(\n        codigo.matchAll(/\\bnamespace\\s+([A-Za-z0-9_\\\\]+)/g),\n      ).map((m) => m[1]);\n      log.debug(\n        `üêò PHP pseudo-parse: ${classes.length} classes, ${functions.length} fun√ß√µes`,\n      );\n      return this.wrapMinimal('php', { classes, functions, namespaces });\n    } catch (e) {\n      log.debug(`‚ö†Ô∏è Erro ao parsear PHP: ${(e as Error).message}`);\n      return null;\n    }\n  }\n\n  /**\n   * Parse Python\n   */\n  private parsePython(codigo: string): BabelFile | null {\n    try {\n      // Heur√≠stica simples para Python: extrai classes e fun√ß√µes (def)\n      const classes = Array.from(\n        codigo.matchAll(/^class\\s+([A-Za-z0-9_]+)/gm),\n      ).map((m) => m[1]);\n      const functions = Array.from(\n        codigo.matchAll(/^def\\s+([A-Za-z0-9_]+)/gm),\n      ).map((m) => m[1]);\n      log.debug(\n        `üêç Python pseudo-parse: ${classes.length} classes, ${functions.length} fun√ß√µes`,\n      );\n      return this.wrapMinimal('python', { classes, functions });\n    } catch (e) {\n      log.debug(`‚ö†Ô∏è Erro ao parsear Python: ${(e as Error).message}`);\n      return null;\n    }\n  }\n\n  /**\n   * Wrapper para criar BabelFile compat√≠vel com prometheusExtra\n   */\n  private wrapMinimal(lang: string, rawAst: unknown): BabelFileExtra {\n    return {\n      type: 'File',\n      program: {\n        type: 'Program',\n        body: [],\n        sourceType: 'script',\n        directives: [],\n      },\n      comments: [],\n      tokens: [],\n      prometheusExtra: { lang, rawAst: rawAst as RawAst },\n    };\n  }\n\n  /**\n   * Infere extens√£o baseada no c√≥digo ou op√ß√µes\n   */\n  private inferExtension(codigo: string, opts?: ParserOptions): string {\n    // Pode ser passado via configura√ß√£o do plugin\n    if (opts?.pluginConfig?.extension) {\n      return opts.pluginConfig.extension as string;\n    }\n\n    // PHP tem prioridade quando h√° tag de abertura\n    if (/^<\\?php/.test(codigo.trim())) {\n      return '.php';\n    }\n\n    // Python: heur√≠stica por imports e defini√ß√µes\n    if (/^(import |from .+ import |def |class )/m.test(codigo)) {\n      return '.py';\n    }\n\n    // Heur√≠sticas simples\n    if (/\\bfrom\\s+['\"][^'\"]+\\.tsx?['\"]/.test(codigo) || /<[A-Z]/.test(codigo)) {\n      return codigo.includes('interface ') || codigo.includes('type ')\n        ? '.tsx'\n        : '.jsx';\n    }\n\n    if (/\\binterface\\s+\\w+|\\btype\\s+\\w+\\s*=/.test(codigo)) {\n      return '.ts';\n    }\n\n    // XML deve ter prioridade quando h√° declara√ß√£o expl√≠cita\n    if (/^<\\?xml/.test(codigo.trim())) {\n      return '.xml';\n    }\n\n    if (/<[a-z][\\w-]*/.test(codigo)) {\n      // Heur√≠stica: se parecer mais com HTML (sem declara√ß√£o XML), tratamos como HTML\n      return '.html';\n    }\n\n    if (/\\{[\\s\\S]*\\}/.test(codigo) && /[a-z-]+\\s*:/.test(codigo)) {\n      return '.css';\n    }\n\n    // Default para JS\n    return '.js';\n  }\n\n  /**\n   * Valida se o c√≥digo parece ser de uma linguagem suportada\n   */\n  validate(codigo: string): boolean {\n    // Valida√ß√µes b√°sicas\n    if (!codigo || typeof codigo !== 'string') {\n      return false;\n    }\n\n    // N√£o deve ser bin√°rio\n    if (/[\\x00-\\x08\\x0E-\\x1F\\x7F]/.test(codigo)) {\n      return false;\n    }\n\n    return true;\n  }\n}\n\n// Inst√¢ncia singleton do plugin core\nconst corePlugin = new CorePlugin();\nexport default corePlugin;\n"]}